  [1m[35mSQL (0.0ms)[0m  [1m[35mSET search_path TO public[0m
  [1m[35m (47.0ms)[0m  [1m[35mDROP DATABASE IF EXISTS "backlog_manager_test"[0m
  [1m[35m (53.9ms)[0m  [1m[35mCREATE DATABASE "backlog_manager_test" ENCODING = 'unicode'[0m
  [1m[35mSQL (6.3ms)[0m  [1m[35mCREATE EXTENSION IF NOT EXISTS "plpgsql" SCHEMA pg_catalog[0m
  [1m[35m (0.0ms)[0m  [1m[35mDROP TABLE IF EXISTS "game_services" CASCADE[0m
  [1m[35m (1.8ms)[0m  [1m[35mCREATE TABLE "game_services" ("id" bigserial primary key, "access_token" text, "created_at" timestamp(6) NOT NULL, "refresh_token" text, "service_name" character varying, "token_expires_at" timestamp(6), "updated_at" timestamp(6) NOT NULL, "user_id" bigint NOT NULL)[0m
  [1m[35m (0.4ms)[0m  [1m[35mCREATE INDEX "index_game_services_on_user_id" ON "game_services" ("user_id")[0m
  [1m[35m (0.0ms)[0m  [1m[35mDROP TABLE IF EXISTS "games" CASCADE[0m
  [1m[35m (3.5ms)[0m  [1m[35mCREATE TABLE "games" ("id" bigserial primary key, "created_at" timestamp(6) NOT NULL, "description" text, "developer" character varying, "external_id" character varying, "genre" character varying, "platform" character varying, "publisher" character varying, "release_date" date, "title" character varying, "updated_at" timestamp(6) NOT NULL)[0m
  [1m[35m (0.1ms)[0m  [1m[35mDROP TABLE IF EXISTS "identities" CASCADE[0m
  [1m[35m (0.9ms)[0m  [1m[35mCREATE TABLE "identities" ("id" bigserial primary key, "access_token" character varying, "created_at" timestamp(6) NOT NULL, "expires_at" timestamp(6), "extra_info" json, "profile_configured" boolean DEFAULT FALSE, "profile_last_checked_at" timestamp(6), "profile_visibility" character varying DEFAULT 'unknown', "provider" character varying NOT NULL, "refresh_token" character varying, "steam_id" character varying, "uid" character varying NOT NULL, "updated_at" timestamp(6) NOT NULL, "user_id" bigint NOT NULL)[0m
  [1m[35m (0.4ms)[0m  [1m[35mCREATE UNIQUE INDEX "index_identities_on_provider_and_uid" ON "identities" ("provider", "uid")[0m
  [1m[35m (0.5ms)[0m  [1m[35mCREATE UNIQUE INDEX "index_identities_on_steam_id" ON "identities" ("steam_id") WHERE (steam_id IS NOT NULL)[0m
  [1m[35m (0.2ms)[0m  [1m[35mCREATE INDEX "index_identities_on_user_id" ON "identities" ("user_id")[0m
  [1m[35m (0.0ms)[0m  [1m[35mDROP TABLE IF EXISTS "recommendations" CASCADE[0m
  [1m[35m (0.9ms)[0m  [1m[35mCREATE TABLE "recommendations" ("id" bigserial primary key, "ai_model" character varying, "created_at" timestamp(6) NOT NULL, "game_id" bigint NOT NULL, "reason" text, "score" decimal, "updated_at" timestamp(6) NOT NULL, "user_id" bigint NOT NULL)[0m
  [1m[35m (0.3ms)[0m  [1m[35mCREATE INDEX "index_recommendations_on_game_id" ON "recommendations" ("game_id")[0m
  [1m[35m (0.3ms)[0m  [1m[35mCREATE INDEX "index_recommendations_on_user_id" ON "recommendations" ("user_id")[0m
  [1m[35m (0.0ms)[0m  [1m[35mDROP TABLE IF EXISTS "user_games" CASCADE[0m
  [1m[35m (0.9ms)[0m  [1m[35mCREATE TABLE "user_games" ("id" bigserial primary key, "completion_percentage" integer, "created_at" timestamp(6) NOT NULL, "game_id" bigint NOT NULL, "hours_played" decimal, "notes" text, "priority" integer, "status" character varying, "updated_at" timestamp(6) NOT NULL, "user_id" bigint NOT NULL)[0m
  [1m[35m (0.3ms)[0m  [1m[35mCREATE INDEX "index_user_games_on_game_id" ON "user_games" ("game_id")[0m
  [1m[35m (0.2ms)[0m  [1m[35mCREATE INDEX "index_user_games_on_user_id" ON "user_games" ("user_id")[0m
  [1m[35m (0.0ms)[0m  [1m[35mDROP TABLE IF EXISTS "users" CASCADE[0m
  [1m[35m (0.9ms)[0m  [1m[35mCREATE TABLE "users" ("id" bigserial primary key, "avatar_url" character varying, "created_at" timestamp(6) NOT NULL, "email" character varying, "provider" character varying, "uid" character varying, "updated_at" timestamp(6) NOT NULL, "username" character varying)[0m
  [1m[35m (0.3ms)[0m  [1m[35mCREATE UNIQUE INDEX "index_users_on_provider_and_uid" ON "users" ("provider", "uid")[0m
  [1m[35m (1.4ms)[0m  [1m[35mALTER TABLE "game_services" ADD CONSTRAINT "fk_rails_42c0f93ab6"
FOREIGN KEY ("user_id")
  REFERENCES "users" ("id")
[0m
  [1m[35m (0.5ms)[0m  [1m[35mALTER TABLE "identities" ADD CONSTRAINT "fk_rails_5373344100"
FOREIGN KEY ("user_id")
  REFERENCES "users" ("id")
[0m
  [1m[35m (0.4ms)[0m  [1m[35mALTER TABLE "recommendations" ADD CONSTRAINT "fk_rails_47f7d6ab93"
FOREIGN KEY ("game_id")
  REFERENCES "games" ("id")
[0m
  [1m[35m (0.5ms)[0m  [1m[35mALTER TABLE "recommendations" ADD CONSTRAINT "fk_rails_e696723f80"
FOREIGN KEY ("user_id")
  REFERENCES "users" ("id")
[0m
  [1m[35m (0.3ms)[0m  [1m[35mALTER TABLE "user_games" ADD CONSTRAINT "fk_rails_445132b40d"
FOREIGN KEY ("game_id")
  REFERENCES "games" ("id")
[0m
  [1m[35m (0.2ms)[0m  [1m[35mALTER TABLE "user_games" ADD CONSTRAINT "fk_rails_a05b45437a"
FOREIGN KEY ("user_id")
  REFERENCES "users" ("id")
[0m
  [1m[35m (1.0ms)[0m  [1m[35mCREATE TABLE "schema_migrations" ("version" character varying NOT NULL PRIMARY KEY)[0m
  [1m[36mActiveRecord::SchemaMigration Load (0.2ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.2ms)[0m  [1m[32mINSERT INTO "schema_migrations" (version) VALUES (20260118032214)[0m
  [1m[35m (0.1ms)[0m  [1m[32mINSERT INTO "schema_migrations" (version) VALUES
(20260114054025),
(20260114054020),
(20260114054013),
(20260114054008),
(20260114054001),
(20260114053956),
(20260114053950);[0m
  [1m[35m (0.9ms)[0m  [1m[35mCREATE TABLE "ar_internal_metadata" ("key" character varying NOT NULL PRIMARY KEY, "value" character varying, "created_at" timestamp(6) NOT NULL, "updated_at" timestamp(6) NOT NULL)[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.2ms)[0m  [1m[34mSELECT * FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 ORDER BY "ar_internal_metadata"."key" ASC LIMIT 1[0m  [[nil, "environment"]]
  [1m[36mActiveRecord::InternalMetadata Create (0.1ms)[0m  [1m[32mINSERT INTO "ar_internal_metadata" ("key", "value", "created_at", "updated_at") VALUES ('environment', 'test', '2026-01-18 03:26:11.403487', '2026-01-18 03:26:11.403488') RETURNING "key"[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.0ms)[0m  [1m[34mSELECT * FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 ORDER BY "ar_internal_metadata"."key" ASC LIMIT 1[0m  [[nil, "environment"]]
  [1m[36mActiveRecord::InternalMetadata Load (0.0ms)[0m  [1m[34mSELECT * FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 ORDER BY "ar_internal_metadata"."key" ASC LIMIT 1[0m  [[nil, "schema_sha1"]]
  [1m[36mActiveRecord::InternalMetadata Create (0.1ms)[0m  [1m[32mINSERT INTO "ar_internal_metadata" ("key", "value", "created_at", "updated_at") VALUES ('schema_sha1', '19b7b02e130ac50841f44323991cdcb6f51d1dff', '2026-01-18 03:26:11.404113', '2026-01-18 03:26:11.404113') RETURNING "key"[0m
  [1m[36mActiveRecord::SchemaMigration Load (0.3ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.2ms)[0m  [1m[35mALTER TABLE "identities" DISABLE TRIGGER ALL;ALTER TABLE "user_games" DISABLE TRIGGER ALL;ALTER TABLE "games" DISABLE TRIGGER ALL;ALTER TABLE "recommendations" DISABLE TRIGGER ALL;ALTER TABLE "users" DISABLE TRIGGER ALL;ALTER TABLE "game_services" DISABLE TRIGGER ALL;ALTER TABLE "schema_migrations" DISABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" DISABLE TRIGGER ALL[0m
  [1m[36mFixtures Load (2.4ms)[0m  [1m[31mDELETE FROM "game_services";
DELETE FROM "games";
DELETE FROM "identities";
DELETE FROM "recommendations";
DELETE FROM "user_games";
DELETE FROM "users";
INSERT INTO "game_services" ("id", "access_token", "created_at", "refresh_token", "service_name", "token_expires_at", "updated_at", "user_id") VALUES (980190962, 'MyText', '2026-01-18 03:26:11.479469', 'MyText', 'MyString', '2026-01-14 05:40:08', '2026-01-18 03:26:11.479469', 980190962), (298486374, 'MyText', '2026-01-18 03:26:11.479469', 'MyText', 'MyString', '2026-01-14 05:40:08', '2026-01-18 03:26:11.479469', 298486374);
INSERT INTO "games" ("id", "created_at", "description", "developer", "external_id", "genre", "platform", "publisher", "release_date", "title", "updated_at") VALUES (980190962, '2026-01-18 03:26:11.489720', 'MyText', 'MyString', 'MyString', 'MyString', 'MyString', 'MyString', '2026-01-14', 'MyString', '2026-01-18 03:26:11.489720'), (298486374, '2026-01-18 03:26:11.489720', 'MyText', 'MyString', 'MyString', 'MyString', 'MyString', 'MyString', '2026-01-14', 'MyString', '2026-01-18 03:26:11.489720');
INSERT INTO "identities" ("id", "access_token", "created_at", "expires_at", "extra_info", "profile_configured", "profile_last_checked_at", "profile_visibility", "provider", "refresh_token", "steam_id", "uid", "updated_at", "user_id") VALUES (980190962, 'test_token_1', '2026-01-18 03:26:11.490342', '2026-01-19 03:26:11', '{}', DEFAULT, DEFAULT, DEFAULT, 'google', 'refresh_token_1', DEFAULT, '12345', '2026-01-18 03:26:11.490342', 980190962), (298486374, 'test_token_2', '2026-01-18 03:26:11.490342', NULL, '{}', DEFAULT, DEFAULT, DEFAULT, 'steam', NULL, DEFAULT, '67890', '2026-01-18 03:26:11.490342', 298486374);
INSERT INTO "recommendations" ("id", "ai_model", "created_at", "game_id", "reason", "score", "updated_at", "user_id") VALUES (980190962, 'MyString', '2026-01-18 03:26:11.491030', 980190962, 'MyText', 9.99, '2026-01-18 03:26:11.491030', 980190962), (298486374, 'MyString', '2026-01-18 03:26:11.491030', 298486374, 'MyText', 9.99, '2026-01-18 03:26:11.491030', 298486374);
INSERT INTO "user_games" ("id", "completion_percentage", "created_at", "game_id", "hours_played", "notes", "priority", "status", "updated_at", "user_id") VALUES (980190962, 1, '2026-01-18 03:26:11.491539', 980190962, 9.99, 'MyText', 1, 'MyString', '2026-01-18 03:26:11.491539', 980190962), (298486374, 1, '2026-01-18 03:26:11.491539', 298486374, 9.99, 'MyText', 1, 'MyString', '2026-01-18 03:26:11.491539', 298486374);
INSERT INTO "users" ("id", "avatar_url", "created_at", "email", "provider", "uid", "updated_at", "username") VALUES (980190962, DEFAULT, '2026-01-18 03:26:11.492111', 'MyString', DEFAULT, DEFAULT, '2026-01-18 03:26:11.492111', 'MyString'), (298486374, DEFAULT, '2026-01-18 03:26:11.492111', 'MyString', DEFAULT, DEFAULT, '2026-01-18 03:26:11.492111', 'MyString')[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35m (0.6ms)[0m  [1m[35mALTER TABLE "identities" ENABLE TRIGGER ALL;ALTER TABLE "user_games" ENABLE TRIGGER ALL;ALTER TABLE "games" ENABLE TRIGGER ALL;ALTER TABLE "recommendations" ENABLE TRIGGER ALL;ALTER TABLE "users" ENABLE TRIGGER ALL;ALTER TABLE "game_services" ENABLE TRIGGER ALL;ALTER TABLE "schema_migrations" ENABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" ENABLE TRIGGER ALL[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (41.6ms)[0m  [1m[35mdo $$
  declare r record;
BEGIN
FOR r IN (
  SELECT FORMAT(
    'UPDATE pg_catalog.pg_constraint SET convalidated=false WHERE conname = ''%1$I'' AND connamespace::regnamespace = ''%2$I''::regnamespace; ALTER TABLE %2$I.%3$I VALIDATE CONSTRAINT %1$I;',
    constraint_name,
    table_schema,
    table_name
  ) AS constraint_check
  FROM information_schema.table_constraints WHERE constraint_type = 'FOREIGN KEY'
)
  LOOP
    EXECUTE (r.constraint_check);
  END LOOP;
END;
$$;
[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mBEGIN[0m
---------------------------------------------------------------------
IdentityTest: test_should_validate_steam_id_format_for_steam_provider
---------------------------------------------------------------------
  [1m[36mUser Load (0.3ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."id" = $1 LIMIT $2[0m  [["id", 980190962], ["LIMIT", 1]]
  [1m[36mIdentity Exists? (0.3ms)[0m  [1m[34mSELECT 1 AS one FROM "identities" WHERE "identities"."uid" = $1 AND "identities"."provider" = $2 LIMIT $3[0m  [["uid", "76561198012345678"], ["provider", "steam"], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mBEGIN[0m
----------------------------------------------------------------------------------
IdentityTest: test_profile_visibility_needs_check?_returns_true_when_never_checked
----------------------------------------------------------------------------------
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mBEGIN[0m
------------------------------------------------------------
IdentityTest: test_should_validate_profile_visibility_values
------------------------------------------------------------
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."id" = $1 LIMIT $2[0m  [["id", 980190962], ["LIMIT", 1]]
  [1m[36mIdentity Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "identities" WHERE "identities"."uid" = $1 AND "identities"."provider" = $2 LIMIT $3[0m  [["uid", "76561198012345678"], ["provider", "steam"], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mBEGIN[0m
------------------------------------------
IdentityTest: test_should_require_provider
------------------------------------------
  [1m[36mIdentity Exists? (0.1ms)[0m  [1m[34mSELECT 1 AS one FROM "identities" WHERE "identities"."uid" = $1 AND "identities"."provider" IS NULL LIMIT $2[0m  [["uid", "12345"], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mBEGIN[0m
-----------------------------------------------------------------------
IdentityTest: test_steam_provider?_returns_false_for_non-steam_provider
-----------------------------------------------------------------------
  [1m[36mIdentity Load (0.2ms)[0m  [1m[34mSELECT "identities".* FROM "identities" WHERE "identities"."id" = $1 LIMIT $2[0m  [["id", 980190962], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mBEGIN[0m
--------------------------------------------------------
IdentityTest: test_should_accept_valid_17-digit_steam_id
--------------------------------------------------------
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."id" = $1 LIMIT $2[0m  [["id", 980190962], ["LIMIT", 1]]
  [1m[36mIdentity Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "identities" WHERE "identities"."uid" = $1 AND "identities"."provider" = $2 LIMIT $3[0m  [["uid", "76561198012345678"], ["provider", "steam"], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mBEGIN[0m
---------------------------------------------------------
IdentityTest: test_should_enforce_unique_uid_per_provider
---------------------------------------------------------
  [1m[36mIdentity Load (0.1ms)[0m  [1m[34mSELECT "identities".* FROM "identities" WHERE "identities"."id" = $1 LIMIT $2[0m  [["id", 980190962], ["LIMIT", 1]]
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."id" = $1 LIMIT $2[0m  [["id", 298486374], ["LIMIT", 1]]
  [1m[36mIdentity Exists? (0.1ms)[0m  [1m[34mSELECT 1 AS one FROM "identities" WHERE "identities"."uid" = $1 AND "identities"."provider" = $2 LIMIT $3[0m  [["uid", "12345"], ["provider", "google"], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mBEGIN[0m
----------------------------------------------------------------------------------------
IdentityTest: test_profile_visibility_needs_check?_returns_false_for_non-steam_providers
----------------------------------------------------------------------------------------
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mBEGIN[0m
-------------------------------------------------------------------------
IdentityTest: test_public_profile?_returns_true_when_visibility_is_public
-------------------------------------------------------------------------
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mBEGIN[0m
--------------------------------------------------------------------
IdentityTest: test_should_allow_nil_steam_id_for_non-steam_providers
--------------------------------------------------------------------
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."id" = $1 LIMIT $2[0m  [["id", 980190962], ["LIMIT", 1]]
  [1m[36mIdentity Exists? (0.1ms)[0m  [1m[34mSELECT 1 AS one FROM "identities" WHERE "identities"."uid" = $1 AND "identities"."provider" = $2 LIMIT $3[0m  [["uid", "12345"], ["provider", "google"], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mBEGIN[0m
----------------------------------------
IdentityTest: test_should_belong_to_user
----------------------------------------
  [1m[36mIdentity Load (0.1ms)[0m  [1m[34mSELECT "identities".* FROM "identities" WHERE "identities"."id" = $1 LIMIT $2[0m  [["id", 980190962], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mBEGIN[0m
-------------------------------------
IdentityTest: test_should_require_uid
-------------------------------------
  [1m[36mIdentity Exists? (0.1ms)[0m  [1m[34mSELECT 1 AS one FROM "identities" WHERE "identities"."uid" IS NULL AND "identities"."provider" = $1 LIMIT $2[0m  [["provider", "google"], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mBEGIN[0m
---------------------------------------------------------------------------------------------
IdentityTest: test_profile_visibility_needs_check?_returns_true_when_checked_over_an_hour_ago
---------------------------------------------------------------------------------------------
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mBEGIN[0m
--------------------------------------------------------------
IdentityTest: test_expired?_returns_true_when_token_is_expired
--------------------------------------------------------------
  [1m[36mIdentity Load (0.1ms)[0m  [1m[34mSELECT "identities".* FROM "identities" WHERE "identities"."id" = $1 LIMIT $2[0m  [["id", 980190962], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mBEGIN[0m
---------------------------------------------------------------------------
IdentityTest: test_private_profile?_returns_true_when_visibility_is_private
---------------------------------------------------------------------------
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mBEGIN[0m
----------------------------------------------------------------
IdentityTest: test_expired?_returns_false_when_expires_at_is_nil
----------------------------------------------------------------
  [1m[36mIdentity Load (0.1ms)[0m  [1m[34mSELECT "identities".* FROM "identities" WHERE "identities"."id" = $1 LIMIT $2[0m  [["id", 980190962], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mBEGIN[0m
------------------------------------------------------------------
IdentityTest: test_steam_provider?_returns_true_for_steam_provider
------------------------------------------------------------------
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."id" = $1 LIMIT $2[0m  [["id", 980190962], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mBEGIN[0m
------------------------------------------------------------------------------
IdentityTest: test_public_profile?_returns_false_when_visibility_is_not_public
------------------------------------------------------------------------------
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mBEGIN[0m
--------------------------------------------------------------------------------------
IdentityTest: test_profile_visibility_needs_check?_returns_false_when_checked_recently
--------------------------------------------------------------------------------------
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mBEGIN[0m
-------------------------------------------------------------------
IdentityTest: test_expired?_returns_false_when_token_is_not_expired
-------------------------------------------------------------------
  [1m[36mIdentity Load (0.1ms)[0m  [1m[34mSELECT "identities".* FROM "identities" WHERE "identities"."id" = $1 LIMIT $2[0m  [["id", 980190962], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mBEGIN[0m
----------------------------------------------------------------------------------
IdentityTest: test_find_or_create_from_omniauth_stores_steam_id_for_steam_provider
----------------------------------------------------------------------------------
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."id" = $1 LIMIT $2[0m  [["id", 980190962], ["LIMIT", 1]]
  [1m[36mIdentity Load (0.1ms)[0m  [1m[34mSELECT "identities".* FROM "identities" WHERE "identities"."provider" = $1 AND "identities"."uid" = $2 LIMIT $3[0m  [["provider", "steam"], ["uid", "76561198012345678"], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mIdentity Exists? (0.1ms)[0m  [1m[34mSELECT 1 AS one FROM "identities" WHERE "identities"."uid" = $1 AND "identities"."provider" = $2 LIMIT $3[0m  [["uid", "76561198012345678"], ["provider", "steam"], ["LIMIT", 1]]
  [1m[36mIdentity Create (0.4ms)[0m  [1m[32mINSERT INTO "identities" ("access_token", "created_at", "expires_at", "extra_info", "profile_configured", "profile_last_checked_at", "profile_visibility", "provider", "refresh_token", "steam_id", "uid", "updated_at", "user_id") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13) RETURNING "id"[0m  [["access_token", "[FILTERED]"], ["created_at", "2026-01-18 03:26:11.586227"], ["expires_at", nil], ["extra_info", "{}"], ["profile_configured", false], ["profile_last_checked_at", nil], ["profile_visibility", "unknown"], ["provider", "steam"], ["refresh_token", "[FILTERED]"], ["steam_id", "76561198012345678"], ["uid", "76561198012345678"], ["updated_at", "2026-01-18 03:26:11.586227"], ["user_id", 980190962]]
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mActiveRecord::InternalMetadata Load (1.2ms)[0m  [1m[34mSELECT * FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 ORDER BY "ar_internal_metadata"."key" ASC LIMIT 1[0m  [[nil, "schema_sha1"]]
  [1m[36mActiveRecord::SchemaMigration Load (0.6ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.5ms)[0m  [1m[35mALTER TABLE "identities" DISABLE TRIGGER ALL;ALTER TABLE "user_games" DISABLE TRIGGER ALL;ALTER TABLE "games" DISABLE TRIGGER ALL;ALTER TABLE "recommendations" DISABLE TRIGGER ALL;ALTER TABLE "users" DISABLE TRIGGER ALL;ALTER TABLE "game_services" DISABLE TRIGGER ALL;ALTER TABLE "schema_migrations" DISABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" DISABLE TRIGGER ALL[0m
  [1m[36mFixtures Load (2.7ms)[0m  [1m[31mDELETE FROM "game_services";
DELETE FROM "games";
DELETE FROM "identities";
DELETE FROM "recommendations";
DELETE FROM "user_games";
DELETE FROM "users";
INSERT INTO "game_services" ("id", "access_token", "created_at", "refresh_token", "service_name", "token_expires_at", "updated_at", "user_id") VALUES (980190962, 'MyText', '2026-01-18 03:26:20.236828', 'MyText', 'MyString', '2026-01-14 05:40:08', '2026-01-18 03:26:20.236828', 980190962), (298486374, 'MyText', '2026-01-18 03:26:20.236828', 'MyText', 'MyString', '2026-01-14 05:40:08', '2026-01-18 03:26:20.236828', 298486374);
INSERT INTO "games" ("id", "created_at", "description", "developer", "external_id", "genre", "platform", "publisher", "release_date", "title", "updated_at") VALUES (980190962, '2026-01-18 03:26:20.243148', 'MyText', 'MyString', 'MyString', 'MyString', 'MyString', 'MyString', '2026-01-14', 'MyString', '2026-01-18 03:26:20.243148'), (298486374, '2026-01-18 03:26:20.243148', 'MyText', 'MyString', 'MyString', 'MyString', 'MyString', 'MyString', '2026-01-14', 'MyString', '2026-01-18 03:26:20.243148');
INSERT INTO "identities" ("id", "access_token", "created_at", "expires_at", "extra_info", "profile_configured", "profile_last_checked_at", "profile_visibility", "provider", "refresh_token", "steam_id", "uid", "updated_at", "user_id") VALUES (980190962, 'test_token_1', '2026-01-18 03:26:20.245700', '2026-01-19 03:26:20', '{}', DEFAULT, DEFAULT, DEFAULT, 'google', 'refresh_token_1', DEFAULT, '12345', '2026-01-18 03:26:20.245700', 980190962), (298486374, 'test_token_2', '2026-01-18 03:26:20.245700', NULL, '{}', DEFAULT, DEFAULT, DEFAULT, 'steam', NULL, DEFAULT, '67890', '2026-01-18 03:26:20.245700', 298486374);
INSERT INTO "recommendations" ("id", "ai_model", "created_at", "game_id", "reason", "score", "updated_at", "user_id") VALUES (980190962, 'MyString', '2026-01-18 03:26:20.247166', 980190962, 'MyText', 9.99, '2026-01-18 03:26:20.247166', 980190962), (298486374, 'MyString', '2026-01-18 03:26:20.247166', 298486374, 'MyText', 9.99, '2026-01-18 03:26:20.247166', 298486374);
INSERT INTO "user_games" ("id", "completion_percentage", "created_at", "game_id", "hours_played", "notes", "priority", "status", "updated_at", "user_id") VALUES (980190962, 1, '2026-01-18 03:26:20.249991', 980190962, 9.99, 'MyText', 1, 'MyString', '2026-01-18 03:26:20.249991', 980190962), (298486374, 1, '2026-01-18 03:26:20.249991', 298486374, 9.99, 'MyText', 1, 'MyString', '2026-01-18 03:26:20.249991', 298486374);
INSERT INTO "users" ("id", "avatar_url", "created_at", "email", "provider", "uid", "updated_at", "username") VALUES (980190962, DEFAULT, '2026-01-18 03:26:20.252478', 'MyString', DEFAULT, DEFAULT, '2026-01-18 03:26:20.252478', 'MyString'), (298486374, DEFAULT, '2026-01-18 03:26:20.252478', 'MyString', DEFAULT, DEFAULT, '2026-01-18 03:26:20.252478', 'MyString')[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35m (0.7ms)[0m  [1m[35mALTER TABLE "identities" ENABLE TRIGGER ALL;ALTER TABLE "user_games" ENABLE TRIGGER ALL;ALTER TABLE "games" ENABLE TRIGGER ALL;ALTER TABLE "recommendations" ENABLE TRIGGER ALL;ALTER TABLE "users" ENABLE TRIGGER ALL;ALTER TABLE "game_services" ENABLE TRIGGER ALL;ALTER TABLE "schema_migrations" ENABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" ENABLE TRIGGER ALL[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.4ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (8.7ms)[0m  [1m[35mdo $$
  declare r record;
BEGIN
FOR r IN (
  SELECT FORMAT(
    'UPDATE pg_catalog.pg_constraint SET convalidated=false WHERE conname = ''%1$I'' AND connamespace::regnamespace = ''%2$I''::regnamespace; ALTER TABLE %2$I.%3$I VALIDATE CONSTRAINT %1$I;',
    constraint_name,
    table_schema,
    table_name
  ) AS constraint_check
  FROM information_schema.table_constraints WHERE constraint_type = 'FOREIGN KEY'
)
  LOOP
    EXECUTE (r.constraint_check);
  END LOOP;
END;
$$;
[0m
  [1m[36mTRANSACTION (0.4ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mBEGIN[0m
----------------------------------------------------------------------------------------
IdentityTest: test_profile_visibility_needs_check?_returns_false_for_non-steam_providers
----------------------------------------------------------------------------------------
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
---------------------------------------------------------------------------------------------
IdentityTest: test_profile_visibility_needs_check?_returns_true_when_checked_over_an_hour_ago
---------------------------------------------------------------------------------------------
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mBEGIN[0m
--------------------------------------------------------
IdentityTest: test_should_accept_valid_17-digit_steam_id
--------------------------------------------------------
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."id" = $1 LIMIT $2[0m  [["id", 980190962], ["LIMIT", 1]]
  [1m[36mIdentity Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "identities" WHERE "identities"."uid" = $1 AND "identities"."provider" = $2 LIMIT $3[0m  [["uid", "76561198012345678"], ["provider", "steam"], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mBEGIN[0m
------------------------------------------------------------------------------
IdentityTest: test_public_profile?_returns_false_when_visibility_is_not_public
------------------------------------------------------------------------------
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mBEGIN[0m
--------------------------------------------------------------------------------------
IdentityTest: test_profile_visibility_needs_check?_returns_false_when_checked_recently
--------------------------------------------------------------------------------------
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mBEGIN[0m
---------------------------------------------------------------------------
IdentityTest: test_private_profile?_returns_true_when_visibility_is_private
---------------------------------------------------------------------------
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mBEGIN[0m
--------------------------------------------------------------
IdentityTest: test_expired?_returns_true_when_token_is_expired
--------------------------------------------------------------
  [1m[36mIdentity Load (0.2ms)[0m  [1m[34mSELECT "identities".* FROM "identities" WHERE "identities"."id" = $1 LIMIT $2[0m  [["id", 980190962], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mBEGIN[0m
-------------------------------------------------------------------------
IdentityTest: test_public_profile?_returns_true_when_visibility_is_public
-------------------------------------------------------------------------
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mBEGIN[0m
------------------------------------------
IdentityTest: test_should_require_provider
------------------------------------------
  [1m[36mIdentity Exists? (0.1ms)[0m  [1m[34mSELECT 1 AS one FROM "identities" WHERE "identities"."uid" = $1 AND "identities"."provider" IS NULL LIMIT $2[0m  [["uid", "12345"], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
----------------------------------------------------------------
IdentityTest: test_expired?_returns_false_when_expires_at_is_nil
----------------------------------------------------------------
  [1m[36mIdentity Load (0.1ms)[0m  [1m[34mSELECT "identities".* FROM "identities" WHERE "identities"."id" = $1 LIMIT $2[0m  [["id", 980190962], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mBEGIN[0m
---------------------------------------------------------------------
IdentityTest: test_should_validate_steam_id_format_for_steam_provider
---------------------------------------------------------------------
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."id" = $1 LIMIT $2[0m  [["id", 980190962], ["LIMIT", 1]]
  [1m[36mIdentity Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "identities" WHERE "identities"."uid" = $1 AND "identities"."provider" = $2 LIMIT $3[0m  [["uid", "76561198012345678"], ["provider", "steam"], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mBEGIN[0m
-----------------------------------------------------------------------
IdentityTest: test_steam_provider?_returns_false_for_non-steam_provider
-----------------------------------------------------------------------
  [1m[36mIdentity Load (0.1ms)[0m  [1m[34mSELECT "identities".* FROM "identities" WHERE "identities"."id" = $1 LIMIT $2[0m  [["id", 980190962], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mBEGIN[0m
-------------------------------------
IdentityTest: test_should_require_uid
-------------------------------------
  [1m[36mIdentity Exists? (0.1ms)[0m  [1m[34mSELECT 1 AS one FROM "identities" WHERE "identities"."uid" IS NULL AND "identities"."provider" = $1 LIMIT $2[0m  [["provider", "google"], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mBEGIN[0m
--------------------------------------------------------------------
IdentityTest: test_should_allow_nil_steam_id_for_non-steam_providers
--------------------------------------------------------------------
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."id" = $1 LIMIT $2[0m  [["id", 980190962], ["LIMIT", 1]]
  [1m[36mIdentity Exists? (0.1ms)[0m  [1m[34mSELECT 1 AS one FROM "identities" WHERE "identities"."uid" = $1 AND "identities"."provider" = $2 LIMIT $3[0m  [["uid", "12345678"], ["provider", "google"], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mBEGIN[0m
----------------------------------------------------------------------------------
IdentityTest: test_profile_visibility_needs_check?_returns_true_when_never_checked
----------------------------------------------------------------------------------
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mBEGIN[0m
----------------------------------------
IdentityTest: test_should_belong_to_user
----------------------------------------
  [1m[36mIdentity Load (0.1ms)[0m  [1m[34mSELECT "identities".* FROM "identities" WHERE "identities"."id" = $1 LIMIT $2[0m  [["id", 980190962], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mBEGIN[0m
------------------------------------------------------------
IdentityTest: test_should_validate_profile_visibility_values
------------------------------------------------------------
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."id" = $1 LIMIT $2[0m  [["id", 980190962], ["LIMIT", 1]]
  [1m[36mIdentity Exists? (0.1ms)[0m  [1m[34mSELECT 1 AS one FROM "identities" WHERE "identities"."uid" = $1 AND "identities"."provider" = $2 LIMIT $3[0m  [["uid", "76561198012345678"], ["provider", "steam"], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
------------------------------------------------------------------
IdentityTest: test_steam_provider?_returns_true_for_steam_provider
------------------------------------------------------------------
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."id" = $1 LIMIT $2[0m  [["id", 980190962], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
-------------------------------------------------------------------
IdentityTest: test_expired?_returns_false_when_token_is_not_expired
-------------------------------------------------------------------
  [1m[36mIdentity Load (0.1ms)[0m  [1m[34mSELECT "identities".* FROM "identities" WHERE "identities"."id" = $1 LIMIT $2[0m  [["id", 980190962], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
---------------------------------------------------------
IdentityTest: test_should_enforce_unique_uid_per_provider
---------------------------------------------------------
  [1m[36mIdentity Load (0.1ms)[0m  [1m[34mSELECT "identities".* FROM "identities" WHERE "identities"."id" = $1 LIMIT $2[0m  [["id", 980190962], ["LIMIT", 1]]
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."id" = $1 LIMIT $2[0m  [["id", 298486374], ["LIMIT", 1]]
  [1m[36mIdentity Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "identities" WHERE "identities"."uid" = $1 AND "identities"."provider" = $2 LIMIT $3[0m  [["uid", "12345"], ["provider", "google"], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mBEGIN[0m
----------------------------------------------------------------------------------
IdentityTest: test_find_or_create_from_omniauth_stores_steam_id_for_steam_provider
----------------------------------------------------------------------------------
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."id" = $1 LIMIT $2[0m  [["id", 980190962], ["LIMIT", 1]]
  [1m[36mIdentity Load (0.2ms)[0m  [1m[34mSELECT "identities".* FROM "identities" WHERE "identities"."provider" = $1 AND "identities"."uid" = $2 LIMIT $3[0m  [["provider", "steam"], ["uid", "76561198012345678"], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mIdentity Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "identities" WHERE "identities"."uid" = $1 AND "identities"."provider" = $2 LIMIT $3[0m  [["uid", "76561198012345678"], ["provider", "steam"], ["LIMIT", 1]]
  [1m[36mIdentity Create (0.3ms)[0m  [1m[32mINSERT INTO "identities" ("access_token", "created_at", "expires_at", "extra_info", "profile_configured", "profile_last_checked_at", "profile_visibility", "provider", "refresh_token", "steam_id", "uid", "updated_at", "user_id") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13) RETURNING "id"[0m  [["access_token", "[FILTERED]"], ["created_at", "2026-01-18 03:26:20.302797"], ["expires_at", nil], ["extra_info", "{}"], ["profile_configured", false], ["profile_last_checked_at", nil], ["profile_visibility", "unknown"], ["provider", "steam"], ["refresh_token", "[FILTERED]"], ["steam_id", "76561198012345678"], ["uid", "76561198012345678"], ["updated_at", "2026-01-18 03:26:20.302797"], ["user_id", 980190962]]
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.9ms)[0m  [1m[34mSELECT * FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 ORDER BY "ar_internal_metadata"."key" ASC LIMIT 1[0m  [[nil, "schema_sha1"]]
  [1m[36mActiveRecord::SchemaMigration Load (0.6ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.8ms)[0m  [1m[35mALTER TABLE "identities" DISABLE TRIGGER ALL;ALTER TABLE "user_games" DISABLE TRIGGER ALL;ALTER TABLE "games" DISABLE TRIGGER ALL;ALTER TABLE "recommendations" DISABLE TRIGGER ALL;ALTER TABLE "users" DISABLE TRIGGER ALL;ALTER TABLE "game_services" DISABLE TRIGGER ALL;ALTER TABLE "schema_migrations" DISABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" DISABLE TRIGGER ALL[0m
  [1m[36mFixtures Load (3.2ms)[0m  [1m[31mDELETE FROM "game_services";
DELETE FROM "games";
DELETE FROM "identities";
DELETE FROM "recommendations";
DELETE FROM "user_games";
DELETE FROM "users";
INSERT INTO "game_services" ("id", "access_token", "created_at", "refresh_token", "service_name", "token_expires_at", "updated_at", "user_id") VALUES (980190962, 'MyText', '2026-01-18 03:26:24.414474', 'MyText', 'MyString', '2026-01-14 05:40:08', '2026-01-18 03:26:24.414474', 980190962), (298486374, 'MyText', '2026-01-18 03:26:24.414474', 'MyText', 'MyString', '2026-01-14 05:40:08', '2026-01-18 03:26:24.414474', 298486374);
INSERT INTO "games" ("id", "created_at", "description", "developer", "external_id", "genre", "platform", "publisher", "release_date", "title", "updated_at") VALUES (980190962, '2026-01-18 03:26:24.419669', 'MyText', 'MyString', 'MyString', 'MyString', 'MyString', 'MyString', '2026-01-14', 'MyString', '2026-01-18 03:26:24.419669'), (298486374, '2026-01-18 03:26:24.419669', 'MyText', 'MyString', 'MyString', 'MyString', 'MyString', 'MyString', '2026-01-14', 'MyString', '2026-01-18 03:26:24.419669');
INSERT INTO "identities" ("id", "access_token", "created_at", "expires_at", "extra_info", "profile_configured", "profile_last_checked_at", "profile_visibility", "provider", "refresh_token", "steam_id", "uid", "updated_at", "user_id") VALUES (980190962, 'test_token_1', '2026-01-18 03:26:24.421481', '2026-01-19 03:26:24', '{}', DEFAULT, DEFAULT, DEFAULT, 'google', 'refresh_token_1', DEFAULT, '12345', '2026-01-18 03:26:24.421481', 980190962), (298486374, 'test_token_2', '2026-01-18 03:26:24.421481', NULL, '{}', DEFAULT, DEFAULT, DEFAULT, 'steam', NULL, DEFAULT, '67890', '2026-01-18 03:26:24.421481', 298486374);
INSERT INTO "recommendations" ("id", "ai_model", "created_at", "game_id", "reason", "score", "updated_at", "user_id") VALUES (980190962, 'MyString', '2026-01-18 03:26:24.423187', 980190962, 'MyText', 9.99, '2026-01-18 03:26:24.423187', 980190962), (298486374, 'MyString', '2026-01-18 03:26:24.423187', 298486374, 'MyText', 9.99, '2026-01-18 03:26:24.423187', 298486374);
INSERT INTO "user_games" ("id", "completion_percentage", "created_at", "game_id", "hours_played", "notes", "priority", "status", "updated_at", "user_id") VALUES (980190962, 1, '2026-01-18 03:26:24.426542', 980190962, 9.99, 'MyText', 1, 'MyString', '2026-01-18 03:26:24.426542', 980190962), (298486374, 1, '2026-01-18 03:26:24.426542', 298486374, 9.99, 'MyText', 1, 'MyString', '2026-01-18 03:26:24.426542', 298486374);
INSERT INTO "users" ("id", "avatar_url", "created_at", "email", "provider", "uid", "updated_at", "username") VALUES (980190962, DEFAULT, '2026-01-18 03:26:24.428512', 'MyString', DEFAULT, DEFAULT, '2026-01-18 03:26:24.428512', 'MyString'), (298486374, DEFAULT, '2026-01-18 03:26:24.428512', 'MyString', DEFAULT, DEFAULT, '2026-01-18 03:26:24.428512', 'MyString')[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35m (0.8ms)[0m  [1m[35mALTER TABLE "identities" ENABLE TRIGGER ALL;ALTER TABLE "user_games" ENABLE TRIGGER ALL;ALTER TABLE "games" ENABLE TRIGGER ALL;ALTER TABLE "recommendations" ENABLE TRIGGER ALL;ALTER TABLE "users" ENABLE TRIGGER ALL;ALTER TABLE "game_services" ENABLE TRIGGER ALL;ALTER TABLE "schema_migrations" ENABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" ENABLE TRIGGER ALL[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (1.1ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (6.0ms)[0m  [1m[35mdo $$
  declare r record;
BEGIN
FOR r IN (
  SELECT FORMAT(
    'UPDATE pg_catalog.pg_constraint SET convalidated=false WHERE conname = ''%1$I'' AND connamespace::regnamespace = ''%2$I''::regnamespace; ALTER TABLE %2$I.%3$I VALIDATE CONSTRAINT %1$I;',
    constraint_name,
    table_schema,
    table_name
  ) AS constraint_check
  FROM information_schema.table_constraints WHERE constraint_type = 'FOREIGN KEY'
)
  LOOP
    EXECUTE (r.constraint_check);
  END LOOP;
END;
$$;
[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mBEGIN[0m
--------------------------------------------------------------------------------------------------
GamePlatforms::SteamServiceTest: test_fetch_player_summary_returns_parsed_data_for_private_profile
--------------------------------------------------------------------------------------------------
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mBEGIN[0m
---------------------------------------------------------------------------------
GamePlatforms::SteamServiceTest: test_fetch_player_summary_handles_timeout_errors
---------------------------------------------------------------------------------
Steam API timeout: execution expired
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mBEGIN[0m
----------------------------------------------------------------------------------------------
GamePlatforms::SteamServiceTest: test_fetch_player_summary_returns_nil_when_api_key_is_missing
----------------------------------------------------------------------------------------------
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mBEGIN[0m
---------------------------------------------------------------------------------
GamePlatforms::SteamServiceTest: test_fetch_player_summary_handles_malformed_JSON
---------------------------------------------------------------------------------
Steam API JSON parse error: unexpected token 'not' at line 1 column 1
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mBEGIN[0m
------------------------------------------------------------------------------------------------------------
GamePlatforms::SteamServiceTest: test_fetch_player_summary_returns_unknown_for_unrecognized_visibility_state
------------------------------------------------------------------------------------------------------------
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mBEGIN[0m
-------------------------------------------------------------------------------------------------
GamePlatforms::SteamServiceTest: test_fetch_player_summary_returns_parsed_data_for_public_profile
-------------------------------------------------------------------------------------------------
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mBEGIN[0m
----------------------------------------------------------------------------------------------
GamePlatforms::SteamServiceTest: test_valid_steam_id?_returns_true_for_valid_17-digit_steam_id
----------------------------------------------------------------------------------------------
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mBEGIN[0m
---------------------------------------------------------------------------------
GamePlatforms::SteamServiceTest: test_fetch_player_summary_handles_empty_response
---------------------------------------------------------------------------------
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mBEGIN[0m
----------------------------------------------------------------------------------------
GamePlatforms::SteamServiceTest: test_valid_steam_id?_returns_false_for_invalid_steam_id
----------------------------------------------------------------------------------------
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mBEGIN[0m
-------------------------------------------------------------------------------------------------------
GamePlatforms::SteamServiceTest: test_fetch_player_summary_returns_parsed_data_for_friends_only_profile
-------------------------------------------------------------------------------------------------------
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mBEGIN[0m
-------------------------------------------------------------------------------------------
GamePlatforms::SteamServiceTest: test_fetch_player_summary_returns_nil_for_invalid_steam_id
-------------------------------------------------------------------------------------------
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mBEGIN[0m
----------------------------------------------------------------------------------------
GamePlatforms::SteamServiceTest: test_fetch_player_summary_handles_API_errors_gracefully
----------------------------------------------------------------------------------------
Steam API returned status 500: Internal Server Error
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mBEGIN[0m
---------------------------------------------------------------------------------------
GamePlatforms::SteamServiceTest: test_fetch_player_summary_detects_unconfigured_profile
---------------------------------------------------------------------------------------
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mActiveRecord::InternalMetadata Load (1.2ms)[0m  [1m[34mSELECT * FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 ORDER BY "ar_internal_metadata"."key" ASC LIMIT 1[0m  [[nil, "schema_sha1"]]
  [1m[36mActiveRecord::SchemaMigration Load (0.6ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.8ms)[0m  [1m[35mALTER TABLE "identities" DISABLE TRIGGER ALL;ALTER TABLE "user_games" DISABLE TRIGGER ALL;ALTER TABLE "games" DISABLE TRIGGER ALL;ALTER TABLE "recommendations" DISABLE TRIGGER ALL;ALTER TABLE "users" DISABLE TRIGGER ALL;ALTER TABLE "game_services" DISABLE TRIGGER ALL;ALTER TABLE "schema_migrations" DISABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" DISABLE TRIGGER ALL[0m
  [1m[36mFixtures Load (3.8ms)[0m  [1m[31mDELETE FROM "game_services";
DELETE FROM "games";
DELETE FROM "identities";
DELETE FROM "recommendations";
DELETE FROM "user_games";
DELETE FROM "users";
INSERT INTO "game_services" ("id", "access_token", "created_at", "refresh_token", "service_name", "token_expires_at", "updated_at", "user_id") VALUES (980190962, 'MyText', '2026-01-18 03:26:28.470652', 'MyText', 'MyString', '2026-01-14 05:40:08', '2026-01-18 03:26:28.470652', 980190962), (298486374, 'MyText', '2026-01-18 03:26:28.470652', 'MyText', 'MyString', '2026-01-14 05:40:08', '2026-01-18 03:26:28.470652', 298486374);
INSERT INTO "games" ("id", "created_at", "description", "developer", "external_id", "genre", "platform", "publisher", "release_date", "title", "updated_at") VALUES (980190962, '2026-01-18 03:26:28.475363', 'MyText', 'MyString', 'MyString', 'MyString', 'MyString', 'MyString', '2026-01-14', 'MyString', '2026-01-18 03:26:28.475363'), (298486374, '2026-01-18 03:26:28.475363', 'MyText', 'MyString', 'MyString', 'MyString', 'MyString', 'MyString', '2026-01-14', 'MyString', '2026-01-18 03:26:28.475363');
INSERT INTO "identities" ("id", "access_token", "created_at", "expires_at", "extra_info", "profile_configured", "profile_last_checked_at", "profile_visibility", "provider", "refresh_token", "steam_id", "uid", "updated_at", "user_id") VALUES (980190962, 'test_token_1', '2026-01-18 03:26:28.476671', '2026-01-19 03:26:28', '{}', DEFAULT, DEFAULT, DEFAULT, 'google', 'refresh_token_1', DEFAULT, '12345', '2026-01-18 03:26:28.476671', 980190962), (298486374, 'test_token_2', '2026-01-18 03:26:28.476671', NULL, '{}', DEFAULT, DEFAULT, DEFAULT, 'steam', NULL, DEFAULT, '67890', '2026-01-18 03:26:28.476671', 298486374);
INSERT INTO "recommendations" ("id", "ai_model", "created_at", "game_id", "reason", "score", "updated_at", "user_id") VALUES (980190962, 'MyString', '2026-01-18 03:26:28.478134', 980190962, 'MyText', 9.99, '2026-01-18 03:26:28.478134', 980190962), (298486374, 'MyString', '2026-01-18 03:26:28.478134', 298486374, 'MyText', 9.99, '2026-01-18 03:26:28.478134', 298486374);
INSERT INTO "user_games" ("id", "completion_percentage", "created_at", "game_id", "hours_played", "notes", "priority", "status", "updated_at", "user_id") VALUES (980190962, 1, '2026-01-18 03:26:28.479187', 980190962, 9.99, 'MyText', 1, 'MyString', '2026-01-18 03:26:28.479187', 980190962), (298486374, 1, '2026-01-18 03:26:28.479187', 298486374, 9.99, 'MyText', 1, 'MyString', '2026-01-18 03:26:28.479187', 298486374);
INSERT INTO "users" ("id", "avatar_url", "created_at", "email", "provider", "uid", "updated_at", "username") VALUES (980190962, DEFAULT, '2026-01-18 03:26:28.479929', 'MyString', DEFAULT, DEFAULT, '2026-01-18 03:26:28.479929', 'MyString'), (298486374, DEFAULT, '2026-01-18 03:26:28.479929', 'MyString', DEFAULT, DEFAULT, '2026-01-18 03:26:28.479929', 'MyString')[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35m (0.4ms)[0m  [1m[35mALTER TABLE "identities" ENABLE TRIGGER ALL;ALTER TABLE "user_games" ENABLE TRIGGER ALL;ALTER TABLE "games" ENABLE TRIGGER ALL;ALTER TABLE "recommendations" ENABLE TRIGGER ALL;ALTER TABLE "users" ENABLE TRIGGER ALL;ALTER TABLE "game_services" ENABLE TRIGGER ALL;ALTER TABLE "schema_migrations" ENABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" ENABLE TRIGGER ALL[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.5ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (6.8ms)[0m  [1m[35mdo $$
  declare r record;
BEGIN
FOR r IN (
  SELECT FORMAT(
    'UPDATE pg_catalog.pg_constraint SET convalidated=false WHERE conname = ''%1$I'' AND connamespace::regnamespace = ''%2$I''::regnamespace; ALTER TABLE %2$I.%3$I VALIDATE CONSTRAINT %1$I;',
    constraint_name,
    table_schema,
    table_name
  ) AS constraint_check
  FROM information_schema.table_constraints WHERE constraint_type = 'FOREIGN KEY'
)
  LOOP
    EXECUTE (r.constraint_check);
  END LOOP;
END;
$$;
[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mBEGIN[0m
-----------------------------------------------------------------------------------------
SessionsControllerTest: test_should_handle_steam_oauth_callback_with_unconfigured_profile
-----------------------------------------------------------------------------------------
Started GET "/auth/steam/callback" for 127.0.0.1 at 2026-01-17 21:26:28 -0600
Processing by SessionsController#create as HTML
  Parameters: {"provider"=>"steam"}
  [1m[36mUser Load (0.4ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."provider" = $1 AND "users"."uid" = $2 LIMIT $3[0m  [["provider", "steam"], ["uid", "76561198012345678"], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Create (0.3ms)[0m  [1m[32mINSERT INTO "users" ("avatar_url", "created_at", "email", "provider", "uid", "updated_at", "username") VALUES ($1, $2, $3, $4, $5, $6, $7) RETURNING "id"[0m  [["avatar_url", nil], ["created_at", "2026-01-18 03:26:28.562325"], ["email", "[FILTERED]"], ["provider", "steam"], ["uid", "76561198012345678"], ["updated_at", "2026-01-18 03:26:28.562325"], ["username", "TestSteamUser"]]
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mIdentity Load (0.1ms)[0m  [1m[34mSELECT "identities".* FROM "identities" WHERE "identities"."provider" = $1 AND "identities"."uid" = $2 LIMIT $3[0m  [["provider", "steam"], ["uid", "76561198012345678"], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mIdentity Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "identities" WHERE "identities"."uid" = $1 AND "identities"."provider" = $2 LIMIT $3[0m  [["uid", "76561198012345678"], ["provider", "steam"], ["LIMIT", 1]]
  [1m[36mIdentity Create (0.2ms)[0m  [1m[32mINSERT INTO "identities" ("access_token", "created_at", "expires_at", "extra_info", "profile_configured", "profile_last_checked_at", "profile_visibility", "provider", "refresh_token", "steam_id", "uid", "updated_at", "user_id") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13) RETURNING "id"[0m  [["access_token", "[FILTERED]"], ["created_at", "2026-01-18 03:26:28.566240"], ["expires_at", nil], ["extra_info", "{}"], ["profile_configured", false], ["profile_last_checked_at", nil], ["profile_visibility", "unknown"], ["provider", "steam"], ["refresh_token", "[FILTERED]"], ["steam_id", "76561198012345678"], ["uid", "76561198012345678"], ["updated_at", "2026-01-18 03:26:28.566240"], ["user_id", 980190963]]
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mIdentity Load (0.4ms)[0m  [1m[34mSELECT "identities".* FROM "identities" WHERE "identities"."user_id" = $1 AND "identities"."provider" = $2 LIMIT $3[0m  [["user_id", 980190963], ["provider", "steam"], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mIdentity Update (0.2ms)[0m  [1m[33mUPDATE "identities" SET "profile_last_checked_at" = $1, "profile_visibility" = $2, "updated_at" = $3 WHERE "identities"."id" = $4[0m  [["profile_last_checked_at", "2026-01-18 03:26:28.571314"], ["profile_visibility", "public"], ["updated_at", "2026-01-18 03:26:28.573813"], ["id", 980190963]]
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Redirected to http://www.example.com/
Completed 302 Found in 22ms (ActiveRecord: 4.1ms (7 queries, 0 cached) | GC: 0.0ms)
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
-----------------------------------------------------------------------------------
SessionsControllerTest: test_should_handle_steam_oauth_callback_when_API_call_fails
-----------------------------------------------------------------------------------
Started GET "/auth/steam/callback" for 127.0.0.1 at 2026-01-17 21:26:28 -0600
Processing by SessionsController#create as HTML
  Parameters: {"provider"=>"steam"}
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."provider" = $1 AND "users"."uid" = $2 LIMIT $3[0m  [["provider", "steam"], ["uid", "76561198012345678"], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Create (0.4ms)[0m  [1m[32mINSERT INTO "users" ("avatar_url", "created_at", "email", "provider", "uid", "updated_at", "username") VALUES ($1, $2, $3, $4, $5, $6, $7) RETURNING "id"[0m  [["avatar_url", nil], ["created_at", "2026-01-18 03:26:28.580011"], ["email", "[FILTERED]"], ["provider", "steam"], ["uid", "76561198012345678"], ["updated_at", "2026-01-18 03:26:28.580011"], ["username", "TestSteamUser"]]
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mIdentity Load (0.2ms)[0m  [1m[34mSELECT "identities".* FROM "identities" WHERE "identities"."provider" = $1 AND "identities"."uid" = $2 LIMIT $3[0m  [["provider", "steam"], ["uid", "76561198012345678"], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mIdentity Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "identities" WHERE "identities"."uid" = $1 AND "identities"."provider" = $2 LIMIT $3[0m  [["uid", "76561198012345678"], ["provider", "steam"], ["LIMIT", 1]]
  [1m[36mIdentity Create (0.2ms)[0m  [1m[32mINSERT INTO "identities" ("access_token", "created_at", "expires_at", "extra_info", "profile_configured", "profile_last_checked_at", "profile_visibility", "provider", "refresh_token", "steam_id", "uid", "updated_at", "user_id") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13) RETURNING "id"[0m  [["access_token", "[FILTERED]"], ["created_at", "2026-01-18 03:26:28.581515"], ["expires_at", nil], ["extra_info", "{}"], ["profile_configured", false], ["profile_last_checked_at", nil], ["profile_visibility", "unknown"], ["provider", "steam"], ["refresh_token", "[FILTERED]"], ["steam_id", "76561198012345678"], ["uid", "76561198012345678"], ["updated_at", "2026-01-18 03:26:28.581515"], ["user_id", 980190964]]
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mIdentity Load (0.1ms)[0m  [1m[34mSELECT "identities".* FROM "identities" WHERE "identities"."user_id" = $1 AND "identities"."provider" = $2 LIMIT $3[0m  [["user_id", 980190964], ["provider", "steam"], ["LIMIT", 1]]
Redirected to http://www.example.com/
Completed 302 Found in 3ms (ActiveRecord: 1.3ms (6 queries, 0 cached) | GC: 0.0ms)
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mBEGIN[0m
-----------------------------------------------------------------
SessionsControllerTest: test_should_handle_authentication_failure
-----------------------------------------------------------------
Started GET "/auth/failure?message=invalid_credentials" for 127.0.0.1 at 2026-01-17 21:26:28 -0600
Processing by SessionsController#failure as HTML
  Parameters: {"message"=>"invalid_credentials"}
Redirected to http://www.example.com/
Completed 302 Found in 0ms (ActiveRecord: 0.0ms (0 queries, 0 cached) | GC: 0.0ms)
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mBEGIN[0m
-----------------------------------------------------------------------------------------
SessionsControllerTest: test_refresh_steam_profile_should_handle_missing_steam_connection
-----------------------------------------------------------------------------------------
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."id" = $1 LIMIT $2[0m  [["id", 980190962], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mBEGIN[0m
------------------------------------------------------------------------------------
SessionsControllerTest: test_should_handle_steam_oauth_callback_with_private_profile
------------------------------------------------------------------------------------
Started GET "/auth/steam/callback" for 127.0.0.1 at 2026-01-17 21:26:28 -0600
Processing by SessionsController#create as HTML
  Parameters: {"provider"=>"steam"}
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."provider" = $1 AND "users"."uid" = $2 LIMIT $3[0m  [["provider", "steam"], ["uid", "76561198012345678"], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Create (0.2ms)[0m  [1m[32mINSERT INTO "users" ("avatar_url", "created_at", "email", "provider", "uid", "updated_at", "username") VALUES ($1, $2, $3, $4, $5, $6, $7) RETURNING "id"[0m  [["avatar_url", nil], ["created_at", "2026-01-18 03:26:28.585936"], ["email", "[FILTERED]"], ["provider", "steam"], ["uid", "76561198012345678"], ["updated_at", "2026-01-18 03:26:28.585936"], ["username", "TestSteamUser"]]
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mIdentity Load (0.1ms)[0m  [1m[34mSELECT "identities".* FROM "identities" WHERE "identities"."provider" = $1 AND "identities"."uid" = $2 LIMIT $3[0m  [["provider", "steam"], ["uid", "76561198012345678"], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mIdentity Exists? (0.1ms)[0m  [1m[34mSELECT 1 AS one FROM "identities" WHERE "identities"."uid" = $1 AND "identities"."provider" = $2 LIMIT $3[0m  [["uid", "76561198012345678"], ["provider", "steam"], ["LIMIT", 1]]
  [1m[36mIdentity Create (0.2ms)[0m  [1m[32mINSERT INTO "identities" ("access_token", "created_at", "expires_at", "extra_info", "profile_configured", "profile_last_checked_at", "profile_visibility", "provider", "refresh_token", "steam_id", "uid", "updated_at", "user_id") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13) RETURNING "id"[0m  [["access_token", "[FILTERED]"], ["created_at", "2026-01-18 03:26:28.586789"], ["expires_at", nil], ["extra_info", "{}"], ["profile_configured", false], ["profile_last_checked_at", nil], ["profile_visibility", "unknown"], ["provider", "steam"], ["refresh_token", "[FILTERED]"], ["steam_id", "76561198012345678"], ["uid", "76561198012345678"], ["updated_at", "2026-01-18 03:26:28.586789"], ["user_id", 980190965]]
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mIdentity Load (0.1ms)[0m  [1m[34mSELECT "identities".* FROM "identities" WHERE "identities"."user_id" = $1 AND "identities"."provider" = $2 LIMIT $3[0m  [["user_id", 980190965], ["provider", "steam"], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mIdentity Update (0.2ms)[0m  [1m[33mUPDATE "identities" SET "profile_configured" = $1, "profile_last_checked_at" = $2, "profile_visibility" = $3, "updated_at" = $4 WHERE "identities"."id" = $5[0m  [["profile_configured", true], ["profile_last_checked_at", "2026-01-18 03:26:28.587440"], ["profile_visibility", "private"], ["updated_at", "2026-01-18 03:26:28.587505"], ["id", 980190965]]
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Redirected to http://www.example.com/
Completed 302 Found in 2ms (ActiveRecord: 1.1ms (7 queries, 0 cached) | GC: 0.0ms)
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."id" = $1 LIMIT $2[0m  [["id", 980190965], ["LIMIT", 1]]
  [1m[36mIdentity Load (0.1ms)[0m  [1m[34mSELECT "identities".* FROM "identities" WHERE "identities"."user_id" = $1 AND "identities"."provider" = $2 LIMIT $3[0m  [["user_id", 980190965], ["provider", "steam"], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mBEGIN[0m
----------------------------------------------------------------------
SessionsControllerTest: test_should_handle_oauth_callback_successfully
----------------------------------------------------------------------
Started GET "/auth/google/callback" for 127.0.0.1 at 2026-01-17 21:26:28 -0600
Processing by SessionsController#create as HTML
  Parameters: {"provider"=>"google"}
Authentication error: undefined method `[]' for nil
Redirected to http://www.example.com/
Completed 302 Found in 0ms (ActiveRecord: 0.0ms (0 queries, 0 cached) | GC: 0.0ms)
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mBEGIN[0m
-----------------------------------------------------------------------------------
SessionsControllerTest: test_refresh_steam_profile_should_update_profile_visibility
-----------------------------------------------------------------------------------
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."id" = $1 LIMIT $2[0m  [["id", 980190962], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mIdentity Exists? (0.1ms)[0m  [1m[34mSELECT 1 AS one FROM "identities" WHERE "identities"."uid" = $1 AND "identities"."provider" = $2 LIMIT $3[0m  [["uid", "76561198012345678"], ["provider", "steam"], ["LIMIT", 1]]
  [1m[36mIdentity Create (0.2ms)[0m  [1m[32mINSERT INTO "identities" ("access_token", "created_at", "expires_at", "extra_info", "profile_configured", "profile_last_checked_at", "profile_visibility", "provider", "refresh_token", "steam_id", "uid", "updated_at", "user_id") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13) RETURNING "id"[0m  [["access_token", "[FILTERED]"], ["created_at", "2026-01-18 03:26:28.590392"], ["expires_at", nil], ["extra_info", nil], ["profile_configured", false], ["profile_last_checked_at", nil], ["profile_visibility", "private"], ["provider", "steam"], ["refresh_token", "[FILTERED]"], ["steam_id", "76561198012345678"], ["uid", "76561198012345678"], ["updated_at", "2026-01-18 03:26:28.590392"], ["user_id", 980190962]]
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Started POST "/auth/google/callback" for 127.0.0.1 at 2026-01-17 21:26:28 -0600
  
ActionController::RoutingError (No route matches [POST] "/auth/google/callback"):
  
test/controllers/sessions_controller_test.rb:186:in `block in <class:SessionsControllerTest>'
Started POST "/steam/refresh_profile" for 127.0.0.1 at 2026-01-17 21:26:28 -0600
Processing by SessionsController#refresh_steam_profile as HTML
Redirected to http://www.example.com/user_games
Completed 302 Found in 0ms (ActiveRecord: 0.0ms (0 queries, 0 cached) | GC: 0.0ms)
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mBEGIN[0m
-------------------------------------------------------------
SessionsControllerTest: test_should_destroy_session_on_logout
-------------------------------------------------------------
Started POST "/auth/google/callback" for 127.0.0.1 at 2026-01-17 21:26:28 -0600
  
ActionController::RoutingError (No route matches [POST] "/auth/google/callback"):
  
test/controllers/sessions_controller_test.rb:34:in `block in <class:SessionsControllerTest>'
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
-----------------------------------------------------------------------------------
SessionsControllerTest: test_should_handle_steam_oauth_callback_with_public_profile
-----------------------------------------------------------------------------------
Started GET "/auth/steam/callback" for 127.0.0.1 at 2026-01-17 21:26:28 -0600
Processing by SessionsController#create as HTML
  Parameters: {"provider"=>"steam"}
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."provider" = $1 AND "users"."uid" = $2 LIMIT $3[0m  [["provider", "steam"], ["uid", "76561198012345678"], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Create (0.3ms)[0m  [1m[32mINSERT INTO "users" ("avatar_url", "created_at", "email", "provider", "uid", "updated_at", "username") VALUES ($1, $2, $3, $4, $5, $6, $7) RETURNING "id"[0m  [["avatar_url", "https://steamcdn-a.akamaihd.net/steamcommunity/public/images/avatars/fe/fef.jpg"], ["created_at", "2026-01-18 03:26:28.663769"], ["email", "[FILTERED]"], ["provider", "steam"], ["uid", "76561198012345678"], ["updated_at", "2026-01-18 03:26:28.663769"], ["username", "TestSteamUser"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mIdentity Load (0.2ms)[0m  [1m[34mSELECT "identities".* FROM "identities" WHERE "identities"."provider" = $1 AND "identities"."uid" = $2 LIMIT $3[0m  [["provider", "steam"], ["uid", "76561198012345678"], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mIdentity Exists? (0.3ms)[0m  [1m[34mSELECT 1 AS one FROM "identities" WHERE "identities"."uid" = $1 AND "identities"."provider" = $2 LIMIT $3[0m  [["uid", "76561198012345678"], ["provider", "steam"], ["LIMIT", 1]]
  [1m[36mIdentity Create (0.2ms)[0m  [1m[32mINSERT INTO "identities" ("access_token", "created_at", "expires_at", "extra_info", "profile_configured", "profile_last_checked_at", "profile_visibility", "provider", "refresh_token", "steam_id", "uid", "updated_at", "user_id") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13) RETURNING "id"[0m  [["access_token", "[FILTERED]"], ["created_at", "2026-01-18 03:26:28.666225"], ["expires_at", nil], ["extra_info", "{}"], ["profile_configured", false], ["profile_last_checked_at", nil], ["profile_visibility", "unknown"], ["provider", "steam"], ["refresh_token", "[FILTERED]"], ["steam_id", "76561198012345678"], ["uid", "76561198012345678"], ["updated_at", "2026-01-18 03:26:28.666225"], ["user_id", 980190966]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mIdentity Load (0.2ms)[0m  [1m[34mSELECT "identities".* FROM "identities" WHERE "identities"."user_id" = $1 AND "identities"."provider" = $2 LIMIT $3[0m  [["user_id", 980190966], ["provider", "steam"], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mIdentity Update (0.6ms)[0m  [1m[33mUPDATE "identities" SET "profile_configured" = $1, "profile_last_checked_at" = $2, "profile_visibility" = $3, "updated_at" = $4 WHERE "identities"."id" = $5[0m  [["profile_configured", true], ["profile_last_checked_at", "2026-01-18 03:26:28.667873"], ["profile_visibility", "public"], ["updated_at", "2026-01-18 03:26:28.667966"], ["id", 980190967]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Redirected to http://www.example.com/
Completed 302 Found in 6ms (ActiveRecord: 2.3ms (7 queries, 0 cached) | GC: 1.9ms)
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."id" = $1 LIMIT $2[0m  [["id", 980190966], ["LIMIT", 1]]
  [1m[36mIdentity Load (0.1ms)[0m  [1m[34mSELECT "identities".* FROM "identities" WHERE "identities"."user_id" = $1 AND "identities"."provider" = $2 LIMIT $3[0m  [["user_id", 980190966], ["provider", "steam"], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.9ms)[0m  [1m[34mSELECT * FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 ORDER BY "ar_internal_metadata"."key" ASC LIMIT 1[0m  [[nil, "schema_sha1"]]
  [1m[36mActiveRecord::SchemaMigration Load (0.4ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.7ms)[0m  [1m[35mALTER TABLE "identities" DISABLE TRIGGER ALL;ALTER TABLE "user_games" DISABLE TRIGGER ALL;ALTER TABLE "games" DISABLE TRIGGER ALL;ALTER TABLE "recommendations" DISABLE TRIGGER ALL;ALTER TABLE "users" DISABLE TRIGGER ALL;ALTER TABLE "game_services" DISABLE TRIGGER ALL;ALTER TABLE "schema_migrations" DISABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" DISABLE TRIGGER ALL[0m
  [1m[36mFixtures Load (2.6ms)[0m  [1m[31mDELETE FROM "game_services";
DELETE FROM "games";
DELETE FROM "identities";
DELETE FROM "recommendations";
DELETE FROM "user_games";
DELETE FROM "users";
INSERT INTO "game_services" ("id", "access_token", "created_at", "refresh_token", "service_name", "token_expires_at", "updated_at", "user_id") VALUES (980190962, 'MyText', '2026-01-18 03:27:28.550943', 'MyText', 'MyString', '2026-01-14 05:40:08', '2026-01-18 03:27:28.550943', 980190962), (298486374, 'MyText', '2026-01-18 03:27:28.550943', 'MyText', 'MyString', '2026-01-14 05:40:08', '2026-01-18 03:27:28.550943', 298486374);
INSERT INTO "games" ("id", "created_at", "description", "developer", "external_id", "genre", "platform", "publisher", "release_date", "title", "updated_at") VALUES (980190962, '2026-01-18 03:27:28.556360', 'MyText', 'MyString', 'MyString', 'MyString', 'MyString', 'MyString', '2026-01-14', 'MyString', '2026-01-18 03:27:28.556360'), (298486374, '2026-01-18 03:27:28.556360', 'MyText', 'MyString', 'MyString', 'MyString', 'MyString', 'MyString', '2026-01-14', 'MyString', '2026-01-18 03:27:28.556360');
INSERT INTO "identities" ("id", "access_token", "created_at", "expires_at", "extra_info", "profile_configured", "profile_last_checked_at", "profile_visibility", "provider", "refresh_token", "steam_id", "uid", "updated_at", "user_id") VALUES (980190962, 'test_token_1', '2026-01-18 03:27:28.557898', '2026-01-19 03:27:28', '{}', DEFAULT, DEFAULT, DEFAULT, 'google', 'refresh_token_1', DEFAULT, '12345', '2026-01-18 03:27:28.557898', 980190962), (298486374, 'test_token_2', '2026-01-18 03:27:28.557898', NULL, '{}', DEFAULT, DEFAULT, DEFAULT, 'steam', NULL, DEFAULT, '67890', '2026-01-18 03:27:28.557898', 298486374);
INSERT INTO "recommendations" ("id", "ai_model", "created_at", "game_id", "reason", "score", "updated_at", "user_id") VALUES (980190962, 'MyString', '2026-01-18 03:27:28.560878', 980190962, 'MyText', 9.99, '2026-01-18 03:27:28.560878', 980190962), (298486374, 'MyString', '2026-01-18 03:27:28.560878', 298486374, 'MyText', 9.99, '2026-01-18 03:27:28.560878', 298486374);
INSERT INTO "user_games" ("id", "completion_percentage", "created_at", "game_id", "hours_played", "notes", "priority", "status", "updated_at", "user_id") VALUES (980190962, 1, '2026-01-18 03:27:28.562537', 980190962, 9.99, 'MyText', 1, 'MyString', '2026-01-18 03:27:28.562537', 980190962), (298486374, 1, '2026-01-18 03:27:28.562537', 298486374, 9.99, 'MyText', 1, 'MyString', '2026-01-18 03:27:28.562537', 298486374);
INSERT INTO "users" ("id", "avatar_url", "created_at", "email", "provider", "uid", "updated_at", "username") VALUES (980190962, DEFAULT, '2026-01-18 03:27:28.565226', 'MyString', DEFAULT, DEFAULT, '2026-01-18 03:27:28.565226', 'MyString'), (298486374, DEFAULT, '2026-01-18 03:27:28.565226', 'MyString', DEFAULT, DEFAULT, '2026-01-18 03:27:28.565226', 'MyString')[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35m (0.3ms)[0m  [1m[35mALTER TABLE "identities" ENABLE TRIGGER ALL;ALTER TABLE "user_games" ENABLE TRIGGER ALL;ALTER TABLE "games" ENABLE TRIGGER ALL;ALTER TABLE "recommendations" ENABLE TRIGGER ALL;ALTER TABLE "users" ENABLE TRIGGER ALL;ALTER TABLE "game_services" ENABLE TRIGGER ALL;ALTER TABLE "schema_migrations" ENABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" ENABLE TRIGGER ALL[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (5.2ms)[0m  [1m[35mdo $$
  declare r record;
BEGIN
FOR r IN (
  SELECT FORMAT(
    'UPDATE pg_catalog.pg_constraint SET convalidated=false WHERE conname = ''%1$I'' AND connamespace::regnamespace = ''%2$I''::regnamespace; ALTER TABLE %2$I.%3$I VALIDATE CONSTRAINT %1$I;',
    constraint_name,
    table_schema,
    table_name
  ) AS constraint_check
  FROM information_schema.table_constraints WHERE constraint_type = 'FOREIGN KEY'
)
  LOOP
    EXECUTE (r.constraint_check);
  END LOOP;
END;
$$;
[0m
  [1m[36mTRANSACTION (0.5ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mBEGIN[0m
-----------------------------------------------------------------------------------------
SessionsControllerTest: test_should_handle_steam_oauth_callback_with_unconfigured_profile
-----------------------------------------------------------------------------------------
Started GET "/auth/steam/callback" for 127.0.0.1 at 2026-01-17 21:27:28 -0600
Processing by SessionsController#create as HTML
  Parameters: {"provider"=>"steam"}
  [1m[36mUser Load (0.3ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."provider" = $1 AND "users"."uid" = $2 LIMIT $3[0m  [["provider", "steam"], ["uid", "76561198011111111"], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Create (0.3ms)[0m  [1m[32mINSERT INTO "users" ("avatar_url", "created_at", "email", "provider", "uid", "updated_at", "username") VALUES ($1, $2, $3, $4, $5, $6, $7) RETURNING "id"[0m  [["avatar_url", nil], ["created_at", "2026-01-18 03:27:28.640120"], ["email", "[FILTERED]"], ["provider", "steam"], ["uid", "76561198011111111"], ["updated_at", "2026-01-18 03:27:28.640120"], ["username", "TestSteamUser3"]]
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mIdentity Load (0.2ms)[0m  [1m[34mSELECT "identities".* FROM "identities" WHERE "identities"."provider" = $1 AND "identities"."uid" = $2 LIMIT $3[0m  [["provider", "steam"], ["uid", "76561198011111111"], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mIdentity Exists? (0.3ms)[0m  [1m[34mSELECT 1 AS one FROM "identities" WHERE "identities"."uid" = $1 AND "identities"."provider" = $2 LIMIT $3[0m  [["uid", "76561198011111111"], ["provider", "steam"], ["LIMIT", 1]]
  [1m[36mIdentity Create (0.3ms)[0m  [1m[32mINSERT INTO "identities" ("access_token", "created_at", "expires_at", "extra_info", "profile_configured", "profile_last_checked_at", "profile_visibility", "provider", "refresh_token", "steam_id", "uid", "updated_at", "user_id") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13) RETURNING "id"[0m  [["access_token", "[FILTERED]"], ["created_at", "2026-01-18 03:27:28.643926"], ["expires_at", nil], ["extra_info", "{}"], ["profile_configured", false], ["profile_last_checked_at", nil], ["profile_visibility", "unknown"], ["provider", "steam"], ["refresh_token", "[FILTERED]"], ["steam_id", "76561198011111111"], ["uid", "76561198011111111"], ["updated_at", "2026-01-18 03:27:28.643926"], ["user_id", 980190963]]
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mIdentity Load (0.1ms)[0m  [1m[34mSELECT "identities".* FROM "identities" WHERE "identities"."user_id" = $1 AND "identities"."provider" = $2 LIMIT $3[0m  [["user_id", 980190963], ["provider", "steam"], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mIdentity Update (0.3ms)[0m  [1m[33mUPDATE "identities" SET "profile_last_checked_at" = $1, "profile_visibility" = $2, "updated_at" = $3 WHERE "identities"."id" = $4[0m  [["profile_last_checked_at", "2026-01-18 03:27:28.646669"], ["profile_visibility", "public"], ["updated_at", "2026-01-18 03:27:28.649716"], ["id", 980190963]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Redirected to http://www.example.com/
Completed 302 Found in 20ms (ActiveRecord: 4.9ms (7 queries, 0 cached) | GC: 0.0ms)
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mBEGIN[0m
-----------------------------------------------------------------
SessionsControllerTest: test_should_handle_authentication_failure
-----------------------------------------------------------------
Started GET "/auth/failure?message=invalid_credentials" for 127.0.0.1 at 2026-01-17 21:27:28 -0600
Processing by SessionsController#failure as HTML
  Parameters: {"message"=>"invalid_credentials"}
Redirected to http://www.example.com/
Completed 302 Found in 0ms (ActiveRecord: 0.0ms (0 queries, 0 cached) | GC: 0.0ms)
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mBEGIN[0m
-------------------------------------------------------------
SessionsControllerTest: test_should_destroy_session_on_logout
-------------------------------------------------------------
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."id" = $1 LIMIT $2[0m  [["id", 980190962], ["LIMIT", 1]]
Started POST "/logout" for 127.0.0.1 at 2026-01-17 21:27:28 -0600
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mBEGIN[0m
-----------------------------------------------------------------------------------------
SessionsControllerTest: test_refresh_steam_profile_should_handle_missing_steam_connection
-----------------------------------------------------------------------------------------
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."id" = $1 LIMIT $2[0m  [["id", 980190962], ["LIMIT", 1]]
Started POST "/steam/refresh_profile" for 127.0.0.1 at 2026-01-17 21:27:28 -0600
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mBEGIN[0m
----------------------------------------------------------------------
SessionsControllerTest: test_should_handle_oauth_callback_successfully
----------------------------------------------------------------------
Started GET "/auth/google_oauth2/callback" for 127.0.0.1 at 2026-01-17 21:27:28 -0600
Processing by SessionsController#create as HTML
  Parameters: {"provider"=>"google_oauth2"}
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."provider" = $1 AND "users"."uid" = $2 LIMIT $3[0m  [["provider", "google_oauth2"], ["uid", "12345"], ["LIMIT", 1]]
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."email" = $1 LIMIT $2[0m  [["email", "[FILTERED]"], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "users" WHERE "users"."email" = $1 LIMIT $2[0m  [["email", "[FILTERED]"], ["LIMIT", 1]]
  [1m[36mUser Create (0.2ms)[0m  [1m[32mINSERT INTO "users" ("avatar_url", "created_at", "email", "provider", "uid", "updated_at", "username") VALUES ($1, $2, $3, $4, $5, $6, $7) RETURNING "id"[0m  [["avatar_url", "https://example.com/avatar.jpg"], ["created_at", "2026-01-18 03:27:28.659685"], ["email", "[FILTERED]"], ["provider", "google_oauth2"], ["uid", "12345"], ["updated_at", "2026-01-18 03:27:28.659685"], ["username", "Test User"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mIdentity Load (0.1ms)[0m  [1m[34mSELECT "identities".* FROM "identities" WHERE "identities"."provider" = $1 AND "identities"."uid" = $2 LIMIT $3[0m  [["provider", "google_oauth2"], ["uid", "12345"], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mIdentity Exists? (0.1ms)[0m  [1m[34mSELECT 1 AS one FROM "identities" WHERE "identities"."uid" = $1 AND "identities"."provider" = $2 LIMIT $3[0m  [["uid", "12345"], ["provider", "google_oauth2"], ["LIMIT", 1]]
  [1m[36mIdentity Create (0.2ms)[0m  [1m[32mINSERT INTO "identities" ("access_token", "created_at", "expires_at", "extra_info", "profile_configured", "profile_last_checked_at", "profile_visibility", "provider", "refresh_token", "steam_id", "uid", "updated_at", "user_id") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13) RETURNING "id"[0m  [["access_token", "[FILTERED]"], ["created_at", "2026-01-18 03:27:28.660803"], ["expires_at", "2026-01-18 04:27:28"], ["extra_info", "{}"], ["profile_configured", false], ["profile_last_checked_at", nil], ["profile_visibility", "unknown"], ["provider", "google_oauth2"], ["refresh_token", "[FILTERED]"], ["steam_id", nil], ["uid", "12345"], ["updated_at", "2026-01-18 03:27:28.660803"], ["user_id", 980190964]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Redirected to http://www.example.com/
Completed 302 Found in 3ms (ActiveRecord: 1.4ms (7 queries, 0 cached) | GC: 0.0ms)
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mBEGIN[0m
-----------------------------------------------------------------------------------
SessionsControllerTest: test_should_handle_steam_oauth_callback_when_API_call_fails
-----------------------------------------------------------------------------------
Started GET "/auth/steam/callback" for 127.0.0.1 at 2026-01-17 21:27:28 -0600
Processing by SessionsController#create as HTML
  Parameters: {"provider"=>"steam"}
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."provider" = $1 AND "users"."uid" = $2 LIMIT $3[0m  [["provider", "steam"], ["uid", "76561198022222222"], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Create (0.3ms)[0m  [1m[32mINSERT INTO "users" ("avatar_url", "created_at", "email", "provider", "uid", "updated_at", "username") VALUES ($1, $2, $3, $4, $5, $6, $7) RETURNING "id"[0m  [["avatar_url", nil], ["created_at", "2026-01-18 03:27:28.663320"], ["email", "[FILTERED]"], ["provider", "steam"], ["uid", "76561198022222222"], ["updated_at", "2026-01-18 03:27:28.663320"], ["username", "TestSteamUser4"]]
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mIdentity Load (0.1ms)[0m  [1m[34mSELECT "identities".* FROM "identities" WHERE "identities"."provider" = $1 AND "identities"."uid" = $2 LIMIT $3[0m  [["provider", "steam"], ["uid", "76561198022222222"], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mIdentity Exists? (0.1ms)[0m  [1m[34mSELECT 1 AS one FROM "identities" WHERE "identities"."uid" = $1 AND "identities"."provider" = $2 LIMIT $3[0m  [["uid", "76561198022222222"], ["provider", "steam"], ["LIMIT", 1]]
  [1m[36mIdentity Create (0.2ms)[0m  [1m[32mINSERT INTO "identities" ("access_token", "created_at", "expires_at", "extra_info", "profile_configured", "profile_last_checked_at", "profile_visibility", "provider", "refresh_token", "steam_id", "uid", "updated_at", "user_id") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13) RETURNING "id"[0m  [["access_token", "[FILTERED]"], ["created_at", "2026-01-18 03:27:28.664443"], ["expires_at", nil], ["extra_info", "{}"], ["profile_configured", false], ["profile_last_checked_at", nil], ["profile_visibility", "unknown"], ["provider", "steam"], ["refresh_token", "[FILTERED]"], ["steam_id", "76561198022222222"], ["uid", "76561198022222222"], ["updated_at", "2026-01-18 03:27:28.664443"], ["user_id", 980190965]]
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mIdentity Load (0.1ms)[0m  [1m[34mSELECT "identities".* FROM "identities" WHERE "identities"."user_id" = $1 AND "identities"."provider" = $2 LIMIT $3[0m  [["user_id", 980190965], ["provider", "steam"], ["LIMIT", 1]]
Redirected to http://www.example.com/
Completed 302 Found in 2ms (ActiveRecord: 1.0ms (6 queries, 0 cached) | GC: 0.0ms)
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mBEGIN[0m
-----------------------------------------------------------------------------------
SessionsControllerTest: test_refresh_steam_profile_should_update_profile_visibility
-----------------------------------------------------------------------------------
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."id" = $1 LIMIT $2[0m  [["id", 980190962], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mIdentity Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "identities" WHERE "identities"."uid" = $1 AND "identities"."provider" = $2 LIMIT $3[0m  [["uid", "76561198033333333"], ["provider", "steam"], ["LIMIT", 1]]
  [1m[36mIdentity Create (0.2ms)[0m  [1m[32mINSERT INTO "identities" ("access_token", "created_at", "expires_at", "extra_info", "profile_configured", "profile_last_checked_at", "profile_visibility", "provider", "refresh_token", "steam_id", "uid", "updated_at", "user_id") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13) RETURNING "id"[0m  [["access_token", "[FILTERED]"], ["created_at", "2026-01-18 03:27:28.666771"], ["expires_at", nil], ["extra_info", nil], ["profile_configured", false], ["profile_last_checked_at", nil], ["profile_visibility", "private"], ["provider", "steam"], ["refresh_token", "[FILTERED]"], ["steam_id", "76561198033333333"], ["uid", "76561198033333333"], ["updated_at", "2026-01-18 03:27:28.666771"], ["user_id", 980190962]]
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Started POST "/steam/refresh_profile" for 127.0.0.1 at 2026-01-17 21:27:28 -0600
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mBEGIN[0m
-----------------------------------------------------------------------------------
SessionsControllerTest: test_should_handle_steam_oauth_callback_with_public_profile
-----------------------------------------------------------------------------------
Started GET "/auth/steam/callback" for 127.0.0.1 at 2026-01-17 21:27:28 -0600
Processing by SessionsController#create as HTML
  Parameters: {"provider"=>"steam"}
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."provider" = $1 AND "users"."uid" = $2 LIMIT $3[0m  [["provider", "steam"], ["uid", "76561198012345678"], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Create (0.2ms)[0m  [1m[32mINSERT INTO "users" ("avatar_url", "created_at", "email", "provider", "uid", "updated_at", "username") VALUES ($1, $2, $3, $4, $5, $6, $7) RETURNING "id"[0m  [["avatar_url", "https://steamcdn-a.akamaihd.net/steamcommunity/public/images/avatars/fe/fef.jpg"], ["created_at", "2026-01-18 03:27:28.668887"], ["email", "[FILTERED]"], ["provider", "steam"], ["uid", "76561198012345678"], ["updated_at", "2026-01-18 03:27:28.668887"], ["username", "TestSteamUser"]]
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mIdentity Load (0.1ms)[0m  [1m[34mSELECT "identities".* FROM "identities" WHERE "identities"."provider" = $1 AND "identities"."uid" = $2 LIMIT $3[0m  [["provider", "steam"], ["uid", "76561198012345678"], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mIdentity Exists? (0.1ms)[0m  [1m[34mSELECT 1 AS one FROM "identities" WHERE "identities"."uid" = $1 AND "identities"."provider" = $2 LIMIT $3[0m  [["uid", "76561198012345678"], ["provider", "steam"], ["LIMIT", 1]]
  [1m[36mIdentity Create (0.2ms)[0m  [1m[32mINSERT INTO "identities" ("access_token", "created_at", "expires_at", "extra_info", "profile_configured", "profile_last_checked_at", "profile_visibility", "provider", "refresh_token", "steam_id", "uid", "updated_at", "user_id") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13) RETURNING "id"[0m  [["access_token", "[FILTERED]"], ["created_at", "2026-01-18 03:27:28.669806"], ["expires_at", nil], ["extra_info", "{}"], ["profile_configured", false], ["profile_last_checked_at", nil], ["profile_visibility", "unknown"], ["provider", "steam"], ["refresh_token", "[FILTERED]"], ["steam_id", "76561198012345678"], ["uid", "76561198012345678"], ["updated_at", "2026-01-18 03:27:28.669806"], ["user_id", 980190966]]
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mIdentity Load (0.1ms)[0m  [1m[34mSELECT "identities".* FROM "identities" WHERE "identities"."user_id" = $1 AND "identities"."provider" = $2 LIMIT $3[0m  [["user_id", 980190966], ["provider", "steam"], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mIdentity Update (0.2ms)[0m  [1m[33mUPDATE "identities" SET "profile_configured" = $1, "profile_last_checked_at" = $2, "profile_visibility" = $3, "updated_at" = $4 WHERE "identities"."id" = $5[0m  [["profile_configured", true], ["profile_last_checked_at", "2026-01-18 03:27:28.670527"], ["profile_visibility", "public"], ["updated_at", "2026-01-18 03:27:28.670601"], ["id", 980190967]]
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Redirected to http://www.example.com/
Completed 302 Found in 3ms (ActiveRecord: 1.2ms (7 queries, 0 cached) | GC: 0.0ms)
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."id" = $1 LIMIT $2[0m  [["id", 980190966], ["LIMIT", 1]]
  [1m[36mIdentity Load (0.1ms)[0m  [1m[34mSELECT "identities".* FROM "identities" WHERE "identities"."user_id" = $1 AND "identities"."provider" = $2 LIMIT $3[0m  [["user_id", 980190966], ["provider", "steam"], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mBEGIN[0m
------------------------------------------------------------------------------------
SessionsControllerTest: test_should_handle_steam_oauth_callback_with_private_profile
------------------------------------------------------------------------------------
Started GET "/auth/steam/callback" for 127.0.0.1 at 2026-01-17 21:27:28 -0600
Processing by SessionsController#create as HTML
  Parameters: {"provider"=>"steam"}
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."provider" = $1 AND "users"."uid" = $2 LIMIT $3[0m  [["provider", "steam"], ["uid", "76561198087654321"], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Create (0.2ms)[0m  [1m[32mINSERT INTO "users" ("avatar_url", "created_at", "email", "provider", "uid", "updated_at", "username") VALUES ($1, $2, $3, $4, $5, $6, $7) RETURNING "id"[0m  [["avatar_url", nil], ["created_at", "2026-01-18 03:27:28.673228"], ["email", "[FILTERED]"], ["provider", "steam"], ["uid", "76561198087654321"], ["updated_at", "2026-01-18 03:27:28.673228"], ["username", "TestSteamUser2"]]
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mIdentity Load (0.1ms)[0m  [1m[34mSELECT "identities".* FROM "identities" WHERE "identities"."provider" = $1 AND "identities"."uid" = $2 LIMIT $3[0m  [["provider", "steam"], ["uid", "76561198087654321"], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mIdentity Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "identities" WHERE "identities"."uid" = $1 AND "identities"."provider" = $2 LIMIT $3[0m  [["uid", "76561198087654321"], ["provider", "steam"], ["LIMIT", 1]]
  [1m[36mIdentity Create (0.1ms)[0m  [1m[32mINSERT INTO "identities" ("access_token", "created_at", "expires_at", "extra_info", "profile_configured", "profile_last_checked_at", "profile_visibility", "provider", "refresh_token", "steam_id", "uid", "updated_at", "user_id") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13) RETURNING "id"[0m  [["access_token", "[FILTERED]"], ["created_at", "2026-01-18 03:27:28.674128"], ["expires_at", nil], ["extra_info", "{}"], ["profile_configured", false], ["profile_last_checked_at", nil], ["profile_visibility", "unknown"], ["provider", "steam"], ["refresh_token", "[FILTERED]"], ["steam_id", "76561198087654321"], ["uid", "76561198087654321"], ["updated_at", "2026-01-18 03:27:28.674128"], ["user_id", 980190967]]
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mIdentity Load (0.1ms)[0m  [1m[34mSELECT "identities".* FROM "identities" WHERE "identities"."user_id" = $1 AND "identities"."provider" = $2 LIMIT $3[0m  [["user_id", 980190967], ["provider", "steam"], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mIdentity Update (0.2ms)[0m  [1m[33mUPDATE "identities" SET "profile_configured" = $1, "profile_last_checked_at" = $2, "profile_visibility" = $3, "updated_at" = $4 WHERE "identities"."id" = $5[0m  [["profile_configured", true], ["profile_last_checked_at", "2026-01-18 03:27:28.674785"], ["profile_visibility", "private"], ["updated_at", "2026-01-18 03:27:28.674851"], ["id", 980190968]]
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Redirected to http://www.example.com/
Completed 302 Found in 2ms (ActiveRecord: 1.2ms (7 queries, 0 cached) | GC: 0.0ms)
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."id" = $1 LIMIT $2[0m  [["id", 980190967], ["LIMIT", 1]]
  [1m[36mIdentity Load (0.1ms)[0m  [1m[34mSELECT "identities".* FROM "identities" WHERE "identities"."user_id" = $1 AND "identities"."provider" = $2 LIMIT $3[0m  [["user_id", 980190967], ["provider", "steam"], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.6ms)[0m  [1m[34mSELECT * FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 ORDER BY "ar_internal_metadata"."key" ASC LIMIT 1[0m  [[nil, "schema_sha1"]]
  [1m[36mActiveRecord::SchemaMigration Load (0.5ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.3ms)[0m  [1m[35mALTER TABLE "identities" DISABLE TRIGGER ALL;ALTER TABLE "user_games" DISABLE TRIGGER ALL;ALTER TABLE "games" DISABLE TRIGGER ALL;ALTER TABLE "recommendations" DISABLE TRIGGER ALL;ALTER TABLE "users" DISABLE TRIGGER ALL;ALTER TABLE "game_services" DISABLE TRIGGER ALL;ALTER TABLE "schema_migrations" DISABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" DISABLE TRIGGER ALL[0m
  [1m[36mFixtures Load (3.4ms)[0m  [1m[31mDELETE FROM "game_services";
DELETE FROM "games";
DELETE FROM "identities";
DELETE FROM "recommendations";
DELETE FROM "user_games";
DELETE FROM "users";
INSERT INTO "game_services" ("id", "access_token", "created_at", "refresh_token", "service_name", "token_expires_at", "updated_at", "user_id") VALUES (980190962, 'MyText', '2026-01-18 03:27:50.782978', 'MyText', 'MyString', '2026-01-14 05:40:08', '2026-01-18 03:27:50.782978', 980190962), (298486374, 'MyText', '2026-01-18 03:27:50.782978', 'MyText', 'MyString', '2026-01-14 05:40:08', '2026-01-18 03:27:50.782978', 298486374);
INSERT INTO "games" ("id", "created_at", "description", "developer", "external_id", "genre", "platform", "publisher", "release_date", "title", "updated_at") VALUES (980190962, '2026-01-18 03:27:50.788660', 'MyText', 'MyString', 'MyString', 'MyString', 'MyString', 'MyString', '2026-01-14', 'MyString', '2026-01-18 03:27:50.788660'), (298486374, '2026-01-18 03:27:50.788660', 'MyText', 'MyString', 'MyString', 'MyString', 'MyString', 'MyString', '2026-01-14', 'MyString', '2026-01-18 03:27:50.788660');
INSERT INTO "identities" ("id", "access_token", "created_at", "expires_at", "extra_info", "profile_configured", "profile_last_checked_at", "profile_visibility", "provider", "refresh_token", "steam_id", "uid", "updated_at", "user_id") VALUES (980190962, 'test_token_1', '2026-01-18 03:27:50.790577', '2026-01-19 03:27:50', '{}', DEFAULT, DEFAULT, DEFAULT, 'google', 'refresh_token_1', DEFAULT, '12345', '2026-01-18 03:27:50.790577', 980190962), (298486374, 'test_token_2', '2026-01-18 03:27:50.790577', NULL, '{}', DEFAULT, DEFAULT, DEFAULT, 'steam', NULL, DEFAULT, '67890', '2026-01-18 03:27:50.790577', 298486374);
INSERT INTO "recommendations" ("id", "ai_model", "created_at", "game_id", "reason", "score", "updated_at", "user_id") VALUES (980190962, 'MyString', '2026-01-18 03:27:50.791836', 980190962, 'MyText', 9.99, '2026-01-18 03:27:50.791836', 980190962), (298486374, 'MyString', '2026-01-18 03:27:50.791836', 298486374, 'MyText', 9.99, '2026-01-18 03:27:50.791836', 298486374);
INSERT INTO "user_games" ("id", "completion_percentage", "created_at", "game_id", "hours_played", "notes", "priority", "status", "updated_at", "user_id") VALUES (980190962, 1, '2026-01-18 03:27:50.792878', 980190962, 9.99, 'MyText', 1, 'MyString', '2026-01-18 03:27:50.792878', 980190962), (298486374, 1, '2026-01-18 03:27:50.792878', 298486374, 9.99, 'MyText', 1, 'MyString', '2026-01-18 03:27:50.792878', 298486374);
INSERT INTO "users" ("id", "avatar_url", "created_at", "email", "provider", "uid", "updated_at", "username") VALUES (980190962, DEFAULT, '2026-01-18 03:27:50.794085', 'MyString', DEFAULT, DEFAULT, '2026-01-18 03:27:50.794085', 'MyString'), (298486374, DEFAULT, '2026-01-18 03:27:50.794085', 'MyString', DEFAULT, DEFAULT, '2026-01-18 03:27:50.794085', 'MyString')[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35m (0.5ms)[0m  [1m[35mALTER TABLE "identities" ENABLE TRIGGER ALL;ALTER TABLE "user_games" ENABLE TRIGGER ALL;ALTER TABLE "games" ENABLE TRIGGER ALL;ALTER TABLE "recommendations" ENABLE TRIGGER ALL;ALTER TABLE "users" ENABLE TRIGGER ALL;ALTER TABLE "game_services" ENABLE TRIGGER ALL;ALTER TABLE "schema_migrations" ENABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" ENABLE TRIGGER ALL[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (6.5ms)[0m  [1m[35mdo $$
  declare r record;
BEGIN
FOR r IN (
  SELECT FORMAT(
    'UPDATE pg_catalog.pg_constraint SET convalidated=false WHERE conname = ''%1$I'' AND connamespace::regnamespace = ''%2$I''::regnamespace; ALTER TABLE %2$I.%3$I VALIDATE CONSTRAINT %1$I;',
    constraint_name,
    table_schema,
    table_name
  ) AS constraint_check
  FROM information_schema.table_constraints WHERE constraint_type = 'FOREIGN KEY'
)
  LOOP
    EXECUTE (r.constraint_check);
  END LOOP;
END;
$$;
[0m
  [1m[36mTRANSACTION (0.4ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mBEGIN[0m
-----------------------------------------------------------------------------------
SessionsControllerTest: test_should_handle_steam_oauth_callback_when_API_call_fails
-----------------------------------------------------------------------------------
Started GET "/auth/steam/callback" for 127.0.0.1 at 2026-01-17 21:27:50 -0600
Processing by SessionsController#create as HTML
  Parameters: {"provider"=>"steam"}
  [1m[36mUser Load (0.3ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."provider" = $1 AND "users"."uid" = $2 LIMIT $3[0m  [["provider", "steam"], ["uid", "76561198022222222"], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Create (0.2ms)[0m  [1m[32mINSERT INTO "users" ("avatar_url", "created_at", "email", "provider", "uid", "updated_at", "username") VALUES ($1, $2, $3, $4, $5, $6, $7) RETURNING "id"[0m  [["avatar_url", nil], ["created_at", "2026-01-18 03:27:50.861142"], ["email", "[FILTERED]"], ["provider", "steam"], ["uid", "76561198022222222"], ["updated_at", "2026-01-18 03:27:50.861142"], ["username", "TestSteamUser4"]]
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mIdentity Load (0.2ms)[0m  [1m[34mSELECT "identities".* FROM "identities" WHERE "identities"."provider" = $1 AND "identities"."uid" = $2 LIMIT $3[0m  [["provider", "steam"], ["uid", "76561198022222222"], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mIdentity Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "identities" WHERE "identities"."uid" = $1 AND "identities"."provider" = $2 LIMIT $3[0m  [["uid", "76561198022222222"], ["provider", "steam"], ["LIMIT", 1]]
  [1m[36mIdentity Create (0.4ms)[0m  [1m[32mINSERT INTO "identities" ("access_token", "created_at", "expires_at", "extra_info", "profile_configured", "profile_last_checked_at", "profile_visibility", "provider", "refresh_token", "steam_id", "uid", "updated_at", "user_id") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13) RETURNING "id"[0m  [["access_token", "[FILTERED]"], ["created_at", "2026-01-18 03:27:50.865344"], ["expires_at", nil], ["extra_info", "{}"], ["profile_configured", false], ["profile_last_checked_at", nil], ["profile_visibility", "unknown"], ["provider", "steam"], ["refresh_token", "[FILTERED]"], ["steam_id", "76561198022222222"], ["uid", "76561198022222222"], ["updated_at", "2026-01-18 03:27:50.865344"], ["user_id", 980190963]]
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mIdentity Load (0.2ms)[0m  [1m[34mSELECT "identities".* FROM "identities" WHERE "identities"."user_id" = $1 AND "identities"."provider" = $2 LIMIT $3[0m  [["user_id", 980190963], ["provider", "steam"], ["LIMIT", 1]]
Redirected to http://www.example.com/
Completed 302 Found in 16ms (ActiveRecord: 1.8ms (6 queries, 0 cached) | GC: 0.0ms)
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mBEGIN[0m
------------------------------------------------------------------------------------
SessionsControllerTest: test_should_handle_steam_oauth_callback_with_private_profile
------------------------------------------------------------------------------------
Started GET "/auth/steam/callback" for 127.0.0.1 at 2026-01-17 21:27:50 -0600
Processing by SessionsController#create as HTML
  Parameters: {"provider"=>"steam"}
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."provider" = $1 AND "users"."uid" = $2 LIMIT $3[0m  [["provider", "steam"], ["uid", "76561198087654321"], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Create (0.2ms)[0m  [1m[32mINSERT INTO "users" ("avatar_url", "created_at", "email", "provider", "uid", "updated_at", "username") VALUES ($1, $2, $3, $4, $5, $6, $7) RETURNING "id"[0m  [["avatar_url", nil], ["created_at", "2026-01-18 03:27:50.871554"], ["email", "[FILTERED]"], ["provider", "steam"], ["uid", "76561198087654321"], ["updated_at", "2026-01-18 03:27:50.871554"], ["username", "TestSteamUser2"]]
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mIdentity Load (0.1ms)[0m  [1m[34mSELECT "identities".* FROM "identities" WHERE "identities"."provider" = $1 AND "identities"."uid" = $2 LIMIT $3[0m  [["provider", "steam"], ["uid", "76561198087654321"], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mIdentity Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "identities" WHERE "identities"."uid" = $1 AND "identities"."provider" = $2 LIMIT $3[0m  [["uid", "76561198087654321"], ["provider", "steam"], ["LIMIT", 1]]
  [1m[36mIdentity Create (0.2ms)[0m  [1m[32mINSERT INTO "identities" ("access_token", "created_at", "expires_at", "extra_info", "profile_configured", "profile_last_checked_at", "profile_visibility", "provider", "refresh_token", "steam_id", "uid", "updated_at", "user_id") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13) RETURNING "id"[0m  [["access_token", "[FILTERED]"], ["created_at", "2026-01-18 03:27:50.872710"], ["expires_at", nil], ["extra_info", "{}"], ["profile_configured", false], ["profile_last_checked_at", nil], ["profile_visibility", "unknown"], ["provider", "steam"], ["refresh_token", "[FILTERED]"], ["steam_id", "76561198087654321"], ["uid", "76561198087654321"], ["updated_at", "2026-01-18 03:27:50.872710"], ["user_id", 980190964]]
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mIdentity Load (0.1ms)[0m  [1m[34mSELECT "identities".* FROM "identities" WHERE "identities"."user_id" = $1 AND "identities"."provider" = $2 LIMIT $3[0m  [["user_id", 980190964], ["provider", "steam"], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mIdentity Update (0.3ms)[0m  [1m[33mUPDATE "identities" SET "profile_configured" = $1, "profile_last_checked_at" = $2, "profile_visibility" = $3, "updated_at" = $4 WHERE "identities"."id" = $5[0m  [["profile_configured", true], ["profile_last_checked_at", "2026-01-18 03:27:50.873524"], ["profile_visibility", "private"], ["updated_at", "2026-01-18 03:27:50.875718"], ["id", 980190964]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Redirected to http://www.example.com/
Completed 302 Found in 6ms (ActiveRecord: 3.5ms (7 queries, 0 cached) | GC: 0.0ms)
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."id" = $1 LIMIT $2[0m  [["id", 980190964], ["LIMIT", 1]]
  [1m[36mIdentity Load (0.1ms)[0m  [1m[34mSELECT "identities".* FROM "identities" WHERE "identities"."user_id" = $1 AND "identities"."provider" = $2 LIMIT $3[0m  [["user_id", 980190964], ["provider", "steam"], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mBEGIN[0m
-----------------------------------------------------------------------------------
SessionsControllerTest: test_refresh_steam_profile_should_update_profile_visibility
-----------------------------------------------------------------------------------
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."id" = $1 LIMIT $2[0m  [["id", 980190962], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mIdentity Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "identities" WHERE "identities"."uid" = $1 AND "identities"."provider" = $2 LIMIT $3[0m  [["uid", "76561198033333333"], ["provider", "steam"], ["LIMIT", 1]]
  [1m[36mIdentity Create (0.1ms)[0m  [1m[32mINSERT INTO "identities" ("access_token", "created_at", "expires_at", "extra_info", "profile_configured", "profile_last_checked_at", "profile_visibility", "provider", "refresh_token", "steam_id", "uid", "updated_at", "user_id") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13) RETURNING "id"[0m  [["access_token", "[FILTERED]"], ["created_at", "2026-01-18 03:27:50.879318"], ["expires_at", nil], ["extra_info", nil], ["profile_configured", false], ["profile_last_checked_at", nil], ["profile_visibility", "private"], ["provider", "steam"], ["refresh_token", "[FILTERED]"], ["steam_id", "76561198033333333"], ["uid", "76561198033333333"], ["updated_at", "2026-01-18 03:27:50.879318"], ["user_id", 980190962]]
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mBEGIN[0m
-----------------------------------------------------------------------------------------
SessionsControllerTest: test_refresh_steam_profile_should_handle_missing_steam_connection
-----------------------------------------------------------------------------------------
  [1m[36mUser Load (0.0ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."id" = $1 LIMIT $2[0m  [["id", 980190962], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mBEGIN[0m
-----------------------------------------------------------------
SessionsControllerTest: test_should_handle_authentication_failure
-----------------------------------------------------------------
Started GET "/auth/failure?message=invalid_credentials" for 127.0.0.1 at 2026-01-17 21:27:50 -0600
Processing by SessionsController#failure as HTML
  Parameters: {"message"=>"invalid_credentials"}
Redirected to http://www.example.com/
Completed 302 Found in 0ms (ActiveRecord: 0.0ms (0 queries, 0 cached) | GC: 0.0ms)
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mBEGIN[0m
-------------------------------------------------------------
SessionsControllerTest: test_should_destroy_session_on_logout
-------------------------------------------------------------
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."id" = $1 LIMIT $2[0m  [["id", 980190962], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mBEGIN[0m
----------------------------------------------------------------------
SessionsControllerTest: test_should_handle_oauth_callback_successfully
----------------------------------------------------------------------
Started GET "/auth/google_oauth2/callback" for 127.0.0.1 at 2026-01-17 21:27:50 -0600
Processing by SessionsController#create as HTML
  Parameters: {"provider"=>"google_oauth2"}
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."provider" = $1 AND "users"."uid" = $2 LIMIT $3[0m  [["provider", "google_oauth2"], ["uid", "12345"], ["LIMIT", 1]]
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."email" = $1 LIMIT $2[0m  [["email", "[FILTERED]"], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "users" WHERE "users"."email" = $1 LIMIT $2[0m  [["email", "[FILTERED]"], ["LIMIT", 1]]
  [1m[36mUser Create (0.2ms)[0m  [1m[32mINSERT INTO "users" ("avatar_url", "created_at", "email", "provider", "uid", "updated_at", "username") VALUES ($1, $2, $3, $4, $5, $6, $7) RETURNING "id"[0m  [["avatar_url", "https://example.com/avatar.jpg"], ["created_at", "2026-01-18 03:27:50.885471"], ["email", "[FILTERED]"], ["provider", "google_oauth2"], ["uid", "12345"], ["updated_at", "2026-01-18 03:27:50.885471"], ["username", "Test User"]]
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mIdentity Load (0.1ms)[0m  [1m[34mSELECT "identities".* FROM "identities" WHERE "identities"."provider" = $1 AND "identities"."uid" = $2 LIMIT $3[0m  [["provider", "google_oauth2"], ["uid", "12345"], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mIdentity Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "identities" WHERE "identities"."uid" = $1 AND "identities"."provider" = $2 LIMIT $3[0m  [["uid", "12345"], ["provider", "google_oauth2"], ["LIMIT", 1]]
  [1m[36mIdentity Create (0.2ms)[0m  [1m[32mINSERT INTO "identities" ("access_token", "created_at", "expires_at", "extra_info", "profile_configured", "profile_last_checked_at", "profile_visibility", "provider", "refresh_token", "steam_id", "uid", "updated_at", "user_id") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13) RETURNING "id"[0m  [["access_token", "[FILTERED]"], ["created_at", "2026-01-18 03:27:50.886567"], ["expires_at", "2026-01-18 04:27:50"], ["extra_info", "{}"], ["profile_configured", false], ["profile_last_checked_at", nil], ["profile_visibility", "unknown"], ["provider", "google_oauth2"], ["refresh_token", "[FILTERED]"], ["steam_id", nil], ["uid", "12345"], ["updated_at", "2026-01-18 03:27:50.886567"], ["user_id", 980190965]]
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Redirected to http://www.example.com/
Completed 302 Found in 3ms (ActiveRecord: 1.3ms (7 queries, 0 cached) | GC: 0.0ms)
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mBEGIN[0m
-----------------------------------------------------------------------------------------
SessionsControllerTest: test_should_handle_steam_oauth_callback_with_unconfigured_profile
-----------------------------------------------------------------------------------------
Started GET "/auth/steam/callback" for 127.0.0.1 at 2026-01-17 21:27:50 -0600
Processing by SessionsController#create as HTML
  Parameters: {"provider"=>"steam"}
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."provider" = $1 AND "users"."uid" = $2 LIMIT $3[0m  [["provider", "steam"], ["uid", "76561198011111111"], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Create (0.2ms)[0m  [1m[32mINSERT INTO "users" ("avatar_url", "created_at", "email", "provider", "uid", "updated_at", "username") VALUES ($1, $2, $3, $4, $5, $6, $7) RETURNING "id"[0m  [["avatar_url", nil], ["created_at", "2026-01-18 03:27:50.888544"], ["email", "[FILTERED]"], ["provider", "steam"], ["uid", "76561198011111111"], ["updated_at", "2026-01-18 03:27:50.888544"], ["username", "TestSteamUser3"]]
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mIdentity Load (0.1ms)[0m  [1m[34mSELECT "identities".* FROM "identities" WHERE "identities"."provider" = $1 AND "identities"."uid" = $2 LIMIT $3[0m  [["provider", "steam"], ["uid", "76561198011111111"], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mIdentity Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "identities" WHERE "identities"."uid" = $1 AND "identities"."provider" = $2 LIMIT $3[0m  [["uid", "76561198011111111"], ["provider", "steam"], ["LIMIT", 1]]
  [1m[36mIdentity Create (0.2ms)[0m  [1m[32mINSERT INTO "identities" ("access_token", "created_at", "expires_at", "extra_info", "profile_configured", "profile_last_checked_at", "profile_visibility", "provider", "refresh_token", "steam_id", "uid", "updated_at", "user_id") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13) RETURNING "id"[0m  [["access_token", "[FILTERED]"], ["created_at", "2026-01-18 03:27:50.889459"], ["expires_at", nil], ["extra_info", "{}"], ["profile_configured", false], ["profile_last_checked_at", nil], ["profile_visibility", "unknown"], ["provider", "steam"], ["refresh_token", "[FILTERED]"], ["steam_id", "76561198011111111"], ["uid", "76561198011111111"], ["updated_at", "2026-01-18 03:27:50.889459"], ["user_id", 980190966]]
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mIdentity Load (0.1ms)[0m  [1m[34mSELECT "identities".* FROM "identities" WHERE "identities"."user_id" = $1 AND "identities"."provider" = $2 LIMIT $3[0m  [["user_id", 980190966], ["provider", "steam"], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mIdentity Update (0.2ms)[0m  [1m[33mUPDATE "identities" SET "profile_last_checked_at" = $1, "profile_visibility" = $2, "updated_at" = $3 WHERE "identities"."id" = $4[0m  [["profile_last_checked_at", "2026-01-18 03:27:50.890198"], ["profile_visibility", "public"], ["updated_at", "2026-01-18 03:27:50.890304"], ["id", 980190967]]
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Redirected to http://www.example.com/
Completed 302 Found in 2ms (ActiveRecord: 1.2ms (7 queries, 0 cached) | GC: 0.0ms)
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mBEGIN[0m
-----------------------------------------------------------------------------------
SessionsControllerTest: test_should_handle_steam_oauth_callback_with_public_profile
-----------------------------------------------------------------------------------
Started GET "/auth/steam/callback" for 127.0.0.1 at 2026-01-17 21:27:50 -0600
Processing by SessionsController#create as HTML
  Parameters: {"provider"=>"steam"}
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."provider" = $1 AND "users"."uid" = $2 LIMIT $3[0m  [["provider", "steam"], ["uid", "76561198012345678"], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Create (0.2ms)[0m  [1m[32mINSERT INTO "users" ("avatar_url", "created_at", "email", "provider", "uid", "updated_at", "username") VALUES ($1, $2, $3, $4, $5, $6, $7) RETURNING "id"[0m  [["avatar_url", "https://steamcdn-a.akamaihd.net/steamcommunity/public/images/avatars/fe/fef.jpg"], ["created_at", "2026-01-18 03:27:50.892096"], ["email", "[FILTERED]"], ["provider", "steam"], ["uid", "76561198012345678"], ["updated_at", "2026-01-18 03:27:50.892096"], ["username", "TestSteamUser"]]
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mIdentity Load (0.1ms)[0m  [1m[34mSELECT "identities".* FROM "identities" WHERE "identities"."provider" = $1 AND "identities"."uid" = $2 LIMIT $3[0m  [["provider", "steam"], ["uid", "76561198012345678"], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mIdentity Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "identities" WHERE "identities"."uid" = $1 AND "identities"."provider" = $2 LIMIT $3[0m  [["uid", "76561198012345678"], ["provider", "steam"], ["LIMIT", 1]]
  [1m[36mIdentity Create (0.2ms)[0m  [1m[32mINSERT INTO "identities" ("access_token", "created_at", "expires_at", "extra_info", "profile_configured", "profile_last_checked_at", "profile_visibility", "provider", "refresh_token", "steam_id", "uid", "updated_at", "user_id") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13) RETURNING "id"[0m  [["access_token", "[FILTERED]"], ["created_at", "2026-01-18 03:27:50.893070"], ["expires_at", nil], ["extra_info", "{}"], ["profile_configured", false], ["profile_last_checked_at", nil], ["profile_visibility", "unknown"], ["provider", "steam"], ["refresh_token", "[FILTERED]"], ["steam_id", "76561198012345678"], ["uid", "76561198012345678"], ["updated_at", "2026-01-18 03:27:50.893070"], ["user_id", 980190967]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mIdentity Load (0.1ms)[0m  [1m[34mSELECT "identities".* FROM "identities" WHERE "identities"."user_id" = $1 AND "identities"."provider" = $2 LIMIT $3[0m  [["user_id", 980190967], ["provider", "steam"], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mIdentity Update (0.2ms)[0m  [1m[33mUPDATE "identities" SET "profile_configured" = $1, "profile_last_checked_at" = $2, "profile_visibility" = $3, "updated_at" = $4 WHERE "identities"."id" = $5[0m  [["profile_configured", true], ["profile_last_checked_at", "2026-01-18 03:27:50.893834"], ["profile_visibility", "public"], ["updated_at", "2026-01-18 03:27:50.893912"], ["id", 980190968]]
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Redirected to http://www.example.com/
Completed 302 Found in 3ms (ActiveRecord: 1.3ms (7 queries, 0 cached) | GC: 0.0ms)
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."id" = $1 LIMIT $2[0m  [["id", 980190967], ["LIMIT", 1]]
  [1m[36mIdentity Load (0.1ms)[0m  [1m[34mSELECT "identities".* FROM "identities" WHERE "identities"."user_id" = $1 AND "identities"."provider" = $2 LIMIT $3[0m  [["user_id", 980190967], ["provider", "steam"], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mActiveRecord::InternalMetadata Load (1.0ms)[0m  [1m[34mSELECT * FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 ORDER BY "ar_internal_metadata"."key" ASC LIMIT 1[0m  [[nil, "schema_sha1"]]
  [1m[36mActiveRecord::SchemaMigration Load (0.3ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.5ms)[0m  [1m[35mALTER TABLE "identities" DISABLE TRIGGER ALL;ALTER TABLE "user_games" DISABLE TRIGGER ALL;ALTER TABLE "games" DISABLE TRIGGER ALL;ALTER TABLE "recommendations" DISABLE TRIGGER ALL;ALTER TABLE "users" DISABLE TRIGGER ALL;ALTER TABLE "game_services" DISABLE TRIGGER ALL;ALTER TABLE "schema_migrations" DISABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" DISABLE TRIGGER ALL[0m
  [1m[36mFixtures Load (2.8ms)[0m  [1m[31mDELETE FROM "game_services";
DELETE FROM "games";
DELETE FROM "identities";
DELETE FROM "recommendations";
DELETE FROM "user_games";
DELETE FROM "users";
INSERT INTO "game_services" ("id", "access_token", "created_at", "refresh_token", "service_name", "token_expires_at", "updated_at", "user_id") VALUES (980190962, 'MyText', '2026-01-18 03:28:15.222851', 'MyText', 'MyString', '2026-01-14 05:40:08', '2026-01-18 03:28:15.222851', 980190962), (298486374, 'MyText', '2026-01-18 03:28:15.222851', 'MyText', 'MyString', '2026-01-14 05:40:08', '2026-01-18 03:28:15.222851', 298486374);
INSERT INTO "games" ("id", "created_at", "description", "developer", "external_id", "genre", "platform", "publisher", "release_date", "title", "updated_at") VALUES (980190962, '2026-01-18 03:28:15.228408', 'MyText', 'MyString', 'MyString', 'MyString', 'MyString', 'MyString', '2026-01-14', 'MyString', '2026-01-18 03:28:15.228408'), (298486374, '2026-01-18 03:28:15.228408', 'MyText', 'MyString', 'MyString', 'MyString', 'MyString', 'MyString', '2026-01-14', 'MyString', '2026-01-18 03:28:15.228408');
INSERT INTO "identities" ("id", "access_token", "created_at", "expires_at", "extra_info", "profile_configured", "profile_last_checked_at", "profile_visibility", "provider", "refresh_token", "steam_id", "uid", "updated_at", "user_id") VALUES (980190962, 'test_token_1', '2026-01-18 03:28:15.230843', '2026-01-19 03:28:15', '{}', DEFAULT, DEFAULT, DEFAULT, 'google', 'refresh_token_1', DEFAULT, '12345', '2026-01-18 03:28:15.230843', 980190962), (298486374, 'test_token_2', '2026-01-18 03:28:15.230843', NULL, '{}', DEFAULT, DEFAULT, DEFAULT, 'steam', NULL, DEFAULT, '67890', '2026-01-18 03:28:15.230843', 298486374);
INSERT INTO "recommendations" ("id", "ai_model", "created_at", "game_id", "reason", "score", "updated_at", "user_id") VALUES (980190962, 'MyString', '2026-01-18 03:28:15.233129', 980190962, 'MyText', 9.99, '2026-01-18 03:28:15.233129', 980190962), (298486374, 'MyString', '2026-01-18 03:28:15.233129', 298486374, 'MyText', 9.99, '2026-01-18 03:28:15.233129', 298486374);
INSERT INTO "user_games" ("id", "completion_percentage", "created_at", "game_id", "hours_played", "notes", "priority", "status", "updated_at", "user_id") VALUES (980190962, 1, '2026-01-18 03:28:15.235710', 980190962, 9.99, 'MyText', 1, 'MyString', '2026-01-18 03:28:15.235710', 980190962), (298486374, 1, '2026-01-18 03:28:15.235710', 298486374, 9.99, 'MyText', 1, 'MyString', '2026-01-18 03:28:15.235710', 298486374);
INSERT INTO "users" ("id", "avatar_url", "created_at", "email", "provider", "uid", "updated_at", "username") VALUES (980190962, DEFAULT, '2026-01-18 03:28:15.237596', 'MyString', DEFAULT, DEFAULT, '2026-01-18 03:28:15.237596', 'MyString'), (298486374, DEFAULT, '2026-01-18 03:28:15.237596', 'MyString', DEFAULT, DEFAULT, '2026-01-18 03:28:15.237596', 'MyString')[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35m (0.5ms)[0m  [1m[35mALTER TABLE "identities" ENABLE TRIGGER ALL;ALTER TABLE "user_games" ENABLE TRIGGER ALL;ALTER TABLE "games" ENABLE TRIGGER ALL;ALTER TABLE "recommendations" ENABLE TRIGGER ALL;ALTER TABLE "users" ENABLE TRIGGER ALL;ALTER TABLE "game_services" ENABLE TRIGGER ALL;ALTER TABLE "schema_migrations" ENABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" ENABLE TRIGGER ALL[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (8.6ms)[0m  [1m[35mdo $$
  declare r record;
BEGIN
FOR r IN (
  SELECT FORMAT(
    'UPDATE pg_catalog.pg_constraint SET convalidated=false WHERE conname = ''%1$I'' AND connamespace::regnamespace = ''%2$I''::regnamespace; ALTER TABLE %2$I.%3$I VALIDATE CONSTRAINT %1$I;',
    constraint_name,
    table_schema,
    table_name
  ) AS constraint_check
  FROM information_schema.table_constraints WHERE constraint_type = 'FOREIGN KEY'
)
  LOOP
    EXECUTE (r.constraint_check);
  END LOOP;
END;
$$;
[0m
  [1m[36mTRANSACTION (0.4ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mBEGIN[0m
----------------------------------------------------------------------
SessionsControllerTest: test_should_handle_oauth_callback_successfully
----------------------------------------------------------------------
Started GET "/auth/google_oauth2/callback" for 127.0.0.1 at 2026-01-17 21:28:15 -0600
Processing by SessionsController#create as HTML
  Parameters: {"provider"=>"google_oauth2"}
  [1m[36mUser Load (0.3ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."provider" = $1 AND "users"."uid" = $2 LIMIT $3[0m  [["provider", "google_oauth2"], ["uid", "12345"], ["LIMIT", 1]]
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."email" = $1 LIMIT $2[0m  [["email", "[FILTERED]"], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.3ms)[0m  [1m[34mSELECT 1 AS one FROM "users" WHERE "users"."email" = $1 LIMIT $2[0m  [["email", "[FILTERED]"], ["LIMIT", 1]]
  [1m[36mUser Create (0.2ms)[0m  [1m[32mINSERT INTO "users" ("avatar_url", "created_at", "email", "provider", "uid", "updated_at", "username") VALUES ($1, $2, $3, $4, $5, $6, $7) RETURNING "id"[0m  [["avatar_url", "https://example.com/avatar.jpg"], ["created_at", "2026-01-18 03:28:15.308658"], ["email", "[FILTERED]"], ["provider", "google_oauth2"], ["uid", "12345"], ["updated_at", "2026-01-18 03:28:15.308658"], ["username", "Test User"]]
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mIdentity Load (0.2ms)[0m  [1m[34mSELECT "identities".* FROM "identities" WHERE "identities"."provider" = $1 AND "identities"."uid" = $2 LIMIT $3[0m  [["provider", "google_oauth2"], ["uid", "12345"], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mIdentity Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "identities" WHERE "identities"."uid" = $1 AND "identities"."provider" = $2 LIMIT $3[0m  [["uid", "12345"], ["provider", "google_oauth2"], ["LIMIT", 1]]
  [1m[36mIdentity Create (0.2ms)[0m  [1m[32mINSERT INTO "identities" ("access_token", "created_at", "expires_at", "extra_info", "profile_configured", "profile_last_checked_at", "profile_visibility", "provider", "refresh_token", "steam_id", "uid", "updated_at", "user_id") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13) RETURNING "id"[0m  [["access_token", "[FILTERED]"], ["created_at", "2026-01-18 03:28:15.312640"], ["expires_at", "2026-01-18 04:28:15"], ["extra_info", "{}"], ["profile_configured", false], ["profile_last_checked_at", nil], ["profile_visibility", "unknown"], ["provider", "google_oauth2"], ["refresh_token", "[FILTERED]"], ["steam_id", nil], ["uid", "12345"], ["updated_at", "2026-01-18 03:28:15.312640"], ["user_id", 980190963]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Redirected to http://www.example.com/
Completed 302 Found in 15ms (ActiveRecord: 1.7ms (7 queries, 0 cached) | GC: 0.0ms)
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mBEGIN[0m
------------------------------------------------------------------------------------
SessionsControllerTest: test_should_handle_steam_oauth_callback_with_private_profile
------------------------------------------------------------------------------------
Started GET "/auth/steam/callback" for 127.0.0.1 at 2026-01-17 21:28:15 -0600
Processing by SessionsController#create as HTML
  Parameters: {"provider"=>"steam"}
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."provider" = $1 AND "users"."uid" = $2 LIMIT $3[0m  [["provider", "steam"], ["uid", "76561198087654321"], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Create (0.2ms)[0m  [1m[32mINSERT INTO "users" ("avatar_url", "created_at", "email", "provider", "uid", "updated_at", "username") VALUES ($1, $2, $3, $4, $5, $6, $7) RETURNING "id"[0m  [["avatar_url", nil], ["created_at", "2026-01-18 03:28:15.317342"], ["email", "[FILTERED]"], ["provider", "steam"], ["uid", "76561198087654321"], ["updated_at", "2026-01-18 03:28:15.317342"], ["username", "TestSteamUser2"]]
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mIdentity Load (0.1ms)[0m  [1m[34mSELECT "identities".* FROM "identities" WHERE "identities"."provider" = $1 AND "identities"."uid" = $2 LIMIT $3[0m  [["provider", "steam"], ["uid", "76561198087654321"], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mIdentity Exists? (0.3ms)[0m  [1m[34mSELECT 1 AS one FROM "identities" WHERE "identities"."uid" = $1 AND "identities"."provider" = $2 LIMIT $3[0m  [["uid", "76561198087654321"], ["provider", "steam"], ["LIMIT", 1]]
  [1m[36mIdentity Create (0.2ms)[0m  [1m[32mINSERT INTO "identities" ("access_token", "created_at", "expires_at", "extra_info", "profile_configured", "profile_last_checked_at", "profile_visibility", "provider", "refresh_token", "steam_id", "uid", "updated_at", "user_id") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13) RETURNING "id"[0m  [["access_token", "[FILTERED]"], ["created_at", "2026-01-18 03:28:15.318558"], ["expires_at", nil], ["extra_info", "{}"], ["profile_configured", false], ["profile_last_checked_at", nil], ["profile_visibility", "unknown"], ["provider", "steam"], ["refresh_token", "[FILTERED]"], ["steam_id", "76561198087654321"], ["uid", "76561198087654321"], ["updated_at", "2026-01-18 03:28:15.318558"], ["user_id", 980190964]]
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mIdentity Load (0.3ms)[0m  [1m[34mSELECT "identities".* FROM "identities" WHERE "identities"."user_id" = $1 AND "identities"."provider" = $2 LIMIT $3[0m  [["user_id", 980190964], ["provider", "steam"], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mIdentity Update (0.2ms)[0m  [1m[33mUPDATE "identities" SET "profile_configured" = $1, "profile_last_checked_at" = $2, "profile_visibility" = $3, "updated_at" = $4 WHERE "identities"."id" = $5[0m  [["profile_configured", true], ["profile_last_checked_at", "2026-01-18 03:28:15.320798"], ["profile_visibility", "private"], ["updated_at", "2026-01-18 03:28:15.323074"], ["id", 980190964]]
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Redirected to http://www.example.com/
Completed 302 Found in 7ms (ActiveRecord: 3.8ms (7 queries, 0 cached) | GC: 0.0ms)
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."id" = $1 LIMIT $2[0m  [["id", 980190964], ["LIMIT", 1]]
  [1m[36mIdentity Load (0.1ms)[0m  [1m[34mSELECT "identities".* FROM "identities" WHERE "identities"."user_id" = $1 AND "identities"."provider" = $2 LIMIT $3[0m  [["user_id", 980190964], ["provider", "steam"], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mBEGIN[0m
-----------------------------------------------------------------------------------
SessionsControllerTest: test_should_handle_steam_oauth_callback_with_public_profile
-----------------------------------------------------------------------------------
Started GET "/auth/steam/callback" for 127.0.0.1 at 2026-01-17 21:28:15 -0600
Processing by SessionsController#create as HTML
  Parameters: {"provider"=>"steam"}
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."provider" = $1 AND "users"."uid" = $2 LIMIT $3[0m  [["provider", "steam"], ["uid", "76561198012345678"], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Create (0.2ms)[0m  [1m[32mINSERT INTO "users" ("avatar_url", "created_at", "email", "provider", "uid", "updated_at", "username") VALUES ($1, $2, $3, $4, $5, $6, $7) RETURNING "id"[0m  [["avatar_url", "https://steamcdn-a.akamaihd.net/steamcommunity/public/images/avatars/fe/fef.jpg"], ["created_at", "2026-01-18 03:28:15.325769"], ["email", "[FILTERED]"], ["provider", "steam"], ["uid", "76561198012345678"], ["updated_at", "2026-01-18 03:28:15.325769"], ["username", "TestSteamUser"]]
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mIdentity Load (0.1ms)[0m  [1m[34mSELECT "identities".* FROM "identities" WHERE "identities"."provider" = $1 AND "identities"."uid" = $2 LIMIT $3[0m  [["provider", "steam"], ["uid", "76561198012345678"], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mIdentity Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "identities" WHERE "identities"."uid" = $1 AND "identities"."provider" = $2 LIMIT $3[0m  [["uid", "76561198012345678"], ["provider", "steam"], ["LIMIT", 1]]
  [1m[36mIdentity Create (0.1ms)[0m  [1m[32mINSERT INTO "identities" ("access_token", "created_at", "expires_at", "extra_info", "profile_configured", "profile_last_checked_at", "profile_visibility", "provider", "refresh_token", "steam_id", "uid", "updated_at", "user_id") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13) RETURNING "id"[0m  [["access_token", "[FILTERED]"], ["created_at", "2026-01-18 03:28:15.326720"], ["expires_at", nil], ["extra_info", "{}"], ["profile_configured", false], ["profile_last_checked_at", nil], ["profile_visibility", "unknown"], ["provider", "steam"], ["refresh_token", "[FILTERED]"], ["steam_id", "76561198012345678"], ["uid", "76561198012345678"], ["updated_at", "2026-01-18 03:28:15.326720"], ["user_id", 980190965]]
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mIdentity Load (0.1ms)[0m  [1m[34mSELECT "identities".* FROM "identities" WHERE "identities"."user_id" = $1 AND "identities"."provider" = $2 LIMIT $3[0m  [["user_id", 980190965], ["provider", "steam"], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mIdentity Update (0.4ms)[0m  [1m[33mUPDATE "identities" SET "profile_configured" = $1, "profile_last_checked_at" = $2, "profile_visibility" = $3, "updated_at" = $4 WHERE "identities"."id" = $5[0m  [["profile_configured", true], ["profile_last_checked_at", "2026-01-18 03:28:15.327336"], ["profile_visibility", "public"], ["updated_at", "2026-01-18 03:28:15.327399"], ["id", 980190965]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Redirected to http://www.example.com/
Completed 302 Found in 3ms (ActiveRecord: 1.5ms (7 queries, 0 cached) | GC: 0.0ms)
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."id" = $1 LIMIT $2[0m  [["id", 980190965], ["LIMIT", 1]]
  [1m[36mIdentity Load (0.1ms)[0m  [1m[34mSELECT "identities".* FROM "identities" WHERE "identities"."user_id" = $1 AND "identities"."provider" = $2 LIMIT $3[0m  [["user_id", 980190965], ["provider", "steam"], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mBEGIN[0m
-----------------------------------------------------------------------------------
SessionsControllerTest: test_refresh_steam_profile_should_update_profile_visibility
-----------------------------------------------------------------------------------
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."id" = $1 LIMIT $2[0m  [["id", 980190962], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mIdentity Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "identities" WHERE "identities"."uid" = $1 AND "identities"."provider" = $2 LIMIT $3[0m  [["uid", "76561198033333333"], ["provider", "steam"], ["LIMIT", 1]]
  [1m[36mIdentity Create (0.3ms)[0m  [1m[32mINSERT INTO "identities" ("access_token", "created_at", "expires_at", "extra_info", "profile_configured", "profile_last_checked_at", "profile_visibility", "provider", "refresh_token", "steam_id", "uid", "updated_at", "user_id") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13) RETURNING "id"[0m  [["access_token", "[FILTERED]"], ["created_at", "2026-01-18 03:28:15.329872"], ["expires_at", nil], ["extra_info", nil], ["profile_configured", false], ["profile_last_checked_at", nil], ["profile_visibility", "private"], ["provider", "steam"], ["refresh_token", "[FILTERED]"], ["steam_id", "76561198033333333"], ["uid", "76561198033333333"], ["updated_at", "2026-01-18 03:28:15.329872"], ["user_id", 980190962]]
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Started POST "/steam/refresh_profile" for 127.0.0.1 at 2026-01-17 21:28:15 -0600
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mBEGIN[0m
-------------------------------------------------------------
SessionsControllerTest: test_should_destroy_session_on_logout
-------------------------------------------------------------
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."id" = $1 LIMIT $2[0m  [["id", 980190962], ["LIMIT", 1]]
Started DELETE "/logout" for 127.0.0.1 at 2026-01-17 21:28:15 -0600
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mBEGIN[0m
-----------------------------------------------------------------
SessionsControllerTest: test_should_handle_authentication_failure
-----------------------------------------------------------------
Started GET "/auth/failure?message=invalid_credentials" for 127.0.0.1 at 2026-01-17 21:28:15 -0600
Processing by SessionsController#failure as HTML
  Parameters: {"message"=>"invalid_credentials"}
Redirected to http://www.example.com/
Completed 302 Found in 0ms (ActiveRecord: 0.0ms (0 queries, 0 cached) | GC: 0.0ms)
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mBEGIN[0m
-----------------------------------------------------------------------------------------
SessionsControllerTest: test_refresh_steam_profile_should_handle_missing_steam_connection
-----------------------------------------------------------------------------------------
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."id" = $1 LIMIT $2[0m  [["id", 980190962], ["LIMIT", 1]]
Started POST "/steam/refresh_profile" for 127.0.0.1 at 2026-01-17 21:28:15 -0600
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mBEGIN[0m
-----------------------------------------------------------------------------------
SessionsControllerTest: test_should_handle_steam_oauth_callback_when_API_call_fails
-----------------------------------------------------------------------------------
Started GET "/auth/steam/callback" for 127.0.0.1 at 2026-01-17 21:28:15 -0600
Processing by SessionsController#create as HTML
  Parameters: {"provider"=>"steam"}
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."provider" = $1 AND "users"."uid" = $2 LIMIT $3[0m  [["provider", "steam"], ["uid", "76561198022222222"], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Create (0.2ms)[0m  [1m[32mINSERT INTO "users" ("avatar_url", "created_at", "email", "provider", "uid", "updated_at", "username") VALUES ($1, $2, $3, $4, $5, $6, $7) RETURNING "id"[0m  [["avatar_url", nil], ["created_at", "2026-01-18 03:28:15.337166"], ["email", "[FILTERED]"], ["provider", "steam"], ["uid", "76561198022222222"], ["updated_at", "2026-01-18 03:28:15.337166"], ["username", "TestSteamUser4"]]
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mIdentity Load (0.1ms)[0m  [1m[34mSELECT "identities".* FROM "identities" WHERE "identities"."provider" = $1 AND "identities"."uid" = $2 LIMIT $3[0m  [["provider", "steam"], ["uid", "76561198022222222"], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mIdentity Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "identities" WHERE "identities"."uid" = $1 AND "identities"."provider" = $2 LIMIT $3[0m  [["uid", "76561198022222222"], ["provider", "steam"], ["LIMIT", 1]]
  [1m[36mIdentity Create (0.2ms)[0m  [1m[32mINSERT INTO "identities" ("access_token", "created_at", "expires_at", "extra_info", "profile_configured", "profile_last_checked_at", "profile_visibility", "provider", "refresh_token", "steam_id", "uid", "updated_at", "user_id") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13) RETURNING "id"[0m  [["access_token", "[FILTERED]"], ["created_at", "2026-01-18 03:28:15.338345"], ["expires_at", nil], ["extra_info", "{}"], ["profile_configured", false], ["profile_last_checked_at", nil], ["profile_visibility", "unknown"], ["provider", "steam"], ["refresh_token", "[FILTERED]"], ["steam_id", "76561198022222222"], ["uid", "76561198022222222"], ["updated_at", "2026-01-18 03:28:15.338345"], ["user_id", 980190966]]
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mIdentity Load (0.1ms)[0m  [1m[34mSELECT "identities".* FROM "identities" WHERE "identities"."user_id" = $1 AND "identities"."provider" = $2 LIMIT $3[0m  [["user_id", 980190966], ["provider", "steam"], ["LIMIT", 1]]
Redirected to http://www.example.com/
Completed 302 Found in 2ms (ActiveRecord: 1.1ms (6 queries, 0 cached) | GC: 0.0ms)
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mBEGIN[0m
-----------------------------------------------------------------------------------------
SessionsControllerTest: test_should_handle_steam_oauth_callback_with_unconfigured_profile
-----------------------------------------------------------------------------------------
Started GET "/auth/steam/callback" for 127.0.0.1 at 2026-01-17 21:28:15 -0600
Processing by SessionsController#create as HTML
  Parameters: {"provider"=>"steam"}
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."provider" = $1 AND "users"."uid" = $2 LIMIT $3[0m  [["provider", "steam"], ["uid", "76561198011111111"], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO "users" ("avatar_url", "created_at", "email", "provider", "uid", "updated_at", "username") VALUES ($1, $2, $3, $4, $5, $6, $7) RETURNING "id"[0m  [["avatar_url", nil], ["created_at", "2026-01-18 03:28:15.340247"], ["email", "[FILTERED]"], ["provider", "steam"], ["uid", "76561198011111111"], ["updated_at", "2026-01-18 03:28:15.340247"], ["username", "TestSteamUser3"]]
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mIdentity Load (0.1ms)[0m  [1m[34mSELECT "identities".* FROM "identities" WHERE "identities"."provider" = $1 AND "identities"."uid" = $2 LIMIT $3[0m  [["provider", "steam"], ["uid", "76561198011111111"], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mIdentity Exists? (0.1ms)[0m  [1m[34mSELECT 1 AS one FROM "identities" WHERE "identities"."uid" = $1 AND "identities"."provider" = $2 LIMIT $3[0m  [["uid", "76561198011111111"], ["provider", "steam"], ["LIMIT", 1]]
  [1m[36mIdentity Create (0.2ms)[0m  [1m[32mINSERT INTO "identities" ("access_token", "created_at", "expires_at", "extra_info", "profile_configured", "profile_last_checked_at", "profile_visibility", "provider", "refresh_token", "steam_id", "uid", "updated_at", "user_id") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13) RETURNING "id"[0m  [["access_token", "[FILTERED]"], ["created_at", "2026-01-18 03:28:15.341019"], ["expires_at", nil], ["extra_info", "{}"], ["profile_configured", false], ["profile_last_checked_at", nil], ["profile_visibility", "unknown"], ["provider", "steam"], ["refresh_token", "[FILTERED]"], ["steam_id", "76561198011111111"], ["uid", "76561198011111111"], ["updated_at", "2026-01-18 03:28:15.341019"], ["user_id", 980190967]]
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mIdentity Load (0.1ms)[0m  [1m[34mSELECT "identities".* FROM "identities" WHERE "identities"."user_id" = $1 AND "identities"."provider" = $2 LIMIT $3[0m  [["user_id", 980190967], ["provider", "steam"], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mIdentity Update (0.2ms)[0m  [1m[33mUPDATE "identities" SET "profile_last_checked_at" = $1, "profile_visibility" = $2, "updated_at" = $3 WHERE "identities"."id" = $4[0m  [["profile_last_checked_at", "2026-01-18 03:28:15.341640"], ["profile_visibility", "public"], ["updated_at", "2026-01-18 03:28:15.341713"], ["id", 980190968]]
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Redirected to http://www.example.com/
Completed 302 Found in 2ms (ActiveRecord: 1.1ms (7 queries, 0 cached) | GC: 0.0ms)
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.9ms)[0m  [1m[34mSELECT * FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 ORDER BY "ar_internal_metadata"."key" ASC LIMIT 1[0m  [[nil, "schema_sha1"]]
  [1m[36mActiveRecord::SchemaMigration Load (0.7ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.8ms)[0m  [1m[35mALTER TABLE "identities" DISABLE TRIGGER ALL;ALTER TABLE "user_games" DISABLE TRIGGER ALL;ALTER TABLE "games" DISABLE TRIGGER ALL;ALTER TABLE "recommendations" DISABLE TRIGGER ALL;ALTER TABLE "users" DISABLE TRIGGER ALL;ALTER TABLE "game_services" DISABLE TRIGGER ALL;ALTER TABLE "schema_migrations" DISABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" DISABLE TRIGGER ALL[0m
  [1m[36mFixtures Load (3.4ms)[0m  [1m[31mDELETE FROM "game_services";
DELETE FROM "games";
DELETE FROM "identities";
DELETE FROM "recommendations";
DELETE FROM "user_games";
DELETE FROM "users";
INSERT INTO "game_services" ("id", "access_token", "created_at", "refresh_token", "service_name", "token_expires_at", "updated_at", "user_id") VALUES (980190962, 'MyText', '2026-01-18 03:28:27.666917', 'MyText', 'MyString', '2026-01-14 05:40:08', '2026-01-18 03:28:27.666917', 980190962), (298486374, 'MyText', '2026-01-18 03:28:27.666917', 'MyText', 'MyString', '2026-01-14 05:40:08', '2026-01-18 03:28:27.666917', 298486374);
INSERT INTO "games" ("id", "created_at", "description", "developer", "external_id", "genre", "platform", "publisher", "release_date", "title", "updated_at") VALUES (980190962, '2026-01-18 03:28:27.673822', 'MyText', 'MyString', 'MyString', 'MyString', 'MyString', 'MyString', '2026-01-14', 'MyString', '2026-01-18 03:28:27.673822'), (298486374, '2026-01-18 03:28:27.673822', 'MyText', 'MyString', 'MyString', 'MyString', 'MyString', 'MyString', '2026-01-14', 'MyString', '2026-01-18 03:28:27.673822');
INSERT INTO "identities" ("id", "access_token", "created_at", "expires_at", "extra_info", "profile_configured", "profile_last_checked_at", "profile_visibility", "provider", "refresh_token", "steam_id", "uid", "updated_at", "user_id") VALUES (980190962, 'test_token_1', '2026-01-18 03:28:27.676883', '2026-01-19 03:28:27', '{}', DEFAULT, DEFAULT, DEFAULT, 'google', 'refresh_token_1', DEFAULT, '12345', '2026-01-18 03:28:27.676883', 980190962), (298486374, 'test_token_2', '2026-01-18 03:28:27.676883', NULL, '{}', DEFAULT, DEFAULT, DEFAULT, 'steam', NULL, DEFAULT, '67890', '2026-01-18 03:28:27.676883', 298486374);
INSERT INTO "recommendations" ("id", "ai_model", "created_at", "game_id", "reason", "score", "updated_at", "user_id") VALUES (980190962, 'MyString', '2026-01-18 03:28:27.679061', 980190962, 'MyText', 9.99, '2026-01-18 03:28:27.679061', 980190962), (298486374, 'MyString', '2026-01-18 03:28:27.679061', 298486374, 'MyText', 9.99, '2026-01-18 03:28:27.679061', 298486374);
INSERT INTO "user_games" ("id", "completion_percentage", "created_at", "game_id", "hours_played", "notes", "priority", "status", "updated_at", "user_id") VALUES (980190962, 1, '2026-01-18 03:28:27.680638', 980190962, 9.99, 'MyText', 1, 'MyString', '2026-01-18 03:28:27.680638', 980190962), (298486374, 1, '2026-01-18 03:28:27.680638', 298486374, 9.99, 'MyText', 1, 'MyString', '2026-01-18 03:28:27.680638', 298486374);
INSERT INTO "users" ("id", "avatar_url", "created_at", "email", "provider", "uid", "updated_at", "username") VALUES (980190962, DEFAULT, '2026-01-18 03:28:27.682720', 'user1@example.com', 'google_oauth2', '12345', '2026-01-18 03:28:27.682720', 'testuser1'), (298486374, DEFAULT, '2026-01-18 03:28:27.682720', 'user2@example.com', 'facebook', '67890', '2026-01-18 03:28:27.682720', 'testuser2')[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35m (0.4ms)[0m  [1m[35mALTER TABLE "identities" ENABLE TRIGGER ALL;ALTER TABLE "user_games" ENABLE TRIGGER ALL;ALTER TABLE "games" ENABLE TRIGGER ALL;ALTER TABLE "recommendations" ENABLE TRIGGER ALL;ALTER TABLE "users" ENABLE TRIGGER ALL;ALTER TABLE "game_services" ENABLE TRIGGER ALL;ALTER TABLE "schema_migrations" ENABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" ENABLE TRIGGER ALL[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (6.2ms)[0m  [1m[35mdo $$
  declare r record;
BEGIN
FOR r IN (
  SELECT FORMAT(
    'UPDATE pg_catalog.pg_constraint SET convalidated=false WHERE conname = ''%1$I'' AND connamespace::regnamespace = ''%2$I''::regnamespace; ALTER TABLE %2$I.%3$I VALIDATE CONSTRAINT %1$I;',
    constraint_name,
    table_schema,
    table_name
  ) AS constraint_check
  FROM information_schema.table_constraints WHERE constraint_type = 'FOREIGN KEY'
)
  LOOP
    EXECUTE (r.constraint_check);
  END LOOP;
END;
$$;
[0m
  [1m[36mTRANSACTION (0.4ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mBEGIN[0m
-----------------------------------------------------------------------------------
SessionsControllerTest: test_refresh_steam_profile_should_update_profile_visibility
-----------------------------------------------------------------------------------
  [1m[36mUser Load (0.3ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."id" = $1 LIMIT $2[0m  [["id", 980190962], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mIdentity Exists? (0.3ms)[0m  [1m[34mSELECT 1 AS one FROM "identities" WHERE "identities"."uid" = $1 AND "identities"."provider" = $2 LIMIT $3[0m  [["uid", "76561198033333333"], ["provider", "steam"], ["LIMIT", 1]]
  [1m[36mIdentity Create (0.3ms)[0m  [1m[32mINSERT INTO "identities" ("access_token", "created_at", "expires_at", "extra_info", "profile_configured", "profile_last_checked_at", "profile_visibility", "provider", "refresh_token", "steam_id", "uid", "updated_at", "user_id") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13) RETURNING "id"[0m  [["access_token", "[FILTERED]"], ["created_at", "2026-01-18 03:28:27.722094"], ["expires_at", nil], ["extra_info", nil], ["profile_configured", false], ["profile_last_checked_at", nil], ["profile_visibility", "private"], ["provider", "steam"], ["refresh_token", "[FILTERED]"], ["steam_id", "76561198033333333"], ["uid", "76561198033333333"], ["updated_at", "2026-01-18 03:28:27.722094"], ["user_id", 980190962]]
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Started POST "/steam/refresh_profile" for 127.0.0.1 at 2026-01-17 21:28:27 -0600
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mBEGIN[0m
------------------------------------------------------------------------------------
SessionsControllerTest: test_should_handle_steam_oauth_callback_with_private_profile
------------------------------------------------------------------------------------
Started GET "/auth/steam/callback" for 127.0.0.1 at 2026-01-17 21:28:27 -0600
Processing by SessionsController#create as HTML
  Parameters: {"provider"=>"steam"}
  [1m[36mUser Load (0.3ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."provider" = $1 AND "users"."uid" = $2 LIMIT $3[0m  [["provider", "steam"], ["uid", "76561198087654321"], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Create (0.3ms)[0m  [1m[32mINSERT INTO "users" ("avatar_url", "created_at", "email", "provider", "uid", "updated_at", "username") VALUES ($1, $2, $3, $4, $5, $6, $7) RETURNING "id"[0m  [["avatar_url", nil], ["created_at", "2026-01-18 03:28:27.741509"], ["email", "[FILTERED]"], ["provider", "steam"], ["uid", "76561198087654321"], ["updated_at", "2026-01-18 03:28:27.741509"], ["username", "TestSteamUser2"]]
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mIdentity Load (0.2ms)[0m  [1m[34mSELECT "identities".* FROM "identities" WHERE "identities"."provider" = $1 AND "identities"."uid" = $2 LIMIT $3[0m  [["provider", "steam"], ["uid", "76561198087654321"], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mIdentity Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "identities" WHERE "identities"."uid" = $1 AND "identities"."provider" = $2 LIMIT $3[0m  [["uid", "76561198087654321"], ["provider", "steam"], ["LIMIT", 1]]
  [1m[36mIdentity Create (0.3ms)[0m  [1m[32mINSERT INTO "identities" ("access_token", "created_at", "expires_at", "extra_info", "profile_configured", "profile_last_checked_at", "profile_visibility", "provider", "refresh_token", "steam_id", "uid", "updated_at", "user_id") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13) RETURNING "id"[0m  [["access_token", "[FILTERED]"], ["created_at", "2026-01-18 03:28:27.742994"], ["expires_at", nil], ["extra_info", "{}"], ["profile_configured", false], ["profile_last_checked_at", nil], ["profile_visibility", "unknown"], ["provider", "steam"], ["refresh_token", "[FILTERED]"], ["steam_id", "76561198087654321"], ["uid", "76561198087654321"], ["updated_at", "2026-01-18 03:28:27.742994"], ["user_id", 980190963]]
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mIdentity Load (0.2ms)[0m  [1m[34mSELECT "identities".* FROM "identities" WHERE "identities"."user_id" = $1 AND "identities"."provider" = $2 LIMIT $3[0m  [["user_id", 980190963], ["provider", "steam"], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mIdentity Update (0.2ms)[0m  [1m[33mUPDATE "identities" SET "profile_configured" = $1, "profile_last_checked_at" = $2, "profile_visibility" = $3, "updated_at" = $4 WHERE "identities"."id" = $5[0m  [["profile_configured", true], ["profile_last_checked_at", "2026-01-18 03:28:27.745580"], ["profile_visibility", "private"], ["updated_at", "2026-01-18 03:28:27.747076"], ["id", 980190964]]
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Redirected to http://www.example.com/
Completed 302 Found in 10ms (ActiveRecord: 3.1ms (7 queries, 0 cached) | GC: 0.0ms)
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."id" = $1 LIMIT $2[0m  [["id", 980190963], ["LIMIT", 1]]
  [1m[36mIdentity Load (0.1ms)[0m  [1m[34mSELECT "identities".* FROM "identities" WHERE "identities"."user_id" = $1 AND "identities"."provider" = $2 LIMIT $3[0m  [["user_id", 980190963], ["provider", "steam"], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mBEGIN[0m
-------------------------------------------------------------
SessionsControllerTest: test_should_destroy_session_on_logout
-------------------------------------------------------------
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."id" = $1 LIMIT $2[0m  [["id", 980190962], ["LIMIT", 1]]
Started DELETE "/logout" for 127.0.0.1 at 2026-01-17 21:28:27 -0600
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mBEGIN[0m
-----------------------------------------------------------------
SessionsControllerTest: test_should_handle_authentication_failure
-----------------------------------------------------------------
Started GET "/auth/failure?message=invalid_credentials" for 127.0.0.1 at 2026-01-17 21:28:27 -0600
Processing by SessionsController#failure as HTML
  Parameters: {"message"=>"invalid_credentials"}
Redirected to http://www.example.com/
Completed 302 Found in 0ms (ActiveRecord: 0.0ms (0 queries, 0 cached) | GC: 0.0ms)
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
-----------------------------------------------------------------------------------
SessionsControllerTest: test_should_handle_steam_oauth_callback_when_API_call_fails
-----------------------------------------------------------------------------------
Started GET "/auth/steam/callback" for 127.0.0.1 at 2026-01-17 21:28:27 -0600
Processing by SessionsController#create as HTML
  Parameters: {"provider"=>"steam"}
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."provider" = $1 AND "users"."uid" = $2 LIMIT $3[0m  [["provider", "steam"], ["uid", "76561198022222222"], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Create (0.2ms)[0m  [1m[32mINSERT INTO "users" ("avatar_url", "created_at", "email", "provider", "uid", "updated_at", "username") VALUES ($1, $2, $3, $4, $5, $6, $7) RETURNING "id"[0m  [["avatar_url", nil], ["created_at", "2026-01-18 03:28:27.753920"], ["email", "[FILTERED]"], ["provider", "steam"], ["uid", "76561198022222222"], ["updated_at", "2026-01-18 03:28:27.753920"], ["username", "TestSteamUser4"]]
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mIdentity Load (0.1ms)[0m  [1m[34mSELECT "identities".* FROM "identities" WHERE "identities"."provider" = $1 AND "identities"."uid" = $2 LIMIT $3[0m  [["provider", "steam"], ["uid", "76561198022222222"], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mIdentity Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "identities" WHERE "identities"."uid" = $1 AND "identities"."provider" = $2 LIMIT $3[0m  [["uid", "76561198022222222"], ["provider", "steam"], ["LIMIT", 1]]
  [1m[36mIdentity Create (0.2ms)[0m  [1m[32mINSERT INTO "identities" ("access_token", "created_at", "expires_at", "extra_info", "profile_configured", "profile_last_checked_at", "profile_visibility", "provider", "refresh_token", "steam_id", "uid", "updated_at", "user_id") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13) RETURNING "id"[0m  [["access_token", "[FILTERED]"], ["created_at", "2026-01-18 03:28:27.755062"], ["expires_at", nil], ["extra_info", "{}"], ["profile_configured", false], ["profile_last_checked_at", nil], ["profile_visibility", "unknown"], ["provider", "steam"], ["refresh_token", "[FILTERED]"], ["steam_id", "76561198022222222"], ["uid", "76561198022222222"], ["updated_at", "2026-01-18 03:28:27.755062"], ["user_id", 980190964]]
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mIdentity Load (0.1ms)[0m  [1m[34mSELECT "identities".* FROM "identities" WHERE "identities"."user_id" = $1 AND "identities"."provider" = $2 LIMIT $3[0m  [["user_id", 980190964], ["provider", "steam"], ["LIMIT", 1]]
Redirected to http://www.example.com/
Completed 302 Found in 2ms (ActiveRecord: 1.1ms (6 queries, 0 cached) | GC: 0.0ms)
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mBEGIN[0m
-----------------------------------------------------------------------------------------
SessionsControllerTest: test_refresh_steam_profile_should_handle_missing_steam_connection
-----------------------------------------------------------------------------------------
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."id" = $1 LIMIT $2[0m  [["id", 980190962], ["LIMIT", 1]]
Started POST "/steam/refresh_profile" for 127.0.0.1 at 2026-01-17 21:28:27 -0600
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mBEGIN[0m
-----------------------------------------------------------------------------------
SessionsControllerTest: test_should_handle_steam_oauth_callback_with_public_profile
-----------------------------------------------------------------------------------
Started GET "/auth/steam/callback" for 127.0.0.1 at 2026-01-17 21:28:27 -0600
Processing by SessionsController#create as HTML
  Parameters: {"provider"=>"steam"}
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."provider" = $1 AND "users"."uid" = $2 LIMIT $3[0m  [["provider", "steam"], ["uid", "76561198012345678"], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Create (0.2ms)[0m  [1m[32mINSERT INTO "users" ("avatar_url", "created_at", "email", "provider", "uid", "updated_at", "username") VALUES ($1, $2, $3, $4, $5, $6, $7) RETURNING "id"[0m  [["avatar_url", "https://steamcdn-a.akamaihd.net/steamcommunity/public/images/avatars/fe/fef.jpg"], ["created_at", "2026-01-18 03:28:27.758230"], ["email", "[FILTERED]"], ["provider", "steam"], ["uid", "76561198012345678"], ["updated_at", "2026-01-18 03:28:27.758230"], ["username", "TestSteamUser"]]
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mIdentity Load (0.1ms)[0m  [1m[34mSELECT "identities".* FROM "identities" WHERE "identities"."provider" = $1 AND "identities"."uid" = $2 LIMIT $3[0m  [["provider", "steam"], ["uid", "76561198012345678"], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mIdentity Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "identities" WHERE "identities"."uid" = $1 AND "identities"."provider" = $2 LIMIT $3[0m  [["uid", "76561198012345678"], ["provider", "steam"], ["LIMIT", 1]]
  [1m[36mIdentity Create (0.3ms)[0m  [1m[32mINSERT INTO "identities" ("access_token", "created_at", "expires_at", "extra_info", "profile_configured", "profile_last_checked_at", "profile_visibility", "provider", "refresh_token", "steam_id", "uid", "updated_at", "user_id") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13) RETURNING "id"[0m  [["access_token", "[FILTERED]"], ["created_at", "2026-01-18 03:28:27.759330"], ["expires_at", nil], ["extra_info", "{}"], ["profile_configured", false], ["profile_last_checked_at", nil], ["profile_visibility", "unknown"], ["provider", "steam"], ["refresh_token", "[FILTERED]"], ["steam_id", "76561198012345678"], ["uid", "76561198012345678"], ["updated_at", "2026-01-18 03:28:27.759330"], ["user_id", 980190965]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mIdentity Load (0.1ms)[0m  [1m[34mSELECT "identities".* FROM "identities" WHERE "identities"."user_id" = $1 AND "identities"."provider" = $2 LIMIT $3[0m  [["user_id", 980190965], ["provider", "steam"], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mIdentity Update (0.2ms)[0m  [1m[33mUPDATE "identities" SET "profile_configured" = $1, "profile_last_checked_at" = $2, "profile_visibility" = $3, "updated_at" = $4 WHERE "identities"."id" = $5[0m  [["profile_configured", true], ["profile_last_checked_at", "2026-01-18 03:28:27.760180"], ["profile_visibility", "public"], ["updated_at", "2026-01-18 03:28:27.760246"], ["id", 980190966]]
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Redirected to http://www.example.com/
Completed 302 Found in 3ms (ActiveRecord: 1.6ms (7 queries, 0 cached) | GC: 0.0ms)
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."id" = $1 LIMIT $2[0m  [["id", 980190965], ["LIMIT", 1]]
  [1m[36mIdentity Load (0.1ms)[0m  [1m[34mSELECT "identities".* FROM "identities" WHERE "identities"."user_id" = $1 AND "identities"."provider" = $2 LIMIT $3[0m  [["user_id", 980190965], ["provider", "steam"], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mBEGIN[0m
-----------------------------------------------------------------------------------------
SessionsControllerTest: test_should_handle_steam_oauth_callback_with_unconfigured_profile
-----------------------------------------------------------------------------------------
Started GET "/auth/steam/callback" for 127.0.0.1 at 2026-01-17 21:28:27 -0600
Processing by SessionsController#create as HTML
  Parameters: {"provider"=>"steam"}
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."provider" = $1 AND "users"."uid" = $2 LIMIT $3[0m  [["provider", "steam"], ["uid", "76561198011111111"], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Create (0.2ms)[0m  [1m[32mINSERT INTO "users" ("avatar_url", "created_at", "email", "provider", "uid", "updated_at", "username") VALUES ($1, $2, $3, $4, $5, $6, $7) RETURNING "id"[0m  [["avatar_url", nil], ["created_at", "2026-01-18 03:28:27.763029"], ["email", "[FILTERED]"], ["provider", "steam"], ["uid", "76561198011111111"], ["updated_at", "2026-01-18 03:28:27.763029"], ["username", "TestSteamUser3"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mIdentity Load (0.2ms)[0m  [1m[34mSELECT "identities".* FROM "identities" WHERE "identities"."provider" = $1 AND "identities"."uid" = $2 LIMIT $3[0m  [["provider", "steam"], ["uid", "76561198011111111"], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mIdentity Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "identities" WHERE "identities"."uid" = $1 AND "identities"."provider" = $2 LIMIT $3[0m  [["uid", "76561198011111111"], ["provider", "steam"], ["LIMIT", 1]]
  [1m[36mIdentity Create (0.2ms)[0m  [1m[32mINSERT INTO "identities" ("access_token", "created_at", "expires_at", "extra_info", "profile_configured", "profile_last_checked_at", "profile_visibility", "provider", "refresh_token", "steam_id", "uid", "updated_at", "user_id") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13) RETURNING "id"[0m  [["access_token", "[FILTERED]"], ["created_at", "2026-01-18 03:28:27.764181"], ["expires_at", nil], ["extra_info", "{}"], ["profile_configured", false], ["profile_last_checked_at", nil], ["profile_visibility", "unknown"], ["provider", "steam"], ["refresh_token", "[FILTERED]"], ["steam_id", "76561198011111111"], ["uid", "76561198011111111"], ["updated_at", "2026-01-18 03:28:27.764181"], ["user_id", 980190966]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mIdentity Load (0.1ms)[0m  [1m[34mSELECT "identities".* FROM "identities" WHERE "identities"."user_id" = $1 AND "identities"."provider" = $2 LIMIT $3[0m  [["user_id", 980190966], ["provider", "steam"], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mIdentity Update (0.3ms)[0m  [1m[33mUPDATE "identities" SET "profile_last_checked_at" = $1, "profile_visibility" = $2, "updated_at" = $3 WHERE "identities"."id" = $4[0m  [["profile_last_checked_at", "2026-01-18 03:28:27.764976"], ["profile_visibility", "public"], ["updated_at", "2026-01-18 03:28:27.765059"], ["id", 980190967]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Redirected to http://www.example.com/
Completed 302 Found in 3ms (ActiveRecord: 1.6ms (7 queries, 0 cached) | GC: 0.0ms)
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
----------------------------------------------------------------------
SessionsControllerTest: test_should_handle_oauth_callback_successfully
----------------------------------------------------------------------
Started GET "/auth/google_oauth2/callback" for 127.0.0.1 at 2026-01-17 21:28:27 -0600
Processing by SessionsController#create as HTML
  Parameters: {"provider"=>"google_oauth2"}
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."provider" = $1 AND "users"."uid" = $2 LIMIT $3[0m  [["provider", "google_oauth2"], ["uid", "12345"], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "users" WHERE "users"."email" = $1 AND "users"."id" != $2 LIMIT $3[0m  [["email", "[FILTERED]"], ["id", 980190962], ["LIMIT", 1]]
  [1m[36mUser Update (0.2ms)[0m  [1m[33mUPDATE "users" SET "avatar_url" = $1, "updated_at" = $2 WHERE "users"."id" = $3[0m  [["avatar_url", "https://example.com/avatar.jpg"], ["updated_at", "2026-01-18 03:28:27.769142"], ["id", 980190962]]
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mIdentity Load (0.1ms)[0m  [1m[34mSELECT "identities".* FROM "identities" WHERE "identities"."provider" = $1 AND "identities"."uid" = $2 LIMIT $3[0m  [["provider", "google_oauth2"], ["uid", "12345"], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mIdentity Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "identities" WHERE "identities"."uid" = $1 AND "identities"."provider" = $2 LIMIT $3[0m  [["uid", "12345"], ["provider", "google_oauth2"], ["LIMIT", 1]]
  [1m[36mIdentity Create (0.2ms)[0m  [1m[32mINSERT INTO "identities" ("access_token", "created_at", "expires_at", "extra_info", "profile_configured", "profile_last_checked_at", "profile_visibility", "provider", "refresh_token", "steam_id", "uid", "updated_at", "user_id") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13) RETURNING "id"[0m  [["access_token", "[FILTERED]"], ["created_at", "2026-01-18 03:28:27.770082"], ["expires_at", "2026-01-18 04:28:27"], ["extra_info", "{}"], ["profile_configured", false], ["profile_last_checked_at", nil], ["profile_visibility", "unknown"], ["provider", "google_oauth2"], ["refresh_token", "[FILTERED]"], ["steam_id", nil], ["uid", "12345"], ["updated_at", "2026-01-18 03:28:27.770082"], ["user_id", 980190962]]
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Redirected to http://www.example.com/
Completed 302 Found in 4ms (ActiveRecord: 2.7ms (6 queries, 0 cached) | GC: 0.0ms)
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mActiveRecord::InternalMetadata Load (1.2ms)[0m  [1m[34mSELECT * FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 ORDER BY "ar_internal_metadata"."key" ASC LIMIT 1[0m  [[nil, "schema_sha1"]]
  [1m[36mActiveRecord::SchemaMigration Load (0.7ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (1.0ms)[0m  [1m[35mALTER TABLE "identities" DISABLE TRIGGER ALL;ALTER TABLE "user_games" DISABLE TRIGGER ALL;ALTER TABLE "games" DISABLE TRIGGER ALL;ALTER TABLE "recommendations" DISABLE TRIGGER ALL;ALTER TABLE "users" DISABLE TRIGGER ALL;ALTER TABLE "game_services" DISABLE TRIGGER ALL;ALTER TABLE "schema_migrations" DISABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" DISABLE TRIGGER ALL[0m
  [1m[36mFixtures Load (3.9ms)[0m  [1m[31mDELETE FROM "game_services";
DELETE FROM "games";
DELETE FROM "identities";
DELETE FROM "recommendations";
DELETE FROM "user_games";
DELETE FROM "users";
INSERT INTO "game_services" ("id", "access_token", "created_at", "refresh_token", "service_name", "token_expires_at", "updated_at", "user_id") VALUES (980190962, 'MyText', '2026-01-18 03:28:51.252397', 'MyText', 'MyString', '2026-01-14 05:40:08', '2026-01-18 03:28:51.252397', 980190962), (298486374, 'MyText', '2026-01-18 03:28:51.252397', 'MyText', 'MyString', '2026-01-14 05:40:08', '2026-01-18 03:28:51.252397', 298486374);
INSERT INTO "games" ("id", "created_at", "description", "developer", "external_id", "genre", "platform", "publisher", "release_date", "title", "updated_at") VALUES (980190962, '2026-01-18 03:28:51.257870', 'MyText', 'MyString', 'MyString', 'MyString', 'MyString', 'MyString', '2026-01-14', 'MyString', '2026-01-18 03:28:51.257870'), (298486374, '2026-01-18 03:28:51.257870', 'MyText', 'MyString', 'MyString', 'MyString', 'MyString', 'MyString', '2026-01-14', 'MyString', '2026-01-18 03:28:51.257870');
INSERT INTO "identities" ("id", "access_token", "created_at", "expires_at", "extra_info", "profile_configured", "profile_last_checked_at", "profile_visibility", "provider", "refresh_token", "steam_id", "uid", "updated_at", "user_id") VALUES (980190962, 'test_token_1', '2026-01-18 03:28:51.259983', '2026-01-19 03:28:51', '{}', DEFAULT, DEFAULT, DEFAULT, 'google', 'refresh_token_1', DEFAULT, '12345', '2026-01-18 03:28:51.259983', 980190962), (298486374, 'test_token_2', '2026-01-18 03:28:51.259983', NULL, '{}', DEFAULT, DEFAULT, DEFAULT, 'steam', NULL, DEFAULT, '67890', '2026-01-18 03:28:51.259983', 298486374);
INSERT INTO "recommendations" ("id", "ai_model", "created_at", "game_id", "reason", "score", "updated_at", "user_id") VALUES (980190962, 'MyString', '2026-01-18 03:28:51.261314', 980190962, 'MyText', 9.99, '2026-01-18 03:28:51.261314', 980190962), (298486374, 'MyString', '2026-01-18 03:28:51.261314', 298486374, 'MyText', 9.99, '2026-01-18 03:28:51.261314', 298486374);
INSERT INTO "user_games" ("id", "completion_percentage", "created_at", "game_id", "hours_played", "notes", "priority", "status", "updated_at", "user_id") VALUES (980190962, 1, '2026-01-18 03:28:51.262086', 980190962, 9.99, 'MyText', 1, 'MyString', '2026-01-18 03:28:51.262086', 980190962), (298486374, 1, '2026-01-18 03:28:51.262086', 298486374, 9.99, 'MyText', 1, 'MyString', '2026-01-18 03:28:51.262086', 298486374);
INSERT INTO "users" ("id", "avatar_url", "created_at", "email", "provider", "uid", "updated_at", "username") VALUES (980190962, DEFAULT, '2026-01-18 03:28:51.262805', 'user1@example.com', 'google_oauth2', '12345', '2026-01-18 03:28:51.262805', 'testuser1'), (298486374, DEFAULT, '2026-01-18 03:28:51.262805', 'user2@example.com', 'facebook', '67890', '2026-01-18 03:28:51.262805', 'testuser2')[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35m (0.5ms)[0m  [1m[35mALTER TABLE "identities" ENABLE TRIGGER ALL;ALTER TABLE "user_games" ENABLE TRIGGER ALL;ALTER TABLE "games" ENABLE TRIGGER ALL;ALTER TABLE "recommendations" ENABLE TRIGGER ALL;ALTER TABLE "users" ENABLE TRIGGER ALL;ALTER TABLE "game_services" ENABLE TRIGGER ALL;ALTER TABLE "schema_migrations" ENABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" ENABLE TRIGGER ALL[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.6ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (7.7ms)[0m  [1m[35mdo $$
  declare r record;
BEGIN
FOR r IN (
  SELECT FORMAT(
    'UPDATE pg_catalog.pg_constraint SET convalidated=false WHERE conname = ''%1$I'' AND connamespace::regnamespace = ''%2$I''::regnamespace; ALTER TABLE %2$I.%3$I VALIDATE CONSTRAINT %1$I;',
    constraint_name,
    table_schema,
    table_name
  ) AS constraint_check
  FROM information_schema.table_constraints WHERE constraint_type = 'FOREIGN KEY'
)
  LOOP
    EXECUTE (r.constraint_check);
  END LOOP;
END;
$$;
[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mBEGIN[0m
-------------------------------------------------------------
SessionsControllerTest: test_should_destroy_session_on_logout
-------------------------------------------------------------
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.4ms)[0m  [1m[34mSELECT 1 AS one FROM "users" WHERE "users"."email" = $1 LIMIT $2[0m  [["email", "[FILTERED]"], ["LIMIT", 1]]
  [1m[36mUser Create (0.2ms)[0m  [1m[32mINSERT INTO "users" ("avatar_url", "created_at", "email", "provider", "uid", "updated_at", "username") VALUES ($1, $2, $3, $4, $5, $6, $7) RETURNING "id"[0m  [["avatar_url", nil], ["created_at", "2026-01-18 03:28:51.300952"], ["email", "[FILTERED]"], ["provider", "google_oauth2"], ["uid", "logout123"], ["updated_at", "2026-01-18 03:28:51.300952"], ["username", "logoutuser"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Started DELETE "/logout" for 127.0.0.1 at 2026-01-17 21:28:51 -0600
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mBEGIN[0m
-----------------------------------------------------------------------------------
SessionsControllerTest: test_should_handle_steam_oauth_callback_with_public_profile
-----------------------------------------------------------------------------------
Started GET "/auth/steam/callback" for 127.0.0.1 at 2026-01-17 21:28:51 -0600
Processing by SessionsController#create as HTML
  Parameters: {"provider"=>"steam"}
  [1m[36mUser Load (0.4ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."provider" = $1 AND "users"."uid" = $2 LIMIT $3[0m  [["provider", "steam"], ["uid", "76561198012345678"], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Create (0.2ms)[0m  [1m[32mINSERT INTO "users" ("avatar_url", "created_at", "email", "provider", "uid", "updated_at", "username") VALUES ($1, $2, $3, $4, $5, $6, $7) RETURNING "id"[0m  [["avatar_url", "https://steamcdn-a.akamaihd.net/steamcommunity/public/images/avatars/fe/fef.jpg"], ["created_at", "2026-01-18 03:28:51.342376"], ["email", "[FILTERED]"], ["provider", "steam"], ["uid", "76561198012345678"], ["updated_at", "2026-01-18 03:28:51.342376"], ["username", "TestSteamUser"]]
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mIdentity Load (0.2ms)[0m  [1m[34mSELECT "identities".* FROM "identities" WHERE "identities"."provider" = $1 AND "identities"."uid" = $2 LIMIT $3[0m  [["provider", "steam"], ["uid", "76561198012345678"], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mIdentity Exists? (0.3ms)[0m  [1m[34mSELECT 1 AS one FROM "identities" WHERE "identities"."uid" = $1 AND "identities"."provider" = $2 LIMIT $3[0m  [["uid", "76561198012345678"], ["provider", "steam"], ["LIMIT", 1]]
  [1m[36mIdentity Create (0.4ms)[0m  [1m[32mINSERT INTO "identities" ("access_token", "created_at", "expires_at", "extra_info", "profile_configured", "profile_last_checked_at", "profile_visibility", "provider", "refresh_token", "steam_id", "uid", "updated_at", "user_id") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13) RETURNING "id"[0m  [["access_token", "[FILTERED]"], ["created_at", "2026-01-18 03:28:51.347500"], ["expires_at", nil], ["extra_info", "{}"], ["profile_configured", false], ["profile_last_checked_at", nil], ["profile_visibility", "unknown"], ["provider", "steam"], ["refresh_token", "[FILTERED]"], ["steam_id", "76561198012345678"], ["uid", "76561198012345678"], ["updated_at", "2026-01-18 03:28:51.347500"], ["user_id", 980190964]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mIdentity Load (0.3ms)[0m  [1m[34mSELECT "identities".* FROM "identities" WHERE "identities"."user_id" = $1 AND "identities"."provider" = $2 LIMIT $3[0m  [["user_id", 980190964], ["provider", "steam"], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mIdentity Update (0.2ms)[0m  [1m[33mUPDATE "identities" SET "profile_configured" = $1, "profile_last_checked_at" = $2, "profile_visibility" = $3, "updated_at" = $4 WHERE "identities"."id" = $5[0m  [["profile_configured", true], ["profile_last_checked_at", "2026-01-18 03:28:51.350307"], ["profile_visibility", "public"], ["updated_at", "2026-01-18 03:28:51.353031"], ["id", 980190963]]
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Redirected to http://www.example.com/
Completed 302 Found in 20ms (ActiveRecord: 4.8ms (7 queries, 0 cached) | GC: 0.0ms)
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."id" = $1 LIMIT $2[0m  [["id", 980190964], ["LIMIT", 1]]
  [1m[36mIdentity Load (0.1ms)[0m  [1m[34mSELECT "identities".* FROM "identities" WHERE "identities"."user_id" = $1 AND "identities"."provider" = $2 LIMIT $3[0m  [["user_id", 980190964], ["provider", "steam"], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mBEGIN[0m
----------------------------------------------------------------------
SessionsControllerTest: test_should_handle_oauth_callback_successfully
----------------------------------------------------------------------
Started GET "/auth/google_oauth2/callback" for 127.0.0.1 at 2026-01-17 21:28:51 -0600
Processing by SessionsController#create as HTML
  Parameters: {"provider"=>"google_oauth2"}
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."provider" = $1 AND "users"."uid" = $2 LIMIT $3[0m  [["provider", "google_oauth2"], ["uid", "12345"], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "users" WHERE "users"."email" = $1 AND "users"."id" != $2 LIMIT $3[0m  [["email", "[FILTERED]"], ["id", 980190962], ["LIMIT", 1]]
  [1m[36mUser Update (0.2ms)[0m  [1m[33mUPDATE "users" SET "avatar_url" = $1, "updated_at" = $2 WHERE "users"."id" = $3[0m  [["avatar_url", "https://example.com/avatar.jpg"], ["updated_at", "2026-01-18 03:28:51.357715"], ["id", 980190962]]
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mIdentity Load (0.1ms)[0m  [1m[34mSELECT "identities".* FROM "identities" WHERE "identities"."provider" = $1 AND "identities"."uid" = $2 LIMIT $3[0m  [["provider", "google_oauth2"], ["uid", "12345"], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mIdentity Exists? (0.1ms)[0m  [1m[34mSELECT 1 AS one FROM "identities" WHERE "identities"."uid" = $1 AND "identities"."provider" = $2 LIMIT $3[0m  [["uid", "12345"], ["provider", "google_oauth2"], ["LIMIT", 1]]
  [1m[36mIdentity Create (0.2ms)[0m  [1m[32mINSERT INTO "identities" ("access_token", "created_at", "expires_at", "extra_info", "profile_configured", "profile_last_checked_at", "profile_visibility", "provider", "refresh_token", "steam_id", "uid", "updated_at", "user_id") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13) RETURNING "id"[0m  [["access_token", "[FILTERED]"], ["created_at", "2026-01-18 03:28:51.358655"], ["expires_at", "2026-01-18 04:28:51"], ["extra_info", "{}"], ["profile_configured", false], ["profile_last_checked_at", nil], ["profile_visibility", "unknown"], ["provider", "google_oauth2"], ["refresh_token", "[FILTERED]"], ["steam_id", nil], ["uid", "12345"], ["updated_at", "2026-01-18 03:28:51.358655"], ["user_id", 980190962]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Redirected to http://www.example.com/
Completed 302 Found in 3ms (ActiveRecord: 1.7ms (6 queries, 0 cached) | GC: 0.0ms)
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mBEGIN[0m
-----------------------------------------------------------------------------------
SessionsControllerTest: test_should_handle_steam_oauth_callback_when_API_call_fails
-----------------------------------------------------------------------------------
Started GET "/auth/steam/callback" for 127.0.0.1 at 2026-01-17 21:28:51 -0600
Processing by SessionsController#create as HTML
  Parameters: {"provider"=>"steam"}
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."provider" = $1 AND "users"."uid" = $2 LIMIT $3[0m  [["provider", "steam"], ["uid", "76561198022222222"], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Create (0.2ms)[0m  [1m[32mINSERT INTO "users" ("avatar_url", "created_at", "email", "provider", "uid", "updated_at", "username") VALUES ($1, $2, $3, $4, $5, $6, $7) RETURNING "id"[0m  [["avatar_url", nil], ["created_at", "2026-01-18 03:28:51.360560"], ["email", "[FILTERED]"], ["provider", "steam"], ["uid", "76561198022222222"], ["updated_at", "2026-01-18 03:28:51.360560"], ["username", "TestSteamUser4"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mIdentity Load (0.2ms)[0m  [1m[34mSELECT "identities".* FROM "identities" WHERE "identities"."provider" = $1 AND "identities"."uid" = $2 LIMIT $3[0m  [["provider", "steam"], ["uid", "76561198022222222"], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mIdentity Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "identities" WHERE "identities"."uid" = $1 AND "identities"."provider" = $2 LIMIT $3[0m  [["uid", "76561198022222222"], ["provider", "steam"], ["LIMIT", 1]]
  [1m[36mIdentity Create (0.1ms)[0m  [1m[32mINSERT INTO "identities" ("access_token", "created_at", "expires_at", "extra_info", "profile_configured", "profile_last_checked_at", "profile_visibility", "provider", "refresh_token", "steam_id", "uid", "updated_at", "user_id") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13) RETURNING "id"[0m  [["access_token", "[FILTERED]"], ["created_at", "2026-01-18 03:28:51.361789"], ["expires_at", nil], ["extra_info", "{}"], ["profile_configured", false], ["profile_last_checked_at", nil], ["profile_visibility", "unknown"], ["provider", "steam"], ["refresh_token", "[FILTERED]"], ["steam_id", "76561198022222222"], ["uid", "76561198022222222"], ["updated_at", "2026-01-18 03:28:51.361789"], ["user_id", 980190965]]
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mIdentity Load (0.1ms)[0m  [1m[34mSELECT "identities".* FROM "identities" WHERE "identities"."user_id" = $1 AND "identities"."provider" = $2 LIMIT $3[0m  [["user_id", 980190965], ["provider", "steam"], ["LIMIT", 1]]
Redirected to http://www.example.com/
Completed 302 Found in 2ms (ActiveRecord: 1.0ms (6 queries, 0 cached) | GC: 0.0ms)
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mBEGIN[0m
------------------------------------------------------------------------------------
SessionsControllerTest: test_should_handle_steam_oauth_callback_with_private_profile
------------------------------------------------------------------------------------
Started GET "/auth/steam/callback" for 127.0.0.1 at 2026-01-17 21:28:51 -0600
Processing by SessionsController#create as HTML
  Parameters: {"provider"=>"steam"}
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."provider" = $1 AND "users"."uid" = $2 LIMIT $3[0m  [["provider", "steam"], ["uid", "76561198087654321"], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Create (0.2ms)[0m  [1m[32mINSERT INTO "users" ("avatar_url", "created_at", "email", "provider", "uid", "updated_at", "username") VALUES ($1, $2, $3, $4, $5, $6, $7) RETURNING "id"[0m  [["avatar_url", nil], ["created_at", "2026-01-18 03:28:51.364166"], ["email", "[FILTERED]"], ["provider", "steam"], ["uid", "76561198087654321"], ["updated_at", "2026-01-18 03:28:51.364166"], ["username", "TestSteamUser2"]]
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mIdentity Load (0.1ms)[0m  [1m[34mSELECT "identities".* FROM "identities" WHERE "identities"."provider" = $1 AND "identities"."uid" = $2 LIMIT $3[0m  [["provider", "steam"], ["uid", "76561198087654321"], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mIdentity Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "identities" WHERE "identities"."uid" = $1 AND "identities"."provider" = $2 LIMIT $3[0m  [["uid", "76561198087654321"], ["provider", "steam"], ["LIMIT", 1]]
  [1m[36mIdentity Create (0.2ms)[0m  [1m[32mINSERT INTO "identities" ("access_token", "created_at", "expires_at", "extra_info", "profile_configured", "profile_last_checked_at", "profile_visibility", "provider", "refresh_token", "steam_id", "uid", "updated_at", "user_id") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13) RETURNING "id"[0m  [["access_token", "[FILTERED]"], ["created_at", "2026-01-18 03:28:51.365147"], ["expires_at", nil], ["extra_info", "{}"], ["profile_configured", false], ["profile_last_checked_at", nil], ["profile_visibility", "unknown"], ["provider", "steam"], ["refresh_token", "[FILTERED]"], ["steam_id", "76561198087654321"], ["uid", "76561198087654321"], ["updated_at", "2026-01-18 03:28:51.365147"], ["user_id", 980190966]]
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mIdentity Load (0.1ms)[0m  [1m[34mSELECT "identities".* FROM "identities" WHERE "identities"."user_id" = $1 AND "identities"."provider" = $2 LIMIT $3[0m  [["user_id", 980190966], ["provider", "steam"], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mIdentity Update (0.3ms)[0m  [1m[33mUPDATE "identities" SET "profile_configured" = $1, "profile_last_checked_at" = $2, "profile_visibility" = $3, "updated_at" = $4 WHERE "identities"."id" = $5[0m  [["profile_configured", true], ["profile_last_checked_at", "2026-01-18 03:28:51.365913"], ["profile_visibility", "private"], ["updated_at", "2026-01-18 03:28:51.365976"], ["id", 980190966]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Redirected to http://www.example.com/
Completed 302 Found in 3ms (ActiveRecord: 1.5ms (7 queries, 0 cached) | GC: 0.0ms)
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."id" = $1 LIMIT $2[0m  [["id", 980190966], ["LIMIT", 1]]
  [1m[36mIdentity Load (0.1ms)[0m  [1m[34mSELECT "identities".* FROM "identities" WHERE "identities"."user_id" = $1 AND "identities"."provider" = $2 LIMIT $3[0m  [["user_id", 980190966], ["provider", "steam"], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
-----------------------------------------------------------------------------------
SessionsControllerTest: test_refresh_steam_profile_should_update_profile_visibility
-----------------------------------------------------------------------------------
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "users" WHERE "users"."email" = $1 LIMIT $2[0m  [["email", "[FILTERED]"], ["LIMIT", 1]]
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO "users" ("avatar_url", "created_at", "email", "provider", "uid", "updated_at", "username") VALUES ($1, $2, $3, $4, $5, $6, $7) RETURNING "id"[0m  [["avatar_url", nil], ["created_at", "2026-01-18 03:28:51.368055"], ["email", "[FILTERED]"], ["provider", "steam"], ["uid", "76561198033333333"], ["updated_at", "2026-01-18 03:28:51.368055"], ["username", "steamuser"]]
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mIdentity Exists? (0.1ms)[0m  [1m[34mSELECT 1 AS one FROM "identities" WHERE "identities"."uid" = $1 AND "identities"."provider" = $2 LIMIT $3[0m  [["uid", "76561198033333333"], ["provider", "steam"], ["LIMIT", 1]]
  [1m[36mIdentity Create (0.2ms)[0m  [1m[32mINSERT INTO "identities" ("access_token", "created_at", "expires_at", "extra_info", "profile_configured", "profile_last_checked_at", "profile_visibility", "provider", "refresh_token", "steam_id", "uid", "updated_at", "user_id") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13) RETURNING "id"[0m  [["access_token", "[FILTERED]"], ["created_at", "2026-01-18 03:28:51.368681"], ["expires_at", nil], ["extra_info", nil], ["profile_configured", false], ["profile_last_checked_at", nil], ["profile_visibility", "private"], ["provider", "steam"], ["refresh_token", "[FILTERED]"], ["steam_id", "76561198033333333"], ["uid", "76561198033333333"], ["updated_at", "2026-01-18 03:28:51.368681"], ["user_id", 980190967]]
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Started POST "/steam/refresh_profile" for 127.0.0.1 at 2026-01-17 21:28:51 -0600
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mBEGIN[0m
-----------------------------------------------------------------------------------------
SessionsControllerTest: test_should_handle_steam_oauth_callback_with_unconfigured_profile
-----------------------------------------------------------------------------------------
Started GET "/auth/steam/callback" for 127.0.0.1 at 2026-01-17 21:28:51 -0600
Processing by SessionsController#create as HTML
  Parameters: {"provider"=>"steam"}
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."provider" = $1 AND "users"."uid" = $2 LIMIT $3[0m  [["provider", "steam"], ["uid", "76561198011111111"], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Create (0.2ms)[0m  [1m[32mINSERT INTO "users" ("avatar_url", "created_at", "email", "provider", "uid", "updated_at", "username") VALUES ($1, $2, $3, $4, $5, $6, $7) RETURNING "id"[0m  [["avatar_url", nil], ["created_at", "2026-01-18 03:28:51.372180"], ["email", "[FILTERED]"], ["provider", "steam"], ["uid", "76561198011111111"], ["updated_at", "2026-01-18 03:28:51.372180"], ["username", "TestSteamUser3"]]
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mIdentity Load (0.1ms)[0m  [1m[34mSELECT "identities".* FROM "identities" WHERE "identities"."provider" = $1 AND "identities"."uid" = $2 LIMIT $3[0m  [["provider", "steam"], ["uid", "76561198011111111"], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mIdentity Exists? (0.1ms)[0m  [1m[34mSELECT 1 AS one FROM "identities" WHERE "identities"."uid" = $1 AND "identities"."provider" = $2 LIMIT $3[0m  [["uid", "76561198011111111"], ["provider", "steam"], ["LIMIT", 1]]
  [1m[36mIdentity Create (0.1ms)[0m  [1m[32mINSERT INTO "identities" ("access_token", "created_at", "expires_at", "extra_info", "profile_configured", "profile_last_checked_at", "profile_visibility", "provider", "refresh_token", "steam_id", "uid", "updated_at", "user_id") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13) RETURNING "id"[0m  [["access_token", "[FILTERED]"], ["created_at", "2026-01-18 03:28:51.373133"], ["expires_at", nil], ["extra_info", "{}"], ["profile_configured", false], ["profile_last_checked_at", nil], ["profile_visibility", "unknown"], ["provider", "steam"], ["refresh_token", "[FILTERED]"], ["steam_id", "76561198011111111"], ["uid", "76561198011111111"], ["updated_at", "2026-01-18 03:28:51.373133"], ["user_id", 980190968]]
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mIdentity Load (0.1ms)[0m  [1m[34mSELECT "identities".* FROM "identities" WHERE "identities"."user_id" = $1 AND "identities"."provider" = $2 LIMIT $3[0m  [["user_id", 980190968], ["provider", "steam"], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mIdentity Update (0.2ms)[0m  [1m[33mUPDATE "identities" SET "profile_last_checked_at" = $1, "profile_visibility" = $2, "updated_at" = $3 WHERE "identities"."id" = $4[0m  [["profile_last_checked_at", "2026-01-18 03:28:51.373823"], ["profile_visibility", "public"], ["updated_at", "2026-01-18 03:28:51.373898"], ["id", 980190968]]
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Redirected to http://www.example.com/
Completed 302 Found in 3ms (ActiveRecord: 1.2ms (7 queries, 0 cached) | GC: 0.0ms)
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mBEGIN[0m
-----------------------------------------------------------------------------------------
SessionsControllerTest: test_refresh_steam_profile_should_handle_missing_steam_connection
-----------------------------------------------------------------------------------------
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.1ms)[0m  [1m[34mSELECT 1 AS one FROM "users" WHERE "users"."email" = $1 LIMIT $2[0m  [["email", "[FILTERED]"], ["LIMIT", 1]]
  [1m[36mUser Create (0.2ms)[0m  [1m[32mINSERT INTO "users" ("avatar_url", "created_at", "email", "provider", "uid", "updated_at", "username") VALUES ($1, $2, $3, $4, $5, $6, $7) RETURNING "id"[0m  [["avatar_url", nil], ["created_at", "2026-01-18 03:28:51.375451"], ["email", "[FILTERED]"], ["provider", "google_oauth2"], ["uid", "nosteam123"], ["updated_at", "2026-01-18 03:28:51.375451"], ["username", "nosteamuser"]]
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Started POST "/steam/refresh_profile" for 127.0.0.1 at 2026-01-17 21:28:51 -0600
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mBEGIN[0m
-----------------------------------------------------------------
SessionsControllerTest: test_should_handle_authentication_failure
-----------------------------------------------------------------
Started GET "/auth/failure?message=invalid_credentials" for 127.0.0.1 at 2026-01-17 21:28:51 -0600
Processing by SessionsController#failure as HTML
  Parameters: {"message"=>"invalid_credentials"}
Redirected to http://www.example.com/
Completed 302 Found in 0ms (ActiveRecord: 0.0ms (0 queries, 0 cached) | GC: 0.0ms)
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mActiveRecord::SchemaMigration Load (0.6ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.8ms)[0m  [1m[34mSELECT * FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 ORDER BY "ar_internal_metadata"."key" ASC LIMIT 1[0m  [[nil, "environment"]]
  [1m[36mActiveRecord::SchemaMigration Load (0.1ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.1ms)[0m  [1m[34mSELECT * FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 ORDER BY "ar_internal_metadata"."key" ASC LIMIT 1[0m  [[nil, "environment"]]
  [1m[36mActiveRecord::SchemaMigration Load (0.1ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.1ms)[0m  [1m[34mSELECT * FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 ORDER BY "ar_internal_metadata"."key" ASC LIMIT 1[0m  [[nil, "environment"]]
  [1m[35mSQL (0.1ms)[0m  [1m[35mCREATE EXTENSION IF NOT EXISTS "plpgsql" SCHEMA pg_catalog[0m
  [1m[35m (2.5ms)[0m  [1m[35mDROP TABLE IF EXISTS "game_services" CASCADE[0m
  [1m[35m (6.0ms)[0m  [1m[35mCREATE TABLE "game_services" ("id" bigserial primary key, "access_token" text, "created_at" timestamp(6) NOT NULL, "refresh_token" text, "service_name" character varying, "token_expires_at" timestamp(6), "updated_at" timestamp(6) NOT NULL, "user_id" bigint NOT NULL)[0m
  [1m[35m (0.7ms)[0m  [1m[35mCREATE INDEX "index_game_services_on_user_id" ON "game_services" ("user_id")[0m
  [1m[35m (1.2ms)[0m  [1m[35mDROP TABLE IF EXISTS "games" CASCADE[0m
  [1m[35m (2.8ms)[0m  [1m[35mCREATE TABLE "games" ("id" bigserial primary key, "created_at" timestamp(6) NOT NULL, "description" text, "developer" character varying, "external_id" character varying, "genre" character varying, "platform" character varying, "publisher" character varying, "release_date" date, "title" character varying, "updated_at" timestamp(6) NOT NULL)[0m
  [1m[35m (3.0ms)[0m  [1m[35mDROP TABLE IF EXISTS "identities" CASCADE[0m
  [1m[35m (2.1ms)[0m  [1m[35mCREATE TABLE "identities" ("id" bigserial primary key, "access_token" character varying, "created_at" timestamp(6) NOT NULL, "expires_at" timestamp(6), "extra_info" json, "profile_configured" boolean DEFAULT FALSE, "profile_last_checked_at" timestamp(6), "profile_visibility" character varying DEFAULT 'unknown', "provider" character varying NOT NULL, "refresh_token" character varying, "steam_id" character varying, "uid" character varying NOT NULL, "updated_at" timestamp(6) NOT NULL, "user_id" bigint NOT NULL)[0m
  [1m[35m (0.8ms)[0m  [1m[35mCREATE UNIQUE INDEX "index_identities_on_provider_and_uid" ON "identities" ("provider", "uid")[0m
  [1m[35m (0.9ms)[0m  [1m[35mCREATE UNIQUE INDEX "index_identities_on_steam_id" ON "identities" ("steam_id") WHERE (steam_id IS NOT NULL)[0m
  [1m[35m (0.5ms)[0m  [1m[35mCREATE INDEX "index_identities_on_user_id" ON "identities" ("user_id")[0m
  [1m[35m (1.5ms)[0m  [1m[35mDROP TABLE IF EXISTS "recommendations" CASCADE[0m
  [1m[35m (2.3ms)[0m  [1m[35mCREATE TABLE "recommendations" ("id" bigserial primary key, "ai_model" character varying, "created_at" timestamp(6) NOT NULL, "game_id" bigint NOT NULL, "reason" text, "score" decimal, "updated_at" timestamp(6) NOT NULL, "user_id" bigint NOT NULL)[0m
  [1m[35m (0.6ms)[0m  [1m[35mCREATE INDEX "index_recommendations_on_game_id" ON "recommendations" ("game_id")[0m
  [1m[35m (0.7ms)[0m  [1m[35mCREATE INDEX "index_recommendations_on_user_id" ON "recommendations" ("user_id")[0m
  [1m[35m (2.3ms)[0m  [1m[35mDROP TABLE IF EXISTS "user_games" CASCADE[0m
  [1m[35m (2.5ms)[0m  [1m[35mCREATE TABLE "user_games" ("id" bigserial primary key, "completion_percentage" integer, "created_at" timestamp(6) NOT NULL, "game_id" bigint NOT NULL, "hours_played" decimal, "notes" text, "priority" integer, "status" character varying, "updated_at" timestamp(6) NOT NULL, "user_id" bigint NOT NULL)[0m
  [1m[35m (0.8ms)[0m  [1m[35mCREATE INDEX "index_user_games_on_game_id" ON "user_games" ("game_id")[0m
  [1m[35m (0.5ms)[0m  [1m[35mCREATE INDEX "index_user_games_on_user_id" ON "user_games" ("user_id")[0m
  [1m[35m (4.5ms)[0m  [1m[35mDROP TABLE IF EXISTS "users" CASCADE[0m
  [1m[35m (1.8ms)[0m  [1m[35mCREATE TABLE "users" ("id" bigserial primary key, "avatar_url" character varying, "created_at" timestamp(6) NOT NULL, "email" character varying, "provider" character varying, "uid" character varying, "updated_at" timestamp(6) NOT NULL, "username" character varying)[0m
  [1m[35m (0.7ms)[0m  [1m[35mCREATE UNIQUE INDEX "index_users_on_provider_and_uid" ON "users" ("provider", "uid")[0m
  [1m[35m (1.3ms)[0m  [1m[35mALTER TABLE "game_services" ADD CONSTRAINT "fk_rails_42c0f93ab6"
FOREIGN KEY ("user_id")
  REFERENCES "users" ("id")
[0m
  [1m[35m (0.8ms)[0m  [1m[35mALTER TABLE "identities" ADD CONSTRAINT "fk_rails_5373344100"
FOREIGN KEY ("user_id")
  REFERENCES "users" ("id")
[0m
  [1m[35m (0.8ms)[0m  [1m[35mALTER TABLE "recommendations" ADD CONSTRAINT "fk_rails_47f7d6ab93"
FOREIGN KEY ("game_id")
  REFERENCES "games" ("id")
[0m
  [1m[35m (0.5ms)[0m  [1m[35mALTER TABLE "recommendations" ADD CONSTRAINT "fk_rails_e696723f80"
FOREIGN KEY ("user_id")
  REFERENCES "users" ("id")
[0m
  [1m[35m (0.9ms)[0m  [1m[35mALTER TABLE "user_games" ADD CONSTRAINT "fk_rails_445132b40d"
FOREIGN KEY ("game_id")
  REFERENCES "games" ("id")
[0m
  [1m[35m (0.6ms)[0m  [1m[35mALTER TABLE "user_games" ADD CONSTRAINT "fk_rails_a05b45437a"
FOREIGN KEY ("user_id")
  REFERENCES "users" ("id")
[0m
  [1m[36mActiveRecord::SchemaMigration Load (0.1ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.1ms)[0m  [1m[34mSELECT * FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 ORDER BY "ar_internal_metadata"."key" ASC LIMIT 1[0m  [[nil, "environment"]]
  [1m[36mActiveRecord::InternalMetadata Load (0.1ms)[0m  [1m[34mSELECT * FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 ORDER BY "ar_internal_metadata"."key" ASC LIMIT 1[0m  [[nil, "environment"]]
  [1m[36mActiveRecord::InternalMetadata Load (0.1ms)[0m  [1m[34mSELECT * FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 ORDER BY "ar_internal_metadata"."key" ASC LIMIT 1[0m  [[nil, "schema_sha1"]]
  [1m[36mActiveRecord::InternalMetadata Load (1.2ms)[0m  [1m[34mSELECT * FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 ORDER BY "ar_internal_metadata"."key" ASC LIMIT 1[0m  [[nil, "schema_sha1"]]
  [1m[36mActiveRecord::SchemaMigration Load (0.5ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.3ms)[0m  [1m[35mALTER TABLE "schema_migrations" DISABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" DISABLE TRIGGER ALL;ALTER TABLE "user_games" DISABLE TRIGGER ALL;ALTER TABLE "games" DISABLE TRIGGER ALL;ALTER TABLE "identities" DISABLE TRIGGER ALL;ALTER TABLE "users" DISABLE TRIGGER ALL;ALTER TABLE "game_services" DISABLE TRIGGER ALL;ALTER TABLE "recommendations" DISABLE TRIGGER ALL[0m
  [1m[36mFixtures Load (3.8ms)[0m  [1m[31mDELETE FROM "game_services";
DELETE FROM "games";
DELETE FROM "identities";
DELETE FROM "recommendations";
DELETE FROM "user_games";
DELETE FROM "users";
INSERT INTO "game_services" ("id", "access_token", "created_at", "refresh_token", "service_name", "token_expires_at", "updated_at", "user_id") VALUES (980190962, 'MyText', '2026-01-18 03:29:26.733531', 'MyText', 'MyString', '2026-01-14 05:40:08', '2026-01-18 03:29:26.733531', 980190962), (298486374, 'MyText', '2026-01-18 03:29:26.733531', 'MyText', 'MyString', '2026-01-14 05:40:08', '2026-01-18 03:29:26.733531', 298486374);
INSERT INTO "games" ("id", "created_at", "description", "developer", "external_id", "genre", "platform", "publisher", "release_date", "title", "updated_at") VALUES (980190962, '2026-01-18 03:29:26.738514', 'MyText', 'MyString', 'MyString', 'MyString', 'MyString', 'MyString', '2026-01-14', 'MyString', '2026-01-18 03:29:26.738514'), (298486374, '2026-01-18 03:29:26.738514', 'MyText', 'MyString', 'MyString', 'MyString', 'MyString', 'MyString', '2026-01-14', 'MyString', '2026-01-18 03:29:26.738514');
INSERT INTO "identities" ("id", "access_token", "created_at", "expires_at", "extra_info", "profile_configured", "profile_last_checked_at", "profile_visibility", "provider", "refresh_token", "steam_id", "uid", "updated_at", "user_id") VALUES (980190962, 'test_token_1', '2026-01-18 03:29:26.739721', '2026-01-19 03:29:26', '{}', DEFAULT, DEFAULT, DEFAULT, 'google', 'refresh_token_1', DEFAULT, '12345', '2026-01-18 03:29:26.739721', 980190962), (298486374, 'test_token_2', '2026-01-18 03:29:26.739721', NULL, '{}', DEFAULT, DEFAULT, DEFAULT, 'steam', NULL, DEFAULT, '67890', '2026-01-18 03:29:26.739721', 298486374);
INSERT INTO "recommendations" ("id", "ai_model", "created_at", "game_id", "reason", "score", "updated_at", "user_id") VALUES (980190962, 'MyString', '2026-01-18 03:29:26.740732', 980190962, 'MyText', 9.99, '2026-01-18 03:29:26.740732', 980190962), (298486374, 'MyString', '2026-01-18 03:29:26.740732', 298486374, 'MyText', 9.99, '2026-01-18 03:29:26.740732', 298486374);
INSERT INTO "user_games" ("id", "completion_percentage", "created_at", "game_id", "hours_played", "notes", "priority", "status", "updated_at", "user_id") VALUES (980190962, 1, '2026-01-18 03:29:26.741975', 980190962, 9.99, 'MyText', 1, 'MyString', '2026-01-18 03:29:26.741975', 980190962), (298486374, 1, '2026-01-18 03:29:26.741975', 298486374, 9.99, 'MyText', 1, 'MyString', '2026-01-18 03:29:26.741975', 298486374);
INSERT INTO "users" ("id", "avatar_url", "created_at", "email", "provider", "uid", "updated_at", "username") VALUES (980190962, DEFAULT, '2026-01-18 03:29:26.743195', 'user1@example.com', 'google_oauth2', '12345', '2026-01-18 03:29:26.743195', 'testuser1'), (298486374, DEFAULT, '2026-01-18 03:29:26.743195', 'user2@example.com', 'facebook', '67890', '2026-01-18 03:29:26.743195', 'testuser2')[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35m (2.3ms)[0m  [1m[35mALTER TABLE "schema_migrations" ENABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" ENABLE TRIGGER ALL;ALTER TABLE "user_games" ENABLE TRIGGER ALL;ALTER TABLE "games" ENABLE TRIGGER ALL;ALTER TABLE "identities" ENABLE TRIGGER ALL;ALTER TABLE "users" ENABLE TRIGGER ALL;ALTER TABLE "game_services" ENABLE TRIGGER ALL;ALTER TABLE "recommendations" ENABLE TRIGGER ALL[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (6.9ms)[0m  [1m[35mdo $$
  declare r record;
BEGIN
FOR r IN (
  SELECT FORMAT(
    'UPDATE pg_catalog.pg_constraint SET convalidated=false WHERE conname = ''%1$I'' AND connamespace::regnamespace = ''%2$I''::regnamespace; ALTER TABLE %2$I.%3$I VALIDATE CONSTRAINT %1$I;',
    constraint_name,
    table_schema,
    table_name
  ) AS constraint_check
  FROM information_schema.table_constraints WHERE constraint_type = 'FOREIGN KEY'
)
  LOOP
    EXECUTE (r.constraint_check);
  END LOOP;
END;
$$;
[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mBEGIN[0m
----------------------------------------------------
RecommendationsControllerTest: test_should_get_index
----------------------------------------------------
Started GET "/recommendations" for 127.0.0.1 at 2026-01-17 21:29:26 -0600
Processing by RecommendationsController#index as HTML
  Rendering layout layouts/application.html.erb
  Rendering recommendations/index.html.erb within layouts/application
  Rendered recommendations/index.html.erb within layouts/application (Duration: 0.7ms | GC: 0.4ms)
  Rendered layout layouts/application.html.erb (Duration: 5.1ms | GC: 1.8ms)
Completed 200 OK in 18ms (Views: 7.4ms | ActiveRecord: 0.0ms (0 queries, 0 cached) | GC: 5.1ms)
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mBEGIN[0m
------------------------------------------------------------------------------------
SessionsControllerTest: test_should_handle_steam_oauth_callback_with_private_profile
------------------------------------------------------------------------------------
Started GET "/auth/steam/callback" for 127.0.0.1 at 2026-01-17 21:29:26 -0600
Processing by SessionsController#create as HTML
  Parameters: {"provider"=>"steam"}
  [1m[36mUser Load (0.3ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."provider" = $1 AND "users"."uid" = $2 LIMIT $3[0m  [["provider", "steam"], ["uid", "76561198087654321"], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Create (0.2ms)[0m  [1m[32mINSERT INTO "users" ("avatar_url", "created_at", "email", "provider", "uid", "updated_at", "username") VALUES ($1, $2, $3, $4, $5, $6, $7) RETURNING "id"[0m  [["avatar_url", nil], ["created_at", "2026-01-18 03:29:26.842692"], ["email", "[FILTERED]"], ["provider", "steam"], ["uid", "76561198087654321"], ["updated_at", "2026-01-18 03:29:26.842692"], ["username", "TestSteamUser2"]]
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mIdentity Load (0.2ms)[0m  [1m[34mSELECT "identities".* FROM "identities" WHERE "identities"."provider" = $1 AND "identities"."uid" = $2 LIMIT $3[0m  [["provider", "steam"], ["uid", "76561198087654321"], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mIdentity Exists? (0.3ms)[0m  [1m[34mSELECT 1 AS one FROM "identities" WHERE "identities"."uid" = $1 AND "identities"."provider" = $2 LIMIT $3[0m  [["uid", "76561198087654321"], ["provider", "steam"], ["LIMIT", 1]]
  [1m[36mIdentity Create (0.5ms)[0m  [1m[32mINSERT INTO "identities" ("access_token", "created_at", "expires_at", "extra_info", "profile_configured", "profile_last_checked_at", "profile_visibility", "provider", "refresh_token", "steam_id", "uid", "updated_at", "user_id") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13) RETURNING "id"[0m  [["access_token", "[FILTERED]"], ["created_at", "2026-01-18 03:29:26.847158"], ["expires_at", nil], ["extra_info", "{}"], ["profile_configured", false], ["profile_last_checked_at", nil], ["profile_visibility", "unknown"], ["provider", "steam"], ["refresh_token", "[FILTERED]"], ["steam_id", "76561198087654321"], ["uid", "76561198087654321"], ["updated_at", "2026-01-18 03:29:26.847158"], ["user_id", 980190963]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mIdentity Load (0.2ms)[0m  [1m[34mSELECT "identities".* FROM "identities" WHERE "identities"."user_id" = $1 AND "identities"."provider" = $2 LIMIT $3[0m  [["user_id", 980190963], ["provider", "steam"], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mIdentity Update (0.2ms)[0m  [1m[33mUPDATE "identities" SET "profile_configured" = $1, "profile_last_checked_at" = $2, "profile_visibility" = $3, "updated_at" = $4 WHERE "identities"."id" = $5[0m  [["profile_configured", true], ["profile_last_checked_at", "2026-01-18 03:29:26.849962"], ["profile_visibility", "private"], ["updated_at", "2026-01-18 03:29:26.852841"], ["id", 980190963]]
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Redirected to http://www.example.com/
Completed 302 Found in 15ms (ActiveRecord: 4.8ms (7 queries, 0 cached) | GC: 0.4ms)
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."id" = $1 LIMIT $2[0m  [["id", 980190963], ["LIMIT", 1]]
  [1m[36mIdentity Load (0.1ms)[0m  [1m[34mSELECT "identities".* FROM "identities" WHERE "identities"."user_id" = $1 AND "identities"."provider" = $2 LIMIT $3[0m  [["user_id", 980190963], ["provider", "steam"], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mBEGIN[0m
-----------------------------------------------------------------------------------------
SessionsControllerTest: test_should_handle_steam_oauth_callback_with_unconfigured_profile
-----------------------------------------------------------------------------------------
Started GET "/auth/steam/callback" for 127.0.0.1 at 2026-01-17 21:29:26 -0600
Processing by SessionsController#create as HTML
  Parameters: {"provider"=>"steam"}
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."provider" = $1 AND "users"."uid" = $2 LIMIT $3[0m  [["provider", "steam"], ["uid", "76561198011111111"], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Create (0.2ms)[0m  [1m[32mINSERT INTO "users" ("avatar_url", "created_at", "email", "provider", "uid", "updated_at", "username") VALUES ($1, $2, $3, $4, $5, $6, $7) RETURNING "id"[0m  [["avatar_url", nil], ["created_at", "2026-01-18 03:29:26.856804"], ["email", "[FILTERED]"], ["provider", "steam"], ["uid", "76561198011111111"], ["updated_at", "2026-01-18 03:29:26.856804"], ["username", "TestSteamUser3"]]
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mIdentity Load (0.1ms)[0m  [1m[34mSELECT "identities".* FROM "identities" WHERE "identities"."provider" = $1 AND "identities"."uid" = $2 LIMIT $3[0m  [["provider", "steam"], ["uid", "76561198011111111"], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mIdentity Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "identities" WHERE "identities"."uid" = $1 AND "identities"."provider" = $2 LIMIT $3[0m  [["uid", "76561198011111111"], ["provider", "steam"], ["LIMIT", 1]]
  [1m[36mIdentity Create (0.2ms)[0m  [1m[32mINSERT INTO "identities" ("access_token", "created_at", "expires_at", "extra_info", "profile_configured", "profile_last_checked_at", "profile_visibility", "provider", "refresh_token", "steam_id", "uid", "updated_at", "user_id") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13) RETURNING "id"[0m  [["access_token", "[FILTERED]"], ["created_at", "2026-01-18 03:29:26.857929"], ["expires_at", nil], ["extra_info", "{}"], ["profile_configured", false], ["profile_last_checked_at", nil], ["profile_visibility", "unknown"], ["provider", "steam"], ["refresh_token", "[FILTERED]"], ["steam_id", "76561198011111111"], ["uid", "76561198011111111"], ["updated_at", "2026-01-18 03:29:26.857929"], ["user_id", 980190964]]
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mIdentity Load (0.1ms)[0m  [1m[34mSELECT "identities".* FROM "identities" WHERE "identities"."user_id" = $1 AND "identities"."provider" = $2 LIMIT $3[0m  [["user_id", 980190964], ["provider", "steam"], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mIdentity Update (0.2ms)[0m  [1m[33mUPDATE "identities" SET "profile_last_checked_at" = $1, "profile_visibility" = $2, "updated_at" = $3 WHERE "identities"."id" = $4[0m  [["profile_last_checked_at", "2026-01-18 03:29:26.858686"], ["profile_visibility", "public"], ["updated_at", "2026-01-18 03:29:26.858763"], ["id", 980190964]]
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Redirected to http://www.example.com/
Completed 302 Found in 3ms (ActiveRecord: 1.3ms (7 queries, 0 cached) | GC: 0.0ms)
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mBEGIN[0m
----------------------------------------------------------------------
SessionsControllerTest: test_should_handle_oauth_callback_successfully
----------------------------------------------------------------------
Started GET "/auth/google_oauth2/callback" for 127.0.0.1 at 2026-01-17 21:29:26 -0600
Processing by SessionsController#create as HTML
  Parameters: {"provider"=>"google_oauth2"}
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."provider" = $1 AND "users"."uid" = $2 LIMIT $3[0m  [["provider", "google_oauth2"], ["uid", "12345"], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.1ms)[0m  [1m[34mSELECT 1 AS one FROM "users" WHERE "users"."email" = $1 AND "users"."id" != $2 LIMIT $3[0m  [["email", "[FILTERED]"], ["id", 980190962], ["LIMIT", 1]]
  [1m[36mUser Update (0.1ms)[0m  [1m[33mUPDATE "users" SET "avatar_url" = $1, "updated_at" = $2 WHERE "users"."id" = $3[0m  [["avatar_url", "https://example.com/avatar.jpg"], ["updated_at", "2026-01-18 03:29:26.861908"], ["id", 980190962]]
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mIdentity Load (0.1ms)[0m  [1m[34mSELECT "identities".* FROM "identities" WHERE "identities"."provider" = $1 AND "identities"."uid" = $2 LIMIT $3[0m  [["provider", "google_oauth2"], ["uid", "12345"], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mIdentity Exists? (0.1ms)[0m  [1m[34mSELECT 1 AS one FROM "identities" WHERE "identities"."uid" = $1 AND "identities"."provider" = $2 LIMIT $3[0m  [["uid", "12345"], ["provider", "google_oauth2"], ["LIMIT", 1]]
  [1m[36mIdentity Create (0.3ms)[0m  [1m[32mINSERT INTO "identities" ("access_token", "created_at", "expires_at", "extra_info", "profile_configured", "profile_last_checked_at", "profile_visibility", "provider", "refresh_token", "steam_id", "uid", "updated_at", "user_id") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13) RETURNING "id"[0m  [["access_token", "[FILTERED]"], ["created_at", "2026-01-18 03:29:26.862810"], ["expires_at", "2026-01-18 04:29:26"], ["extra_info", "{}"], ["profile_configured", false], ["profile_last_checked_at", nil], ["profile_visibility", "unknown"], ["provider", "google_oauth2"], ["refresh_token", "[FILTERED]"], ["steam_id", nil], ["uid", "12345"], ["updated_at", "2026-01-18 03:29:26.862810"], ["user_id", 980190962]]
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Redirected to http://www.example.com/
Completed 302 Found in 3ms (ActiveRecord: 1.9ms (6 queries, 0 cached) | GC: 0.0ms)
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mBEGIN[0m
-----------------------------------------------------------------------------------
SessionsControllerTest: test_should_handle_steam_oauth_callback_when_API_call_fails
-----------------------------------------------------------------------------------
Started GET "/auth/steam/callback" for 127.0.0.1 at 2026-01-17 21:29:26 -0600
Processing by SessionsController#create as HTML
  Parameters: {"provider"=>"steam"}
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."provider" = $1 AND "users"."uid" = $2 LIMIT $3[0m  [["provider", "steam"], ["uid", "76561198022222222"], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Create (0.2ms)[0m  [1m[32mINSERT INTO "users" ("avatar_url", "created_at", "email", "provider", "uid", "updated_at", "username") VALUES ($1, $2, $3, $4, $5, $6, $7) RETURNING "id"[0m  [["avatar_url", nil], ["created_at", "2026-01-18 03:29:26.865402"], ["email", "[FILTERED]"], ["provider", "steam"], ["uid", "76561198022222222"], ["updated_at", "2026-01-18 03:29:26.865402"], ["username", "TestSteamUser4"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mIdentity Load (0.1ms)[0m  [1m[34mSELECT "identities".* FROM "identities" WHERE "identities"."provider" = $1 AND "identities"."uid" = $2 LIMIT $3[0m  [["provider", "steam"], ["uid", "76561198022222222"], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mIdentity Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "identities" WHERE "identities"."uid" = $1 AND "identities"."provider" = $2 LIMIT $3[0m  [["uid", "76561198022222222"], ["provider", "steam"], ["LIMIT", 1]]
  [1m[36mIdentity Create (0.2ms)[0m  [1m[32mINSERT INTO "identities" ("access_token", "created_at", "expires_at", "extra_info", "profile_configured", "profile_last_checked_at", "profile_visibility", "provider", "refresh_token", "steam_id", "uid", "updated_at", "user_id") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13) RETURNING "id"[0m  [["access_token", "[FILTERED]"], ["created_at", "2026-01-18 03:29:26.866582"], ["expires_at", nil], ["extra_info", "{}"], ["profile_configured", false], ["profile_last_checked_at", nil], ["profile_visibility", "unknown"], ["provider", "steam"], ["refresh_token", "[FILTERED]"], ["steam_id", "76561198022222222"], ["uid", "76561198022222222"], ["updated_at", "2026-01-18 03:29:26.866582"], ["user_id", 980190965]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mIdentity Load (0.1ms)[0m  [1m[34mSELECT "identities".* FROM "identities" WHERE "identities"."user_id" = $1 AND "identities"."provider" = $2 LIMIT $3[0m  [["user_id", 980190965], ["provider", "steam"], ["LIMIT", 1]]
Redirected to http://www.example.com/
Completed 302 Found in 2ms (ActiveRecord: 1.3ms (6 queries, 0 cached) | GC: 0.0ms)
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mBEGIN[0m
-----------------------------------------------------------------------------------
SessionsControllerTest: test_refresh_steam_profile_should_update_profile_visibility
-----------------------------------------------------------------------------------
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "users" WHERE "users"."email" = $1 LIMIT $2[0m  [["email", "[FILTERED]"], ["LIMIT", 1]]
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO "users" ("avatar_url", "created_at", "email", "provider", "uid", "updated_at", "username") VALUES ($1, $2, $3, $4, $5, $6, $7) RETURNING "id"[0m  [["avatar_url", nil], ["created_at", "2026-01-18 03:29:26.868440"], ["email", "[FILTERED]"], ["provider", "steam"], ["uid", "76561198033333333"], ["updated_at", "2026-01-18 03:29:26.868440"], ["username", "steamuser"]]
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mIdentity Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "identities" WHERE "identities"."uid" = $1 AND "identities"."provider" = $2 LIMIT $3[0m  [["uid", "76561198033333333"], ["provider", "steam"], ["LIMIT", 1]]
  [1m[36mIdentity Create (0.1ms)[0m  [1m[32mINSERT INTO "identities" ("access_token", "created_at", "expires_at", "extra_info", "profile_configured", "profile_last_checked_at", "profile_visibility", "provider", "refresh_token", "steam_id", "uid", "updated_at", "user_id") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13) RETURNING "id"[0m  [["access_token", "[FILTERED]"], ["created_at", "2026-01-18 03:29:26.869127"], ["expires_at", nil], ["extra_info", nil], ["profile_configured", false], ["profile_last_checked_at", nil], ["profile_visibility", "private"], ["provider", "steam"], ["refresh_token", "[FILTERED]"], ["steam_id", "76561198033333333"], ["uid", "76561198033333333"], ["updated_at", "2026-01-18 03:29:26.869127"], ["user_id", 980190966]]
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Started POST "/steam/refresh_profile" for 127.0.0.1 at 2026-01-17 21:29:26 -0600
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mBEGIN[0m
-------------------------------------------------------------
SessionsControllerTest: test_should_destroy_session_on_logout
-------------------------------------------------------------
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "users" WHERE "users"."email" = $1 LIMIT $2[0m  [["email", "[FILTERED]"], ["LIMIT", 1]]
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO "users" ("avatar_url", "created_at", "email", "provider", "uid", "updated_at", "username") VALUES ($1, $2, $3, $4, $5, $6, $7) RETURNING "id"[0m  [["avatar_url", nil], ["created_at", "2026-01-18 03:29:26.871453"], ["email", "[FILTERED]"], ["provider", "google_oauth2"], ["uid", "logout123"], ["updated_at", "2026-01-18 03:29:26.871453"], ["username", "logoutuser"]]
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Started DELETE "/logout" for 127.0.0.1 at 2026-01-17 21:29:26 -0600
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mBEGIN[0m
-----------------------------------------------------------------------------------------
SessionsControllerTest: test_refresh_steam_profile_should_handle_missing_steam_connection
-----------------------------------------------------------------------------------------
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "users" WHERE "users"."email" = $1 LIMIT $2[0m  [["email", "[FILTERED]"], ["LIMIT", 1]]
  [1m[36mUser Create (0.2ms)[0m  [1m[32mINSERT INTO "users" ("avatar_url", "created_at", "email", "provider", "uid", "updated_at", "username") VALUES ($1, $2, $3, $4, $5, $6, $7) RETURNING "id"[0m  [["avatar_url", nil], ["created_at", "2026-01-18 03:29:26.881149"], ["email", "[FILTERED]"], ["provider", "google_oauth2"], ["uid", "nosteam123"], ["updated_at", "2026-01-18 03:29:26.881149"], ["username", "nosteamuser"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Started POST "/steam/refresh_profile" for 127.0.0.1 at 2026-01-17 21:29:26 -0600
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
-----------------------------------------------------------------
SessionsControllerTest: test_should_handle_authentication_failure
-----------------------------------------------------------------
Started GET "/auth/failure?message=invalid_credentials" for 127.0.0.1 at 2026-01-17 21:29:26 -0600
Processing by SessionsController#failure as HTML
  Parameters: {"message"=>"invalid_credentials"}
Redirected to http://www.example.com/
Completed 302 Found in 0ms (ActiveRecord: 0.0ms (0 queries, 0 cached) | GC: 0.0ms)
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mBEGIN[0m
-----------------------------------------------------------------------------------
SessionsControllerTest: test_should_handle_steam_oauth_callback_with_public_profile
-----------------------------------------------------------------------------------
Started GET "/auth/steam/callback" for 127.0.0.1 at 2026-01-17 21:29:26 -0600
Processing by SessionsController#create as HTML
  Parameters: {"provider"=>"steam"}
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."provider" = $1 AND "users"."uid" = $2 LIMIT $3[0m  [["provider", "steam"], ["uid", "76561198012345678"], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Create (0.2ms)[0m  [1m[32mINSERT INTO "users" ("avatar_url", "created_at", "email", "provider", "uid", "updated_at", "username") VALUES ($1, $2, $3, $4, $5, $6, $7) RETURNING "id"[0m  [["avatar_url", "https://steamcdn-a.akamaihd.net/steamcommunity/public/images/avatars/fe/fef.jpg"], ["created_at", "2026-01-18 03:29:26.884958"], ["email", "[FILTERED]"], ["provider", "steam"], ["uid", "76561198012345678"], ["updated_at", "2026-01-18 03:29:26.884958"], ["username", "TestSteamUser"]]
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mIdentity Load (0.1ms)[0m  [1m[34mSELECT "identities".* FROM "identities" WHERE "identities"."provider" = $1 AND "identities"."uid" = $2 LIMIT $3[0m  [["provider", "steam"], ["uid", "76561198012345678"], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mIdentity Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "identities" WHERE "identities"."uid" = $1 AND "identities"."provider" = $2 LIMIT $3[0m  [["uid", "76561198012345678"], ["provider", "steam"], ["LIMIT", 1]]
  [1m[36mIdentity Create (0.2ms)[0m  [1m[32mINSERT INTO "identities" ("access_token", "created_at", "expires_at", "extra_info", "profile_configured", "profile_last_checked_at", "profile_visibility", "provider", "refresh_token", "steam_id", "uid", "updated_at", "user_id") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13) RETURNING "id"[0m  [["access_token", "[FILTERED]"], ["created_at", "2026-01-18 03:29:26.886036"], ["expires_at", nil], ["extra_info", "{}"], ["profile_configured", false], ["profile_last_checked_at", nil], ["profile_visibility", "unknown"], ["provider", "steam"], ["refresh_token", "[FILTERED]"], ["steam_id", "76561198012345678"], ["uid", "76561198012345678"], ["updated_at", "2026-01-18 03:29:26.886036"], ["user_id", 980190969]]
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mIdentity Load (0.1ms)[0m  [1m[34mSELECT "identities".* FROM "identities" WHERE "identities"."user_id" = $1 AND "identities"."provider" = $2 LIMIT $3[0m  [["user_id", 980190969], ["provider", "steam"], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mIdentity Update (0.2ms)[0m  [1m[33mUPDATE "identities" SET "profile_configured" = $1, "profile_last_checked_at" = $2, "profile_visibility" = $3, "updated_at" = $4 WHERE "identities"."id" = $5[0m  [["profile_configured", true], ["profile_last_checked_at", "2026-01-18 03:29:26.886776"], ["profile_visibility", "public"], ["updated_at", "2026-01-18 03:29:26.886842"], ["id", 980190968]]
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Redirected to http://www.example.com/
Completed 302 Found in 3ms (ActiveRecord: 1.3ms (7 queries, 0 cached) | GC: 0.1ms)
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."id" = $1 LIMIT $2[0m  [["id", 980190969], ["LIMIT", 1]]
  [1m[36mIdentity Load (0.1ms)[0m  [1m[34mSELECT "identities".* FROM "identities" WHERE "identities"."user_id" = $1 AND "identities"."provider" = $2 LIMIT $3[0m  [["user_id", 980190969], ["provider", "steam"], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mBEGIN[0m
---------------------------------------------------------
IdentityTest: test_should_enforce_unique_uid_per_provider
---------------------------------------------------------
  [1m[36mIdentity Load (0.2ms)[0m  [1m[34mSELECT "identities".* FROM "identities" WHERE "identities"."id" = $1 LIMIT $2[0m  [["id", 980190962], ["LIMIT", 1]]
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."id" = $1 LIMIT $2[0m  [["id", 298486374], ["LIMIT", 1]]
  [1m[36mIdentity Exists? (0.1ms)[0m  [1m[34mSELECT 1 AS one FROM "identities" WHERE "identities"."uid" = $1 AND "identities"."provider" = $2 LIMIT $3[0m  [["uid", "12345"], ["provider", "google"], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mBEGIN[0m
----------------------------------------------------------------------------------
IdentityTest: test_profile_visibility_needs_check?_returns_true_when_never_checked
----------------------------------------------------------------------------------
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mBEGIN[0m
-----------------------------------------------------------------------
IdentityTest: test_steam_provider?_returns_false_for_non-steam_provider
-----------------------------------------------------------------------
  [1m[36mIdentity Load (0.1ms)[0m  [1m[34mSELECT "identities".* FROM "identities" WHERE "identities"."id" = $1 LIMIT $2[0m  [["id", 980190962], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mBEGIN[0m
----------------------------------------------------------------------------------
IdentityTest: test_find_or_create_from_omniauth_stores_steam_id_for_steam_provider
----------------------------------------------------------------------------------
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."id" = $1 LIMIT $2[0m  [["id", 980190962], ["LIMIT", 1]]
  [1m[36mIdentity Load (0.1ms)[0m  [1m[34mSELECT "identities".* FROM "identities" WHERE "identities"."provider" = $1 AND "identities"."uid" = $2 LIMIT $3[0m  [["provider", "steam"], ["uid", "76561198012345678"], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mIdentity Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "identities" WHERE "identities"."uid" = $1 AND "identities"."provider" = $2 LIMIT $3[0m  [["uid", "76561198012345678"], ["provider", "steam"], ["LIMIT", 1]]
  [1m[36mIdentity Create (0.2ms)[0m  [1m[32mINSERT INTO "identities" ("access_token", "created_at", "expires_at", "extra_info", "profile_configured", "profile_last_checked_at", "profile_visibility", "provider", "refresh_token", "steam_id", "uid", "updated_at", "user_id") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13) RETURNING "id"[0m  [["access_token", "[FILTERED]"], ["created_at", "2026-01-18 03:29:26.891608"], ["expires_at", nil], ["extra_info", "{}"], ["profile_configured", false], ["profile_last_checked_at", nil], ["profile_visibility", "unknown"], ["provider", "steam"], ["refresh_token", "[FILTERED]"], ["steam_id", "76561198012345678"], ["uid", "76561198012345678"], ["updated_at", "2026-01-18 03:29:26.891608"], ["user_id", 980190962]]
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mBEGIN[0m
---------------------------------------------------------------------------
IdentityTest: test_private_profile?_returns_true_when_visibility_is_private
---------------------------------------------------------------------------
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mBEGIN[0m
------------------------------------------------------------
IdentityTest: test_should_validate_profile_visibility_values
------------------------------------------------------------
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."id" = $1 LIMIT $2[0m  [["id", 980190962], ["LIMIT", 1]]
  [1m[36mIdentity Exists? (0.1ms)[0m  [1m[34mSELECT 1 AS one FROM "identities" WHERE "identities"."uid" = $1 AND "identities"."provider" = $2 LIMIT $3[0m  [["uid", "76561198012345678"], ["provider", "steam"], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mBEGIN[0m
------------------------------------------
IdentityTest: test_should_require_provider
------------------------------------------
  [1m[36mIdentity Exists? (0.1ms)[0m  [1m[34mSELECT 1 AS one FROM "identities" WHERE "identities"."uid" = $1 AND "identities"."provider" IS NULL LIMIT $2[0m  [["uid", "12345"], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
---------------------------------------------------------------------
IdentityTest: test_should_validate_steam_id_format_for_steam_provider
---------------------------------------------------------------------
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."id" = $1 LIMIT $2[0m  [["id", 980190962], ["LIMIT", 1]]
  [1m[36mIdentity Exists? (0.1ms)[0m  [1m[34mSELECT 1 AS one FROM "identities" WHERE "identities"."uid" = $1 AND "identities"."provider" = $2 LIMIT $3[0m  [["uid", "76561198012345678"], ["provider", "steam"], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mBEGIN[0m
-------------------------------------------------------------------
IdentityTest: test_expired?_returns_false_when_token_is_not_expired
-------------------------------------------------------------------
  [1m[36mIdentity Load (0.1ms)[0m  [1m[34mSELECT "identities".* FROM "identities" WHERE "identities"."id" = $1 LIMIT $2[0m  [["id", 980190962], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mBEGIN[0m
--------------------------------------------------------------------
IdentityTest: test_should_allow_nil_steam_id_for_non-steam_providers
--------------------------------------------------------------------
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."id" = $1 LIMIT $2[0m  [["id", 980190962], ["LIMIT", 1]]
  [1m[36mIdentity Exists? (0.1ms)[0m  [1m[34mSELECT 1 AS one FROM "identities" WHERE "identities"."uid" = $1 AND "identities"."provider" = $2 LIMIT $3[0m  [["uid", "12345678"], ["provider", "google"], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mBEGIN[0m
-------------------------------------------------------------------------
IdentityTest: test_public_profile?_returns_true_when_visibility_is_public
-------------------------------------------------------------------------
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mBEGIN[0m
------------------------------------------------------------------------------
IdentityTest: test_public_profile?_returns_false_when_visibility_is_not_public
------------------------------------------------------------------------------
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
-------------------------------------
IdentityTest: test_should_require_uid
-------------------------------------
  [1m[36mIdentity Exists? (0.1ms)[0m  [1m[34mSELECT 1 AS one FROM "identities" WHERE "identities"."uid" IS NULL AND "identities"."provider" = $1 LIMIT $2[0m  [["provider", "google"], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mBEGIN[0m
----------------------------------------
IdentityTest: test_should_belong_to_user
----------------------------------------
  [1m[36mIdentity Load (0.1ms)[0m  [1m[34mSELECT "identities".* FROM "identities" WHERE "identities"."id" = $1 LIMIT $2[0m  [["id", 980190962], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mBEGIN[0m
------------------------------------------------------------------
IdentityTest: test_steam_provider?_returns_true_for_steam_provider
------------------------------------------------------------------
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."id" = $1 LIMIT $2[0m  [["id", 980190962], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
--------------------------------------------------------------------------------------
IdentityTest: test_profile_visibility_needs_check?_returns_false_when_checked_recently
--------------------------------------------------------------------------------------
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mBEGIN[0m
----------------------------------------------------------------------------------------
IdentityTest: test_profile_visibility_needs_check?_returns_false_for_non-steam_providers
----------------------------------------------------------------------------------------
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mBEGIN[0m
--------------------------------------------------------------
IdentityTest: test_expired?_returns_true_when_token_is_expired
--------------------------------------------------------------
  [1m[36mIdentity Load (0.1ms)[0m  [1m[34mSELECT "identities".* FROM "identities" WHERE "identities"."id" = $1 LIMIT $2[0m  [["id", 980190962], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
----------------------------------------------------------------
IdentityTest: test_expired?_returns_false_when_expires_at_is_nil
----------------------------------------------------------------
  [1m[36mIdentity Load (0.1ms)[0m  [1m[34mSELECT "identities".* FROM "identities" WHERE "identities"."id" = $1 LIMIT $2[0m  [["id", 980190962], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
--------------------------------------------------------
IdentityTest: test_should_accept_valid_17-digit_steam_id
--------------------------------------------------------
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."id" = $1 LIMIT $2[0m  [["id", 980190962], ["LIMIT", 1]]
  [1m[36mIdentity Exists? (0.1ms)[0m  [1m[34mSELECT 1 AS one FROM "identities" WHERE "identities"."uid" = $1 AND "identities"."provider" = $2 LIMIT $3[0m  [["uid", "76561198012345678"], ["provider", "steam"], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mBEGIN[0m
---------------------------------------------------------------------------------------------
IdentityTest: test_profile_visibility_needs_check?_returns_true_when_checked_over_an_hour_ago
---------------------------------------------------------------------------------------------
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mBEGIN[0m
------------------------------------------------------------------------------------------------------------
GamePlatforms::SteamServiceTest: test_fetch_player_summary_returns_unknown_for_unrecognized_visibility_state
------------------------------------------------------------------------------------------------------------
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mBEGIN[0m
---------------------------------------------------------------------------------
GamePlatforms::SteamServiceTest: test_fetch_player_summary_handles_malformed_JSON
---------------------------------------------------------------------------------
Steam API JSON parse error: unexpected token 'not' at line 1 column 1
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mBEGIN[0m
---------------------------------------------------------------------------------
GamePlatforms::SteamServiceTest: test_fetch_player_summary_handles_timeout_errors
---------------------------------------------------------------------------------
Steam API timeout: execution expired
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mBEGIN[0m
-------------------------------------------------------------------------------------------------
GamePlatforms::SteamServiceTest: test_fetch_player_summary_returns_parsed_data_for_public_profile
-------------------------------------------------------------------------------------------------
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mBEGIN[0m
----------------------------------------------------------------------------------------
GamePlatforms::SteamServiceTest: test_fetch_player_summary_handles_API_errors_gracefully
----------------------------------------------------------------------------------------
Steam API returned status 500: Internal Server Error
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mBEGIN[0m
----------------------------------------------------------------------------------------------
GamePlatforms::SteamServiceTest: test_valid_steam_id?_returns_true_for_valid_17-digit_steam_id
----------------------------------------------------------------------------------------------
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mBEGIN[0m
--------------------------------------------------------------------------------------------------
GamePlatforms::SteamServiceTest: test_fetch_player_summary_returns_parsed_data_for_private_profile
--------------------------------------------------------------------------------------------------
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mBEGIN[0m
----------------------------------------------------------------------------------------------
GamePlatforms::SteamServiceTest: test_fetch_player_summary_returns_nil_when_api_key_is_missing
----------------------------------------------------------------------------------------------
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mBEGIN[0m
-------------------------------------------------------------------------------------------
GamePlatforms::SteamServiceTest: test_fetch_player_summary_returns_nil_for_invalid_steam_id
-------------------------------------------------------------------------------------------
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mBEGIN[0m
---------------------------------------------------------------------------------
GamePlatforms::SteamServiceTest: test_fetch_player_summary_handles_empty_response
---------------------------------------------------------------------------------
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mBEGIN[0m
---------------------------------------------------------------------------------------
GamePlatforms::SteamServiceTest: test_fetch_player_summary_detects_unconfigured_profile
---------------------------------------------------------------------------------------
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mBEGIN[0m
----------------------------------------------------------------------------------------
GamePlatforms::SteamServiceTest: test_valid_steam_id?_returns_false_for_invalid_steam_id
----------------------------------------------------------------------------------------
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mBEGIN[0m
-------------------------------------------------------------------------------------------------------
GamePlatforms::SteamServiceTest: test_fetch_player_summary_returns_parsed_data_for_friends_only_profile
-------------------------------------------------------------------------------------------------------
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mBEGIN[0m
----------------------------------------------
UserGamesControllerTest: test_should_get_index
----------------------------------------------
Started GET "/user_games" for 127.0.0.1 at 2026-01-17 21:29:26 -0600
Processing by UserGamesController#index as HTML
  Rendering layout layouts/application.html.erb
  Rendering user_games/index.html.erb within layouts/application
  Rendered shared/_steam_profile_warning.html.erb (Duration: 0.3ms | GC: 0.0ms)
  Rendered user_games/index.html.erb within layouts/application (Duration: 0.8ms | GC: 0.0ms)
  Rendered layout layouts/application.html.erb (Duration: 1.1ms | GC: 0.0ms)
Completed 200 OK in 2ms (Views: 1.5ms | ActiveRecord: 0.0ms (0 queries, 0 cached) | GC: 0.0ms)
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mBEGIN[0m
-----------------------------------------
HomeControllerTest: test_should_get_index
-----------------------------------------
Started GET "/" for 127.0.0.1 at 2026-01-17 21:29:26 -0600
Processing by HomeController#index as HTML
  Rendering layout layouts/application.html.erb
  Rendering home/index.html.erb within layouts/application
  Rendered home/index.html.erb within layouts/application (Duration: 6.6ms | GC: 5.7ms)
  Rendered layout layouts/application.html.erb (Duration: 6.7ms | GC: 5.7ms)
Completed 500 Internal Server Error in 7ms (ActiveRecord: 0.0ms (0 queries, 0 cached) | GC: 5.7ms)
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mBEGIN[0m
------------------------------------------
GamesControllerTest: test_should_get_index
------------------------------------------
Started GET "/games" for 127.0.0.1 at 2026-01-17 21:29:26 -0600
Processing by GamesController#index as HTML
  Rendering layout layouts/application.html.erb
  Rendering games/index.html.erb within layouts/application
  Rendered games/index.html.erb within layouts/application (Duration: 0.2ms | GC: 0.0ms)
  Rendered layout layouts/application.html.erb (Duration: 0.5ms | GC: 0.0ms)
Completed 200 OK in 1ms (Views: 0.8ms | ActiveRecord: 0.0ms (0 queries, 0 cached) | GC: 0.0ms)
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mBEGIN[0m
-----------------------------------------
GamesControllerTest: test_should_get_show
-----------------------------------------
  [1m[36mGame Load (0.2ms)[0m  [1m[34mSELECT "games".* FROM "games" WHERE "games"."id" = $1 LIMIT $2[0m  [["id", 980190962], ["LIMIT", 1]]
Started GET "/games/980190962" for 127.0.0.1 at 2026-01-17 21:29:26 -0600
Processing by GamesController#show as HTML
  Parameters: {"id"=>"980190962"}
  Rendering layout layouts/application.html.erb
  Rendering games/show.html.erb within layouts/application
  Rendered games/show.html.erb within layouts/application (Duration: 0.3ms | GC: 0.0ms)
  Rendered layout layouts/application.html.erb (Duration: 0.6ms | GC: 0.0ms)
Completed 200 OK in 1ms (Views: 0.7ms | ActiveRecord: 0.0ms (0 queries, 0 cached) | GC: 0.0ms)
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mActiveRecord::InternalMetadata Load (1.0ms)[0m  [1m[34mSELECT * FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 ORDER BY "ar_internal_metadata"."key" ASC LIMIT 1[0m  [[nil, "schema_sha1"]]
  [1m[36mActiveRecord::SchemaMigration Load (0.5ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.9ms)[0m  [1m[35mALTER TABLE "schema_migrations" DISABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" DISABLE TRIGGER ALL;ALTER TABLE "user_games" DISABLE TRIGGER ALL;ALTER TABLE "games" DISABLE TRIGGER ALL;ALTER TABLE "identities" DISABLE TRIGGER ALL;ALTER TABLE "users" DISABLE TRIGGER ALL;ALTER TABLE "game_services" DISABLE TRIGGER ALL;ALTER TABLE "recommendations" DISABLE TRIGGER ALL[0m
  [1m[36mFixtures Load (4.0ms)[0m  [1m[31mDELETE FROM "game_services";
DELETE FROM "games";
DELETE FROM "identities";
DELETE FROM "recommendations";
DELETE FROM "user_games";
DELETE FROM "users";
INSERT INTO "game_services" ("id", "access_token", "created_at", "refresh_token", "service_name", "token_expires_at", "updated_at", "user_id") VALUES (980190962, 'MyText', '2026-01-18 03:29:51.693180', 'MyText', 'MyString', '2026-01-14 05:40:08', '2026-01-18 03:29:51.693180', 980190962), (298486374, 'MyText', '2026-01-18 03:29:51.693180', 'MyText', 'MyString', '2026-01-14 05:40:08', '2026-01-18 03:29:51.693180', 298486374);
INSERT INTO "games" ("id", "created_at", "description", "developer", "external_id", "genre", "platform", "publisher", "release_date", "title", "updated_at") VALUES (980190962, '2026-01-18 03:29:51.698627', 'MyText', 'MyString', 'MyString', 'MyString', 'MyString', 'MyString', '2026-01-14', 'MyString', '2026-01-18 03:29:51.698627'), (298486374, '2026-01-18 03:29:51.698627', 'MyText', 'MyString', 'MyString', 'MyString', 'MyString', 'MyString', '2026-01-14', 'MyString', '2026-01-18 03:29:51.698627');
INSERT INTO "identities" ("id", "access_token", "created_at", "expires_at", "extra_info", "profile_configured", "profile_last_checked_at", "profile_visibility", "provider", "refresh_token", "steam_id", "uid", "updated_at", "user_id") VALUES (980190962, 'test_token_1', '2026-01-18 03:29:51.702462', '2026-01-19 03:29:51', '{}', DEFAULT, DEFAULT, DEFAULT, 'google', 'refresh_token_1', DEFAULT, '12345', '2026-01-18 03:29:51.702462', 980190962), (298486374, 'test_token_2', '2026-01-18 03:29:51.702462', NULL, '{}', DEFAULT, DEFAULT, DEFAULT, 'steam', NULL, DEFAULT, '67890', '2026-01-18 03:29:51.702462', 298486374);
INSERT INTO "recommendations" ("id", "ai_model", "created_at", "game_id", "reason", "score", "updated_at", "user_id") VALUES (980190962, 'MyString', '2026-01-18 03:29:51.705279', 980190962, 'MyText', 9.99, '2026-01-18 03:29:51.705279', 980190962), (298486374, 'MyString', '2026-01-18 03:29:51.705279', 298486374, 'MyText', 9.99, '2026-01-18 03:29:51.705279', 298486374);
INSERT INTO "user_games" ("id", "completion_percentage", "created_at", "game_id", "hours_played", "notes", "priority", "status", "updated_at", "user_id") VALUES (980190962, 1, '2026-01-18 03:29:51.707737', 980190962, 9.99, 'MyText', 1, 'MyString', '2026-01-18 03:29:51.707737', 980190962), (298486374, 1, '2026-01-18 03:29:51.707737', 298486374, 9.99, 'MyText', 1, 'MyString', '2026-01-18 03:29:51.707737', 298486374);
INSERT INTO "users" ("id", "avatar_url", "created_at", "email", "provider", "uid", "updated_at", "username") VALUES (980190962, DEFAULT, '2026-01-18 03:29:51.710503', 'user1@example.com', 'google_oauth2', '12345', '2026-01-18 03:29:51.710503', 'testuser1'), (298486374, DEFAULT, '2026-01-18 03:29:51.710503', 'user2@example.com', 'facebook', '67890', '2026-01-18 03:29:51.710503', 'testuser2')[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35m (0.6ms)[0m  [1m[35mALTER TABLE "schema_migrations" ENABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" ENABLE TRIGGER ALL;ALTER TABLE "user_games" ENABLE TRIGGER ALL;ALTER TABLE "games" ENABLE TRIGGER ALL;ALTER TABLE "identities" ENABLE TRIGGER ALL;ALTER TABLE "users" ENABLE TRIGGER ALL;ALTER TABLE "game_services" ENABLE TRIGGER ALL;ALTER TABLE "recommendations" ENABLE TRIGGER ALL[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (1.0ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (5.5ms)[0m  [1m[35mdo $$
  declare r record;
BEGIN
FOR r IN (
  SELECT FORMAT(
    'UPDATE pg_catalog.pg_constraint SET convalidated=false WHERE conname = ''%1$I'' AND connamespace::regnamespace = ''%2$I''::regnamespace; ALTER TABLE %2$I.%3$I VALIDATE CONSTRAINT %1$I;',
    constraint_name,
    table_schema,
    table_name
  ) AS constraint_check
  FROM information_schema.table_constraints WHERE constraint_type = 'FOREIGN KEY'
)
  LOOP
    EXECUTE (r.constraint_check);
  END LOOP;
END;
$$;
[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
-----------------------------------------
HomeControllerTest: test_should_get_index
-----------------------------------------
Started GET "/" for 127.0.0.1 at 2026-01-17 21:29:51 -0600
Processing by HomeController#index as HTML
  Rendering layout layouts/application.html.erb
  Rendering home/index.html.erb within layouts/application
  Rendered home/index.html.erb within layouts/application (Duration: 0.4ms | GC: 0.0ms)
  Rendered layout layouts/application.html.erb (Duration: 3.1ms | GC: 0.0ms)
Completed 200 OK in 7ms (Views: 4.0ms | ActiveRecord: 0.0ms (0 queries, 0 cached) | GC: 0.0ms)
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mActiveRecord::InternalMetadata Load (1.1ms)[0m  [1m[34mSELECT * FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 ORDER BY "ar_internal_metadata"."key" ASC LIMIT 1[0m  [[nil, "schema_sha1"]]
  [1m[36mActiveRecord::SchemaMigration Load (0.4ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.9ms)[0m  [1m[35mALTER TABLE "schema_migrations" DISABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" DISABLE TRIGGER ALL;ALTER TABLE "user_games" DISABLE TRIGGER ALL;ALTER TABLE "games" DISABLE TRIGGER ALL;ALTER TABLE "identities" DISABLE TRIGGER ALL;ALTER TABLE "users" DISABLE TRIGGER ALL;ALTER TABLE "game_services" DISABLE TRIGGER ALL;ALTER TABLE "recommendations" DISABLE TRIGGER ALL[0m
  [1m[36mFixtures Load (2.8ms)[0m  [1m[31mDELETE FROM "game_services";
DELETE FROM "games";
DELETE FROM "identities";
DELETE FROM "recommendations";
DELETE FROM "user_games";
DELETE FROM "users";
INSERT INTO "game_services" ("id", "access_token", "created_at", "refresh_token", "service_name", "token_expires_at", "updated_at", "user_id") VALUES (980190962, 'MyText', '2026-01-18 03:30:00.811606', 'MyText', 'MyString', '2026-01-14 05:40:08', '2026-01-18 03:30:00.811606', 980190962), (298486374, 'MyText', '2026-01-18 03:30:00.811606', 'MyText', 'MyString', '2026-01-14 05:40:08', '2026-01-18 03:30:00.811606', 298486374);
INSERT INTO "games" ("id", "created_at", "description", "developer", "external_id", "genre", "platform", "publisher", "release_date", "title", "updated_at") VALUES (980190962, '2026-01-18 03:30:00.819008', 'MyText', 'MyString', 'MyString', 'MyString', 'MyString', 'MyString', '2026-01-14', 'MyString', '2026-01-18 03:30:00.819008'), (298486374, '2026-01-18 03:30:00.819008', 'MyText', 'MyString', 'MyString', 'MyString', 'MyString', 'MyString', '2026-01-14', 'MyString', '2026-01-18 03:30:00.819008');
INSERT INTO "identities" ("id", "access_token", "created_at", "expires_at", "extra_info", "profile_configured", "profile_last_checked_at", "profile_visibility", "provider", "refresh_token", "steam_id", "uid", "updated_at", "user_id") VALUES (980190962, 'test_token_1', '2026-01-18 03:30:00.822329', '2026-01-19 03:30:00', '{}', DEFAULT, DEFAULT, DEFAULT, 'google', 'refresh_token_1', DEFAULT, '12345', '2026-01-18 03:30:00.822329', 980190962), (298486374, 'test_token_2', '2026-01-18 03:30:00.822329', NULL, '{}', DEFAULT, DEFAULT, DEFAULT, 'steam', NULL, DEFAULT, '67890', '2026-01-18 03:30:00.822329', 298486374);
INSERT INTO "recommendations" ("id", "ai_model", "created_at", "game_id", "reason", "score", "updated_at", "user_id") VALUES (980190962, 'MyString', '2026-01-18 03:30:00.825050', 980190962, 'MyText', 9.99, '2026-01-18 03:30:00.825050', 980190962), (298486374, 'MyString', '2026-01-18 03:30:00.825050', 298486374, 'MyText', 9.99, '2026-01-18 03:30:00.825050', 298486374);
INSERT INTO "user_games" ("id", "completion_percentage", "created_at", "game_id", "hours_played", "notes", "priority", "status", "updated_at", "user_id") VALUES (980190962, 1, '2026-01-18 03:30:00.828063', 980190962, 9.99, 'MyText', 1, 'MyString', '2026-01-18 03:30:00.828063', 980190962), (298486374, 1, '2026-01-18 03:30:00.828063', 298486374, 9.99, 'MyText', 1, 'MyString', '2026-01-18 03:30:00.828063', 298486374);
INSERT INTO "users" ("id", "avatar_url", "created_at", "email", "provider", "uid", "updated_at", "username") VALUES (980190962, DEFAULT, '2026-01-18 03:30:00.829377', 'user1@example.com', 'google_oauth2', '12345', '2026-01-18 03:30:00.829377', 'testuser1'), (298486374, DEFAULT, '2026-01-18 03:30:00.829377', 'user2@example.com', 'facebook', '67890', '2026-01-18 03:30:00.829377', 'testuser2')[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35m (0.7ms)[0m  [1m[35mALTER TABLE "schema_migrations" ENABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" ENABLE TRIGGER ALL;ALTER TABLE "user_games" ENABLE TRIGGER ALL;ALTER TABLE "games" ENABLE TRIGGER ALL;ALTER TABLE "identities" ENABLE TRIGGER ALL;ALTER TABLE "users" ENABLE TRIGGER ALL;ALTER TABLE "game_services" ENABLE TRIGGER ALL;ALTER TABLE "recommendations" ENABLE TRIGGER ALL[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (1.2ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (6.4ms)[0m  [1m[35mdo $$
  declare r record;
BEGIN
FOR r IN (
  SELECT FORMAT(
    'UPDATE pg_catalog.pg_constraint SET convalidated=false WHERE conname = ''%1$I'' AND connamespace::regnamespace = ''%2$I''::regnamespace; ALTER TABLE %2$I.%3$I VALIDATE CONSTRAINT %1$I;',
    constraint_name,
    table_schema,
    table_name
  ) AS constraint_check
  FROM information_schema.table_constraints WHERE constraint_type = 'FOREIGN KEY'
)
  LOOP
    EXECUTE (r.constraint_check);
  END LOOP;
END;
$$;
[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mBEGIN[0m
---------------------------------------------------------
IdentityTest: test_should_enforce_unique_uid_per_provider
---------------------------------------------------------
  [1m[36mIdentity Load (0.3ms)[0m  [1m[34mSELECT "identities".* FROM "identities" WHERE "identities"."id" = $1 LIMIT $2[0m  [["id", 980190962], ["LIMIT", 1]]
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."id" = $1 LIMIT $2[0m  [["id", 298486374], ["LIMIT", 1]]
  [1m[36mIdentity Exists? (0.1ms)[0m  [1m[34mSELECT 1 AS one FROM "identities" WHERE "identities"."uid" = $1 AND "identities"."provider" = $2 LIMIT $3[0m  [["uid", "12345"], ["provider", "google"], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mBEGIN[0m
----------------------------------------------------------------------------------
IdentityTest: test_find_or_create_from_omniauth_stores_steam_id_for_steam_provider
----------------------------------------------------------------------------------
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."id" = $1 LIMIT $2[0m  [["id", 980190962], ["LIMIT", 1]]
  [1m[36mIdentity Load (0.2ms)[0m  [1m[34mSELECT "identities".* FROM "identities" WHERE "identities"."provider" = $1 AND "identities"."uid" = $2 LIMIT $3[0m  [["provider", "steam"], ["uid", "76561198012345678"], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mIdentity Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "identities" WHERE "identities"."uid" = $1 AND "identities"."provider" = $2 LIMIT $3[0m  [["uid", "76561198012345678"], ["provider", "steam"], ["LIMIT", 1]]
  [1m[36mIdentity Create (0.3ms)[0m  [1m[32mINSERT INTO "identities" ("access_token", "created_at", "expires_at", "extra_info", "profile_configured", "profile_last_checked_at", "profile_visibility", "provider", "refresh_token", "steam_id", "uid", "updated_at", "user_id") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13) RETURNING "id"[0m  [["access_token", "[FILTERED]"], ["created_at", "2026-01-18 03:30:00.863465"], ["expires_at", nil], ["extra_info", "{}"], ["profile_configured", false], ["profile_last_checked_at", nil], ["profile_visibility", "unknown"], ["provider", "steam"], ["refresh_token", "[FILTERED]"], ["steam_id", "76561198012345678"], ["uid", "76561198012345678"], ["updated_at", "2026-01-18 03:30:00.863465"], ["user_id", 980190962]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
--------------------------------------------------------------
IdentityTest: test_expired?_returns_true_when_token_is_expired
--------------------------------------------------------------
  [1m[36mIdentity Load (0.1ms)[0m  [1m[34mSELECT "identities".* FROM "identities" WHERE "identities"."id" = $1 LIMIT $2[0m  [["id", 980190962], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mBEGIN[0m
-------------------------------------------------------------------------
IdentityTest: test_public_profile?_returns_true_when_visibility_is_public
-------------------------------------------------------------------------
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mBEGIN[0m
--------------------------------------------------------
IdentityTest: test_should_accept_valid_17-digit_steam_id
--------------------------------------------------------
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."id" = $1 LIMIT $2[0m  [["id", 980190962], ["LIMIT", 1]]
  [1m[36mIdentity Exists? (0.1ms)[0m  [1m[34mSELECT 1 AS one FROM "identities" WHERE "identities"."uid" = $1 AND "identities"."provider" = $2 LIMIT $3[0m  [["uid", "76561198012345678"], ["provider", "steam"], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mBEGIN[0m
------------------------------------------------------------------
IdentityTest: test_steam_provider?_returns_true_for_steam_provider
------------------------------------------------------------------
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."id" = $1 LIMIT $2[0m  [["id", 980190962], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mBEGIN[0m
---------------------------------------------------------------------------
IdentityTest: test_private_profile?_returns_true_when_visibility_is_private
---------------------------------------------------------------------------
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mBEGIN[0m
------------------------------------------------------------------------------
IdentityTest: test_public_profile?_returns_false_when_visibility_is_not_public
------------------------------------------------------------------------------
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mBEGIN[0m
----------------------------------------------------------------------------------------
IdentityTest: test_profile_visibility_needs_check?_returns_false_for_non-steam_providers
----------------------------------------------------------------------------------------
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mBEGIN[0m
-------------------------------------
IdentityTest: test_should_require_uid
-------------------------------------
  [1m[36mIdentity Exists? (0.1ms)[0m  [1m[34mSELECT 1 AS one FROM "identities" WHERE "identities"."uid" IS NULL AND "identities"."provider" = $1 LIMIT $2[0m  [["provider", "google"], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mBEGIN[0m
------------------------------------------------------------
IdentityTest: test_should_validate_profile_visibility_values
------------------------------------------------------------
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."id" = $1 LIMIT $2[0m  [["id", 980190962], ["LIMIT", 1]]
  [1m[36mIdentity Exists? (0.1ms)[0m  [1m[34mSELECT 1 AS one FROM "identities" WHERE "identities"."uid" = $1 AND "identities"."provider" = $2 LIMIT $3[0m  [["uid", "76561198012345678"], ["provider", "steam"], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mBEGIN[0m
----------------------------------------------------------------
IdentityTest: test_expired?_returns_false_when_expires_at_is_nil
----------------------------------------------------------------
  [1m[36mIdentity Load (0.1ms)[0m  [1m[34mSELECT "identities".* FROM "identities" WHERE "identities"."id" = $1 LIMIT $2[0m  [["id", 980190962], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mBEGIN[0m
--------------------------------------------------------------------
IdentityTest: test_should_allow_nil_steam_id_for_non-steam_providers
--------------------------------------------------------------------
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."id" = $1 LIMIT $2[0m  [["id", 980190962], ["LIMIT", 1]]
  [1m[36mIdentity Exists? (0.1ms)[0m  [1m[34mSELECT 1 AS one FROM "identities" WHERE "identities"."uid" = $1 AND "identities"."provider" = $2 LIMIT $3[0m  [["uid", "12345678"], ["provider", "google"], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mBEGIN[0m
----------------------------------------------------------------------------------
IdentityTest: test_profile_visibility_needs_check?_returns_true_when_never_checked
----------------------------------------------------------------------------------
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mBEGIN[0m
---------------------------------------------------------------------
IdentityTest: test_should_validate_steam_id_format_for_steam_provider
---------------------------------------------------------------------
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."id" = $1 LIMIT $2[0m  [["id", 980190962], ["LIMIT", 1]]
  [1m[36mIdentity Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "identities" WHERE "identities"."uid" = $1 AND "identities"."provider" = $2 LIMIT $3[0m  [["uid", "76561198012345678"], ["provider", "steam"], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mBEGIN[0m
----------------------------------------
IdentityTest: test_should_belong_to_user
----------------------------------------
  [1m[36mIdentity Load (0.1ms)[0m  [1m[34mSELECT "identities".* FROM "identities" WHERE "identities"."id" = $1 LIMIT $2[0m  [["id", 980190962], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mBEGIN[0m
--------------------------------------------------------------------------------------
IdentityTest: test_profile_visibility_needs_check?_returns_false_when_checked_recently
--------------------------------------------------------------------------------------
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mBEGIN[0m
---------------------------------------------------------------------------------------------
IdentityTest: test_profile_visibility_needs_check?_returns_true_when_checked_over_an_hour_ago
---------------------------------------------------------------------------------------------
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mBEGIN[0m
-----------------------------------------------------------------------
IdentityTest: test_steam_provider?_returns_false_for_non-steam_provider
-----------------------------------------------------------------------
  [1m[36mIdentity Load (0.1ms)[0m  [1m[34mSELECT "identities".* FROM "identities" WHERE "identities"."id" = $1 LIMIT $2[0m  [["id", 980190962], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mBEGIN[0m
-------------------------------------------------------------------
IdentityTest: test_expired?_returns_false_when_token_is_not_expired
-------------------------------------------------------------------
  [1m[36mIdentity Load (0.1ms)[0m  [1m[34mSELECT "identities".* FROM "identities" WHERE "identities"."id" = $1 LIMIT $2[0m  [["id", 980190962], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mBEGIN[0m
------------------------------------------
IdentityTest: test_should_require_provider
------------------------------------------
  [1m[36mIdentity Exists? (0.1ms)[0m  [1m[34mSELECT 1 AS one FROM "identities" WHERE "identities"."uid" = $1 AND "identities"."provider" IS NULL LIMIT $2[0m  [["uid", "12345"], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mBEGIN[0m
---------------------------------------------------------------------------------
GamePlatforms::SteamServiceTest: test_fetch_player_summary_handles_malformed_JSON
---------------------------------------------------------------------------------
Steam API JSON parse error: unexpected token 'not' at line 1 column 1
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mBEGIN[0m
------------------------------------------------------------------------------------------------------------
GamePlatforms::SteamServiceTest: test_fetch_player_summary_returns_unknown_for_unrecognized_visibility_state
------------------------------------------------------------------------------------------------------------
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mBEGIN[0m
---------------------------------------------------------------------------------
GamePlatforms::SteamServiceTest: test_fetch_player_summary_handles_empty_response
---------------------------------------------------------------------------------
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mBEGIN[0m
-------------------------------------------------------------------------------------------------
GamePlatforms::SteamServiceTest: test_fetch_player_summary_returns_parsed_data_for_public_profile
-------------------------------------------------------------------------------------------------
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mBEGIN[0m
---------------------------------------------------------------------------------
GamePlatforms::SteamServiceTest: test_fetch_player_summary_handles_timeout_errors
---------------------------------------------------------------------------------
Steam API timeout: execution expired
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mBEGIN[0m
---------------------------------------------------------------------------------------
GamePlatforms::SteamServiceTest: test_fetch_player_summary_detects_unconfigured_profile
---------------------------------------------------------------------------------------
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mBEGIN[0m
----------------------------------------------------------------------------------------
GamePlatforms::SteamServiceTest: test_valid_steam_id?_returns_false_for_invalid_steam_id
----------------------------------------------------------------------------------------
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mBEGIN[0m
-------------------------------------------------------------------------------------------
GamePlatforms::SteamServiceTest: test_fetch_player_summary_returns_nil_for_invalid_steam_id
-------------------------------------------------------------------------------------------
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mBEGIN[0m
----------------------------------------------------------------------------------------------
GamePlatforms::SteamServiceTest: test_fetch_player_summary_returns_nil_when_api_key_is_missing
----------------------------------------------------------------------------------------------
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mBEGIN[0m
-------------------------------------------------------------------------------------------------------
GamePlatforms::SteamServiceTest: test_fetch_player_summary_returns_parsed_data_for_friends_only_profile
-------------------------------------------------------------------------------------------------------
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mBEGIN[0m
--------------------------------------------------------------------------------------------------
GamePlatforms::SteamServiceTest: test_fetch_player_summary_returns_parsed_data_for_private_profile
--------------------------------------------------------------------------------------------------
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mBEGIN[0m
----------------------------------------------------------------------------------------------
GamePlatforms::SteamServiceTest: test_valid_steam_id?_returns_true_for_valid_17-digit_steam_id
----------------------------------------------------------------------------------------------
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mBEGIN[0m
----------------------------------------------------------------------------------------
GamePlatforms::SteamServiceTest: test_fetch_player_summary_handles_API_errors_gracefully
----------------------------------------------------------------------------------------
Steam API returned status 500: Internal Server Error
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mBEGIN[0m
-----------------------------------------
HomeControllerTest: test_should_get_index
-----------------------------------------
Started GET "/" for 127.0.0.1 at 2026-01-17 21:30:00 -0600
Processing by HomeController#index as HTML
  Rendering layout layouts/application.html.erb
  Rendering home/index.html.erb within layouts/application
  Rendered home/index.html.erb within layouts/application (Duration: 0.4ms | GC: 0.0ms)
  Rendered layout layouts/application.html.erb (Duration: 3.3ms | GC: 0.0ms)
Completed 200 OK in 7ms (Views: 4.2ms | ActiveRecord: 0.0ms (0 queries, 0 cached) | GC: 0.0ms)
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[31mROLLBACK[0m
